var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

var App;App=function(){function App(){return angular.element(document).ready(function(_this){return function(){return _this.start()}}(this)),["ngSanitize","ngRoute","ngLodash","ngAnimate","ngTouch","swipe"]}return App.prototype.start=function(){var style;return c.enable=!0,c.log("%c VOID II ","font-size: 50px; background: black; color: white; font-weight:bold; font-family: Arial; padding: 5px;;"),style="font-size: 16px; background: black; color: white;;",c.log("%cA Hi-ReS! website http://hi-res.net",style),c.log("%cVisuals and sounds : SHK - le Shka http://leshka.fr",style),c.log("%cDevelopment : IVXVIXVIII http://ivxvixviii.io",style),c.log("%câ˜ ","font-size: 100px; background: #ED2BA8; padding: 5px;"),c.enable=env.DEVELOPMENT,WAGNER.vertexShadersPath="../vertex-shaders",WAGNER.fragmentShadersPath="../fragment-shaders",WAGNER.assetsPath="../assets",env.DEVELOPMENT&&$("body").addClass("dev"),angular.bootstrap(document,["app"])},App}(),angular.module("app",new App),window.VOID_SETTINGS={DEV_DEEPLINK_TO_ROOM:!1,MAX_POINTERS:6,MAX_CONNECTIONS_PER_ROOM:4,LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM:3,URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM:3,COLORS:[{user:15543083,ambient:13893647,directional:16777215},{user:16185484,ambient:15790702,directional:9013641},{user:10219196,ambient:7928235,directional:8421504},{user:7652564,ambient:7652564,directional:14540253},{user:16756774,ambient:16756774,directional:16777215},{user:9459932,ambient:9459932,directional:16777215}],LOCATION_RADIUS:5e3,LOCATION_HIRES:[51.5265273,-.0821955],SOUND_ENABLED:!0,KONAMI:{PASSES:[{cls:"Halftone2Pass",params:[{id:"amount",value:160,valueMenu:20,valueUrbanJungle:90,valueCicada:60,valueLamentations:90},{id:"smoothness",value:49.63,valueMenu:49.63,valueUrbanJungle:49.63,valueCicada:49.63,valueLamentations:49.63}]}]}};var ENV;ENV=function(){function ENV(){return{SOCKET_ADDR:"http://"+env.SOCKET_HOST+":"+env.SOCKET_PORT,DEBUG:env.DEBUG,GUI:!1}}return ENV}(),angular.module("app").constant("ENV",ENV());var Body;Body=function(){function Body($scope,$rootScope,$timeout,cookieService,sessionService,AssetLoader,BrowserTest,Window,$location){var $$element,onResize;$scope.showHiresLogo=!0,$scope.showFooter=!1,$scope.creditsOpen=!1,$scope.isLoading=!1,$scope.startComplete=!1,$scope.browserTestValidated=BrowserTest.validate(),$$element=$("body"),sessionService.get("konami")&&$$element.addClass("konami"),$scope.toggleFooter=function($event){if(null!=$event&&$event.preventDefault(),!$scope.isLoading&&!1!==$scope.startComplete)return $scope.creditsOpen=!$scope.creditsOpen,$scope.showFooter=!$scope.showFooter,$rootScope.$emit("credits.toggle",$scope.creditsOpen)},onResize=function(){return $$element.css({width:Window.width+"px",height:Window.height+"px"})},Window.on("resize",onResize),onResize(),$scope.$on("$routeChangeStart",function(){return $timeout(function(){return $scope.showHiresLogo="/"===$location.path()||"/computer-says-no"===$location.path()},1e3)}),$scope.$on("$routeChangeSuccess",function(){if(env.PRODUCTION)return ga("send","pageview",{page:$location.url()})}),$rootScope.$on("start.animate.out",function($event){return $scope.startComplete=!0}),$rootScope.$on("loading.show",function($event){return c.debug("IS LOADING"),$scope.isLoading=!0}),$rootScope.$on("loading.hide",function($event){return $scope.isLoading=!1}),$rootScope.$on("footer.swipe",function($event){return $scope.toggleFooter()})}return Body}(),angular.module("app").controller("bodyController",["$scope","$rootScope","$timeout","cookieService","sessionService","AssetLoader","BrowserTest","Window","$location",Body]);var ComputerSaysNo;ComputerSaysNo=function(){function ComputerSaysNo(){$("main").addClass("computer-says-no")}return ComputerSaysNo}(),angular.module("app").controller("computerSaysNoController",[ComputerSaysNo]);var Footer;Footer=function(){function Footer($scope,$rootScope,$timeout,socketService,dictionaryService,GUI){$scope.dictionary=dictionaryService,$scope.userColor=utils.formatColorForCSS(socketService.clientColor.user),$scope.creditsOpen=!1,$rootScope.$on("credits.toggle",function($event,creditsOpen){return $scope.creditsOpen=creditsOpen}),$scope.footerSwipe=function($event){return $rootScope.$emit("footer.swipe")}}return Footer}(),angular.module("app").controller("footerController",["$scope","$rootScope","$timeout","socketService","dictionaryService","GUI",Footer]);var Header;Header=function(){function Header($scope,$rootScope,$location,Browser,BrowserTest,socketService,sessionService,lodash,cookieService,AssetLoader,GUI){var assets,konamiPath,sounds;$scope.showHeader=!1,$scope.userColor=utils.formatColorForCSS(socketService.clientColor.user),$scope.creditsOpen=!1,sounds=[],sessionService.get("konami")&&(konamiPath=sessionService.get("konamiPath"),assets=[{id:"fart1",url:"/sounds/menu/"+konamiPath+"fart1",type:"sound"},{id:"fart2",url:"/sounds/menu/"+konamiPath+"fart2",type:"sound"},{id:"fart3",url:"/sounds/menu/"+konamiPath+"fart3",type:"sound"},{id:"fart4",url:"/sounds/menu/"+konamiPath+"fart4",type:"sound"},{id:"fart5",url:"/sounds/menu/"+konamiPath+"fart5",type:"sound"}],AssetLoader.load(assets).then(function(_assets){var i,len,results,sound;for(results=[],i=0,len=_assets.length;i<len;i++)sound=_assets[i],results.push(sounds[sound.id]=sound.data);return results})),$scope.onLogoClick=function($event){if(sessionService.get("konami")&&sounds[Object.keys(sounds)[Math.floor(utils.random(0,5))]].play(),"/"!==$location.path())return $location.url("/")},$rootScope.$on("socket.clientcolor.change",function($event,data){return $scope.$apply(function(){return $scope.userColor=utils.formatColorForCSS(data.userColor)})}),$rootScope.$on("credits.toggle",function($event,creditsOpen){return $scope.creditsOpen=creditsOpen}),$rootScope.$on("introduction.animate.out",function($event){return $scope.showHeader=!0})}return Header}(),angular.module("app").controller("headerController",["$scope","$rootScope","$location","Browser","BrowserTest","socketService","sessionService","lodash","cookieService","AssetLoader","GUI",Header]);var Home;Home=function(){function Home($scope){}return Home}(),angular.module("app").controller("homeController",["$scope",Home]);var Introduction;Introduction=function(){function Introduction($scope,$rootScope,sessionService){var $element;$scope.showIntroductionText=!1,$scope.hideIntroductionText=!1,$scope.konami=sessionService.get("konami"),$element=$("#introduction"),$scope.$on("introduction.destroy",function(){return c.log("destroy"),$element.html(""),$element.remove()})}return Introduction}(),angular.module("app").controller("introductionController",["$scope","$rootScope","sessionService",Introduction]);var Loading;Loading=function(){function Loading($scope,$rootScope,$timeout,sessionService,dictionaryService){var $body;$scope.dictionary=dictionaryService,$scope.positionClass="",$scope.show=!0,$scope.konami=sessionService.get("konami"),$body=$("body"),$body.addClass("loading"),$rootScope.$on("loading.show",function(event,obj){return $scope.positionClass="position-"+obj.class,$scope.show=!0,$scope.$$phase||$scope.$apply(),$body.addClass("loading")}),$rootScope.$on("loading.hide",function(){return $scope.show=!1,$scope.$$phase||$scope.$apply(),$body.removeClass("loading")})}return Loading}(),angular.module("app").controller("loadingController",["$scope","$rootScope","$timeout","sessionService","dictionaryService",Loading]);var LocationControls;LocationControls=function(){function LocationControls($scope,$timeout,geolocationService){$scope.disableBtn=!1,$scope.status="",$scope.onClickLocation=function($event){return $event.preventDefault(),c.log("request location"),$scope.status="requesting...",$scope.disableBtn=!0,geolocationService.request().then(function(_this){return function(geolocation){return c.log("@clientGeolocation",geolocation),$scope.disableBtn=!1}}(),function(error){return c.log("error",error),$scope.status=error,$scope.disableBtn=!1,$timeout(function(){return $scope.status=""},2e3)})},$scope.$on("$destroy",function(){})}return LocationControls}(),angular.module("app").controller("locationControlsController",["$scope","$timeout","geolocationService",LocationControls]);var MenuRoomTitle;MenuRoomTitle=function(){function MenuRoomTitle($scope,$timeout,$location,Window,$rootScope,sessionService,dictionaryService,cookieService,roomsService,GUI){var $element,hideTimeout,lockTimeout,updateText;$element=$("#menu-room-title"),$scope.clickedRoomId="",$scope.lockMenu=!1,$scope.showMenuRoomTitle=!1,$scope.showRoomTitle=!1,$scope.currentRoom={title:"",description:""},updateText=function(currentFaceIndex){return null==currentFaceIndex&&(currentFaceIndex=0),$scope.currentRoom.title=dictionaryService.get("room-"+currentFaceIndex+"-title"),$scope.currentRoom.description=dictionaryService.get("room-"+currentFaceIndex+"-description")},updateText(),$rootScope.$on("menu.rotation.start",function($event,faceIndex){return TweenMax.killTweensOf($element),TweenMax.to($element,.5,{autoAlpha:0})}),$rootScope.$on("menu.rotation",function($event,obj){return $scope.clickedRoomId=roomsService.getRoomIds()[obj.faceIndex],updateText(obj.faceIndex)}),$rootScope.$on("menu.rotation.end",function($event,faceIndex){return $scope.clickedRoomId=roomsService.getRoomIds()[faceIndex],$scope.$apply(function(){return updateText(faceIndex)}),TweenMax.killTweensOf($element),TweenMax.to($element,.5,{autoAlpha:1})}),$rootScope.$on("menu.start.transition.end",function($event,faceIndex){return $scope.clickedRoomId=roomsService.getRoomIds()[faceIndex],$scope.showMenuRoomTitle=!0,$scope.$apply(function(){return updateText(faceIndex)}),TweenMax.killTweensOf($element),TweenMax.set($element,{z:-100}),TweenMax.to($element,1,{autoAlpha:1,z:0})}),$scope.joinRoom=function($event,wasDragged){if(!$scope.lockMenu)return""!==$scope.clickedRoomId&&void 0!==$scope.clickedRoomId||($scope.clickedRoomId=roomsService.getRoomIds()[0]),$rootScope.$emit("joining.room.hide.arrows"),$location.url("/room/"+$scope.clickedRoomId)},$scope.$on("$routeChangeStart",function(){if(!1!==sessionService.get("userHasClickedStart"))return"/"!==$location.path()?($scope.lockMenu=!0,$scope.$emit("menu.animate.out"),$rootScope.$emit("loading.show",{class:"menu"}),c.debug("$scope.clickedRoomId",$scope.clickedRoomId),setTimeout(function(){return c.debug($scope.clickedRoomId),$rootScope.$emit("room.join",$scope.clickedRoomId)},1500)):$timeout(function(){return $scope.lockMenu=!1},3e3)}),$rootScope.$on("start.animate.out",function(){return TweenMax.set($element,{x:"-50%",y:"-50%",z:-200}),TweenMax.to($element,1,{z:0})}),hideTimeout=null,lockTimeout=null,$rootScope.$on("room.animate.in.for.menu",function(){return $scope.showRoomTitle=!0,hideTimeout=$timeout(function(){return c.log("hide"),$element.hide()},2e3)}),$rootScope.$on("room.animate.out.for.menu.start",function(){return clearTimeout(lockTimeout),clearTimeout(hideTimeout),$element.show(),$scope.showRoomTitle=!1})}return MenuRoomTitle}(),angular.module("app").controller("menuRoomTitleController",["$scope","$timeout","$location","Window","$rootScope","sessionService","dictionaryService","cookieService","roomsService","GUI",MenuRoomTitle]);var Menu;Menu=function(){function Menu($scope,$timeout,$location,Window,$rootScope,cookieService,sessionService,AssetLoader,roomsService,GUI){var $element,animateIn,filterObj,onLoaded,setGrayscaleFilter;$scope.showMenu=!0,$scope.showMenuUI=!1,$element=$("#menu"),filterObj={value:1},setGrayscaleFilter=function(value,duration){return null==value&&(value=1),null==duration&&(duration=1),TweenMax.to(filterObj,duration,{value:value,onUpdate:function(){return $element.css({"-webkit-filter":"grayscale("+filterObj.value+")","-moz-filter":"grayscale("+filterObj.value+")","-o-filter":"grayscale("+filterObj.value+")",filter:"grayscale("+filterObj.value+")"})}})},setGrayscaleFilter(filterObj.value,0),animateIn=function(){return c.log("MenuController::animateIn")},onLoaded=function(){return $timeout(function(){return animateIn()},1e3)},$timeout(onLoaded,0),$rootScope.$on("room.animate.out.for.menu.start",function(){if(sessionService.get("userHasClickedStart"))return $scope.showMenuUI=!0}),$rootScope.$on("room.animate.out.for.menu",function(){return $element.css("clip","")}),$rootScope.$on("joining.room.hide.arrows",function(){return $scope.showMenuUI=!1}),$rootScope.$on("menu.start.transition.end",function(){return $scope.$apply(function(){return $scope.showMenuUI=!0}),TweenMax.to($element,3,{opacity:1})}),$rootScope.$on("introduction.password.update",function(event,percent){return setGrayscaleFilter(1-percent)})}return Menu}(),angular.module("app").controller("menuController",["$scope","$timeout","$location","Window","$rootScope","cookieService","sessionService","AssetLoader","roomsService","GUI",Menu]);var RoomTitle;RoomTitle=function(){function RoomTitle($scope,$timeout,$location,Window,$rootScope,dictionaryService,cookieService,roomsService,GUI){var $element,updateText;$element=$("#room-title"),$scope.showMenuRoomTitle=!1,$scope.showRoomTitle=!1,$scope.currentRoom={title:"",description:""},updateText=function(currentFaceIndex){return null==currentFaceIndex&&(currentFaceIndex=0),$scope.currentRoom.description=dictionaryService.get("room-"+currentFaceIndex+"-description")},updateText(),$rootScope.$on("menu.rotation.end",function($event,faceIndex){return $scope.$apply(function(){return updateText(faceIndex)}),TweenMax.killTweensOf($element),TweenMax.to($element,.5,{autoAlpha:1})}),$rootScope.$on("menu.rotation",function($event,obj){return updateText(obj.faceIndex)}),$rootScope.$on("room.animate.in.for.menu",function(){return $scope.showTitle=!0}),$rootScope.$on("room.animate.out.start",function(){return $scope.showTitle=!1})}return RoomTitle}(),angular.module("app").controller("roomTitleController",["$scope","$timeout","$location","Window","$rootScope","dictionaryService","cookieService","roomsService","GUI",RoomTitle]);var Room;Room=function(){function Room($scope,$rootScope,$timeout,$location,$routeParams,socketService,sessionService,roomsService,cookieService,GUI,Window,Browser){var $element,MASK_DEFAULT_PERCENT,animateIn,animateOut,calculateMask,obj,onLoaded;$scope.id=$routeParams.id||"triangles",$scope.Browser=Browser,$scope.showTitle=!1,$scope.userHasClickedStart=sessionService.get("userHasClickedStart"),MASK_DEFAULT_PERCENT=.53,Browser.device&&(MASK_DEFAULT_PERCENT=.65),$element=$("#room"),calculateMask=function(percent){var diff,height,obj,scalePercent,width;return Window.height/Window.width,height=.5*Window.height,width=.5*Window.width,obj={top:utils.lerp(height,0,percent),right:utils.lerp(width,Window.width,percent),bottom:utils.lerp(height,Window.height,percent),left:utils.lerp(width,0,percent)},width=Math.abs(obj.left-obj.right),height=Math.abs(obj.top-obj.bottom),scalePercent=percent.map(MASK_DEFAULT_PERCENT,1,0,1),diff=.5*-(width-height),obj.right+=diff*(1-scalePercent),obj.left-=diff*(1-scalePercent),obj},obj=calculateMask(MASK_DEFAULT_PERCENT),$element.css({clip:"rect("+obj.top+"px "+obj.right+"px "+obj.bottom+"px "+obj.left+"px)",opacity:0}),animateIn=function(){var objFrom,objTo,params;return objFrom=calculateMask(MASK_DEFAULT_PERCENT),objTo=calculateMask(1),params={top:objTo.top,right:objTo.right,bottom:objTo.bottom,left:objTo.left,ease:Quad.easeInOut,onUpdate:function(_this){return function(){var path;return path="rect("+objFrom.top+"px "+objFrom.right+"px "+objFrom.bottom+"px "+objFrom.left+"px)",$element.css("clip",path)}}(),onComplete:function(_this){return function(){return $element.css("clip","")}}()},TweenMax.to($element,1,{opacity:1,onComplete:function(){return TweenMax.to(objFrom,1,params),$rootScope.$emit("room.animate.in.for.menu"),$scope.showTitle=!0}})},animateOut=function(){var objFrom,objTo,params;return objFrom=calculateMask(1),objTo=calculateMask(MASK_DEFAULT_PERCENT),$scope.showTitle=!1,$rootScope.$emit("room.animate.out.start"),params={top:objTo.top,right:objTo.right,bottom:objTo.bottom,left:objTo.left,delay:1,onStart:function(){return $rootScope.$emit("room.animate.out.for.menu.start")},onUpdate:function(_this){return function(){var path;return path="rect("+objFrom.top+"px "+objFrom.right+"px "+objFrom.bottom+"px "+objFrom.left+"px)",$element.css("clip",path)}}(),onComplete:function(_this){return function(){return $rootScope.$emit("room.animate.out.for.menu",socketService.roomId),TweenMax.to($element,1,{opacity:0,onComplete:function(){return $rootScope.$broadcast("room.leave")}})}}()},TweenMax.to(objFrom,1,params)},onLoaded=function(){return $scope.$$phase||$rootScope.$emit("loading.hide"),animateIn()},$scope.$on("$routeChangeStart",function(){if(c.log("path",$location.path()),"/"===$location.path()&&$scope.userHasClickedStart)return c.log("animate room out"),animateOut()}),$scope.$on("room.assets.loaded",function($event){return c.log("room assets has loaded"),$timeout(onLoaded,0)})}return Room}(),angular.module("app").controller("roomController",["$scope","$rootScope","$timeout","$location","$routeParams","socketService","sessionService","roomsService","cookieService","GUI","Window","Browser",Room]);var Rooms;Rooms=function(){function Rooms($scope,$rootScope,$location,roomsService,socketService,GUI){var onRoomJoined,onRoomLeft;$scope.rooms=roomsService.getRoomIds(),$rootScope.$on("room.join",function($event,roomId){return socketService.joinRoom(roomId)}),$rootScope.$on("room.leave",function($event,roomId){return socketService.leaveRoom()}),onRoomJoined=function($event,data){},$scope.$on("room.joined",onRoomJoined),onRoomLeft=function($event,data){switch($scope.roomJoined=!1,data.status){case"success":c.log("success");break;case"error":c.log("error")}return $scope.$apply(function(_this){return function(){return $scope.joining=!1,$location.url("/")}}())},$scope.$on("room.left",onRoomLeft)}return Rooms}(),angular.module("app").controller("roomsController",["$scope","$rootScope","$location","roomsService","socketService","GUI",Rooms]);var Sandbox;Sandbox=function(){function Sandbox($scope,$routeParams){$scope.type=$routeParams.type||"audio",$scope.id=$routeParams.id||0}return Sandbox}(),angular.module("app").controller("sandboxController",["$scope","$routeParams",Sandbox]);var Start;Start=function(){function Start($scope,$rootScope,$timeout,$location,cookieService,dictionaryService,sessionService,geolocationService,Browser,GUI){var $$element,$$section,animateIn,animateOut,isMenu,onGeolocationComplete;$scope.showStart=!1,$scope.dictionary=dictionaryService,$scope.browser=Browser,$scope.hideStartButton=!1,$scope.showStartLoader=!1,$scope.konami=sessionService.get("konami"),$$element=$("#start"),$$section=$$element.find("section"),isMenu=function(){return"/"===$location.path()},animateIn=function(){if(VOID_SETTINGS.DEV_DEEPLINK_TO_ROOM?TweenMax.set($$element,{autoAlpha:0}):TweenMax.set($$element,{autoAlpha:1}),isMenu())return c.debug("animate in"),$scope.$apply(function(){return $scope.showStart=!0}),$$element.addClass("transition-in")},animateOut=function(){return c.debug("animate out"),TweenMax.to($$element,.3,{autoAlpha:0}),TweenMax.to($$section,.3,{z:20,onComplete:function(){return $$element.hide()}})},$rootScope.$on("introduction.animate.out",animateIn),$scope.startClick=function(event){return null==event&&(event=null),null!=event&&event.preventDefault(),$scope.hideStartButton=!0,onGeolocationComplete()},onGeolocationComplete=function(){return sessionService.set("userHasClickedStart",!0),$timeout(function(){if($rootScope.$emit("start.animate.out"),animateOut(),null!==sessionService.get("deeplinkRoomId"))return $timeout(function(){var roomId;return roomId=sessionService.get("deeplinkRoomId"),$location.url("/room/"+roomId),c.log("roomId",roomId)},1250)},200)}}return Start}(),angular.module("app").controller("startController",["$scope","$rootScope","$timeout","$location","cookieService","dictionaryService","sessionService","geolocationService","Browser","GUI",Start]);var Arrow;Arrow=function(){function Arrow(socketService){return{link:function($scope,$element,attrs){var $$element,onMouseOut,onMouseOver;return $$element=$($element),onMouseOver=function(){return $$element.find("polygon").css("fill",utils.formatColorForCSS(socketService.clientColor.user))},onMouseOut=function(){return $$element.find("polygon").css("fill","inherit")},$$element.on("mouseover",onMouseOver),$$element.on("mouseout",onMouseOut)}}}return Arrow}(),angular.module("app").directive("arrow",["socketService",Arrow]);var AudioVolume;AudioVolume=function(){function AudioVolume(Window){return{restrict:"A",link:function($scope,$element){var onWindowFocused,onWindowIdle,volumeTween;return volumeTween={volume:1},onWindowIdle=function(){return Howler.volume(0)},onWindowFocused=function(){return Howler.volume(0),TweenMax.killTweensOf(volumeTween),volumeTween.volume=0,TweenMax.to(volumeTween,1,{volume:1,onUpdate:function(){return Howler.volume(volumeTween.volume)}})},Window.on("idle",onWindowIdle),Window.on("focused",onWindowFocused)}}}return AudioVolume}(),angular.module("app").directive("audioVolume",["Window",AudioVolume]);var Background;Background=function(){function Background($rootScope,AssetLoader,GUI,Window,sessionService,Browser,BrowserTest){return{restrict:"E",link:function($scope,$element,attrs){var $$element,_render,asset,cameras,composer,controls,createObjects,gui,helperAxis,helperCamera,helperGrid,mesh,noisePass,onResize,onResizeComplete,render,renderer,resizeTimeout,scene,settings,update,zoom;return $$element=$element,!BrowserTest.validate()||Browser.device?(asset=BrowserTest.validate()?{id:"background",url:"/images/background.jpg",type:"image"}:{id:"background",url:"/images/fallback.jpg",type:"image"},AssetLoader.load([asset],"background").then(function(_this){return function(response){return $$element.css("background-image","url("+asset.url+")").addClass("show")}}())):(gui=new GUI.create(!1),settings={debug:!1,showHelpers:!1},gui.add(settings,"debug"),cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.OrthographicCamera(Window.width/-2,Window.width/2,Window.height/2,Window.height/-2,1,1e3)},cameras.user.position.set(0,0,400),renderer=new THREE.WebGLRenderer({antialias:!0,autoClearColor:!0,alpha:!0}),composer=new WAGNER.Composer(renderer),renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),$element[0].appendChild(renderer.domElement),scene=new THREE.Scene,helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&(scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),noisePass=new WAGNER.NoisePass,noisePass.params.amount=.061,noisePass.params.speed=.38,gui.add(noisePass.params,"amount").min(0).max(10),gui.add(noisePass.params,"speed").min(0).max(10),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},mesh=null,createObjects=function(){var background,geometry,material;return scene.remove(mesh),geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),background=sessionService.get("konami")?"landscape.gif":"background.jpg",material=new THREE.MeshBasicMaterial({map:(new THREE.TextureLoader).load("/images/"+background)}),mesh=new THREE.Mesh(geometry,material),scene.add(mesh)},resizeTimeout=null,onResizeComplete=function(){return createObjects(),!1},onResize=function(){var height,ratio,width;return!0,clearTimeout(resizeTimeout),resizeTimeout=setTimeout(onResizeComplete,500),width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.left=width/-2,cameras.user.right=width/2,cameras.user.top=height/2,cameras.user.bottom=height/-2,cameras.user.updateProjectionMatrix(),composer.setSize(.8*width,.8*height),renderer.setSize(width,height)},onResize(),Window.on("resize",onResize),_render=function(camera,left,bottom,width,height){return left*=Window.width,bottom*=Window.height,width*=Window.width,height*=Window.height,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},update=function(){if(settings.debug)return null!=controls?controls.update():void 0},render=function(){return requestAnimationFrame(render),update(),settings.debug?(_render(cameras.dev,0,0,1,1),_render(cameras.user,0,0,.25,.25)):(composer.reset(),composer.render(scene,cameras.user),composer.pass(noisePass),composer.toScreen())},zoom(cameras.dev,150),render()),$rootScope.$on("introduction.password.update",function(event,percent){return $element.css("opacity",percent)})}}}return Background}(),angular.module("app").directive("background",["$rootScope","AssetLoader","GUI","Window","sessionService","Browser","BrowserTest",Background]);var Favicon,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Favicon=function(){function Favicon($rootScope,$location,socketService){return{restrict:"A",link:function($scope,$element,attrs){var $head,changeFavicon;return $head=$("head"),$("body"),null,changeFavicon=function(file){var $favicon;return $head.find("#favicon").remove(),$favicon=$("<link/>").attr({id:"favicon",rel:"shortcut icon",type:"image/x-icon",href:file}),$head.append($favicon)},$rootScope.$on("socket.clientcolor.change",function($event,data){var color,file;return color=utils.formatColorForCSS(data.userColor).replace("#",""),file="/favicons/default/ico/0x"+color+".ico",changeFavicon(file)}),$scope.$on("$routeChangeStart",function(){var color,file,path,ref;return"/"===$location.path()?(color=utils.formatColorForCSS(socketService.clientColor.user).replace("#",""),file="/favicons/default/ico/0x"+color+".ico",changeFavicon(file)):(color=utils.formatColorForCSS(socketService.clientColor.user).replace("#",""),path=$location.path().split("/"),ref=path[2],indexOf.call(env.VOID_CONFIG.rooms,ref)>=0?(file="/favicons/"+path[2]+"/ico/0x"+color+".ico",changeFavicon(file)):void 0)})}}}return Favicon}(),angular.module("app").directive("favicon",["$rootScope","$location","socketService",Favicon]);var FullscreenResize;FullscreenResize=function(){function FullscreenResize(Window){return{link:function($scope,$element){var onResize;return onResize=function(){return $element.css({width:Window.width+"px",height:Window.height+"px"})},Window.on("resize",onResize),onResize(),$scope.$on("$destroy",function(){return Window.off("resize",onResize)})}}}return FullscreenResize}(),angular.module("app").directive("fullscreenResize",["Window",FullscreenResize]);var Konami;Konami=function(){function Konami($rootScope,sessionService){return{link:function($scope,$element,attrs){var kkeys,konami,wtf;return wtf=function(){return window.location.href="/?konami=time"},kkeys=[],konami="38,38,40,40,37,39,37,39,66,65",$(document).keydown(function(_this){return function(e){if(kkeys.push(e.keyCode),kkeys.toString().indexOf(konami)>=0)return $(document).unbind("keydown",arguments.callee),wtf(),kkeys=[]}}())}}}return Konami}(),angular.module("app").directive("konami",["$rootScope","sessionService",Konami]);var Palette,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Palette=function(){function Palette(socketService,$rootScope,$timeout){return{restrict:"E",link:function($scope,$element,attrs){var $body,color,darkThemeColors,i,len,ref,updateElementsColor;for($($element),$body=$("body"),$scope.userColor=utils.formatColorForCSS(socketService.clientColor.user),$scope.colors=[],ref=VOID_SETTINGS.COLORS,i=0,len=ref.length;i<len;i++)color=ref[i],$scope.colors.push(utils.formatColorForCSS(color.user));return darkThemeColors=["#f6f88c","#9beebc"],updateElementsColor=function(){var ref1,theme;return ref1=$scope.userColor,theme=indexOf.call(darkThemeColors,ref1)>=0?"theme-dark":"theme-light",$body.find(".user-color, [user-color]").css({color:$scope.userColor,"border-color":$scope.userColor}).removeClass("theme-dark theme-light").addClass(theme),$body.find("[user-color-hover]").hover(function(){return $(this).css({"background-color":$scope.userColor})},function(){return $(this).css({"background-color":"inherit"})})},$timeout(updateElementsColor,0),$scope.changeColor=function($event){var colorIndex;return $event.preventDefault(),colorIndex=$($event.currentTarget).data().colorIndex,socketService.setClientColor(colorIndex)},$rootScope.$on("socket.clientcolor.change",function($event,data){return $scope.userColor=utils.formatColorForCSS(data.userColor),updateElementsColor()})}}}return Palette}(),angular.module("app").directive("palette",["socketService","$rootScope","$timeout",Palette]);var SocialShare;SocialShare=function(){function SocialShare(shareService,dictionaryService){return{link:function($scope,$element,attrs){var onClick;return onClick=function(event){switch(event.preventDefault(),attrs.socialShare){case"facebook":return c.log("facebook"),shareService.facebook(env.SHARE_URL,dictionaryService.get("share-text"));case"twitter":return c.log("twitter"),shareService.twitter(env.SHARE_URL,dictionaryService.get("share-text"));case"google":return c.log("google"),shareService.google(env.SHARE_URL)}},$element.on("click touchstart",onClick)}}}return SocialShare}(),angular.module("app").directive("socialShare",["shareService","dictionaryService",SocialShare]);var SplitWords;SplitWords=function(){function SplitWords(Browser){return{link:function($scope,$element,attrs){if(Browser.desktop)return $($element).find("p").each(function(index,item){var text;return text=$(item).text().split(" ").map(function(word){return"<span>"+word+"</span> "}),$(item).html(text)})}}}return SplitWords}(),angular.module("app").directive("splitWords",["Browser",SplitWords]);var AbstractInterpolator,CubicInterpolator,Enum,LinearInterpolator,NearestInterpolator,PI,SincFilterInterpolator,Smooth,clipClamp,clipMirror,clipPeriodic,defaultConfig,getColumn,getType,isValidNumber,k,makeLanczosWindow,makeScaledFunction,makeSincKernel,normalizeScaleTo,shallowCopy,sin,sinc,v,validateNumber,validateVector,extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Enum={METHOD_NEAREST:"nearest",METHOD_LINEAR:"linear",METHOD_CUBIC:"cubic",METHOD_LANCZOS:"lanczos",METHOD_SINC:"sinc",CLIP_CLAMP:"clamp",CLIP_ZERO:"zero",CLIP_PERIODIC:"periodic",CLIP_MIRROR:"mirror",CUBIC_TENSION_DEFAULT:0,CUBIC_TENSION_CATMULL_ROM:0},defaultConfig={method:Enum.METHOD_CUBIC,cubicTension:Enum.CUBIC_TENSION_DEFAULT,clip:Enum.CLIP_CLAMP,scaleTo:0,sincFilterSize:2,sincWindow:void 0},clipClamp=function(i,n){return Math.max(0,Math.min(i,n-1))},clipPeriodic=function(i,n){return i%=n,i<0&&(i+=n),i},clipMirror=function(i,n){var period;return period=2*(n-1),i=clipPeriodic(i,period),i>n-1&&(i=period-i),i},AbstractInterpolator=function(){function AbstractInterpolator(array,config){if(this.array=array.slice(0),this.length=this.array.length,!(this.clipHelper={clamp:this.clipHelperClamp,zero:this.clipHelperZero,periodic:this.clipHelperPeriodic,mirror:this.clipHelperMirror}[config.clip]))throw"Invalid clip: "+config.clip}return AbstractInterpolator.prototype.getClippedInput=function(i){return 0<=i&&i<this.length?this.array[i]:this.clipHelper(i)},AbstractInterpolator.prototype.clipHelperClamp=function(i){return this.array[clipClamp(i,this.length)]},AbstractInterpolator.prototype.clipHelperZero=function(i){return 0},AbstractInterpolator.prototype.clipHelperPeriodic=function(i){return this.array[clipPeriodic(i,this.length)]},AbstractInterpolator.prototype.clipHelperMirror=function(i){return this.array[clipMirror(i,this.length)]},
AbstractInterpolator.prototype.interpolate=function(t){throw"Subclasses of AbstractInterpolator must override the interpolate() method."},AbstractInterpolator}(),NearestInterpolator=function(superClass){function NearestInterpolator(){return NearestInterpolator.__super__.constructor.apply(this,arguments)}return extend(NearestInterpolator,superClass),NearestInterpolator.prototype.interpolate=function(t){return this.getClippedInput(Math.round(t))},NearestInterpolator}(AbstractInterpolator),LinearInterpolator=function(superClass){function LinearInterpolator(){return LinearInterpolator.__super__.constructor.apply(this,arguments)}return extend(LinearInterpolator,superClass),LinearInterpolator.prototype.interpolate=function(t){var k;return k=Math.floor(t),(1-(t-=k))*this.getClippedInput(k)+t*this.getClippedInput(k+1)},LinearInterpolator}(AbstractInterpolator),CubicInterpolator=function(superClass){function CubicInterpolator(array,config){this.tangentFactor=1-Math.max(0,Math.min(1,config.cubicTension)),CubicInterpolator.__super__.constructor.apply(this,arguments)}return extend(CubicInterpolator,superClass),CubicInterpolator.prototype.getTangent=function(k){return this.tangentFactor*(this.getClippedInput(k+1)-this.getClippedInput(k-1))/2},CubicInterpolator.prototype.interpolate=function(t){var k,m,p,t2,t3;return k=Math.floor(t),m=[this.getTangent(k),this.getTangent(k+1)],p=[this.getClippedInput(k),this.getClippedInput(k+1)],t-=k,t2=t*t,(2*(t3=t*t2)-3*t2+1)*p[0]+(t3-2*t2+t)*m[0]+(-2*t3+3*t2)*p[1]+(t3-t2)*m[1]},CubicInterpolator}(AbstractInterpolator),sin=Math.sin,PI=Math.PI,sinc=function(x){return 0===x?1:sin(PI*x)/(PI*x)},makeLanczosWindow=function(a){return function(x){return sinc(x/a)}},makeSincKernel=function(window){return function(x){return sinc(x)*window(x)}},SincFilterInterpolator=function(superClass){function SincFilterInterpolator(array,config){if(SincFilterInterpolator.__super__.constructor.apply(this,arguments),this.a=config.sincFilterSize,!config.sincWindow)throw"No sincWindow provided";this.kernel=makeSincKernel(config.sincWindow)}return extend(SincFilterInterpolator,superClass),SincFilterInterpolator.prototype.interpolate=function(t){var j,k,n,ref,ref1,sum;for(k=Math.floor(t),sum=0,n=j=ref=k-this.a+1,ref1=k+this.a;ref<=ref1?j<=ref1:j>=ref1;n=ref<=ref1?++j:--j)sum+=this.kernel(t-n)*this.getClippedInput(n);return sum},SincFilterInterpolator}(AbstractInterpolator),getColumn=function(arr,i){var j,len,results,row;for(results=[],j=0,len=arr.length;j<len;j++)row=arr[j],results.push(row[i]);return results},makeScaledFunction=function(f,baseScale,scaleRange){var scaleFactor,translation;return"0,1"===scaleRange.join?f:(scaleFactor=baseScale/(scaleRange[1]-scaleRange[0]),translation=scaleRange[0],function(t){return f(scaleFactor*(t-translation))})},getType=function(x){return Object.prototype.toString.call(x).slice("[object ".length,-1)},validateNumber=function(n){if(isNaN(n))throw"NaN in Smooth() input";if("Number"!==getType(n))throw"Non-number in Smooth() input";if(!isFinite(n))throw"Infinity in Smooth() input"},validateVector=function(v,dimension){var j,len,n;if("Array"!==getType(v))throw"Non-vector in Smooth() input";if(v.length!==dimension)throw"Inconsistent dimension in Smooth() input";for(j=0,len=v.length;j<len;j++)n=v[j],validateNumber(n)},isValidNumber=function(n){return"Number"===getType(n)&&isFinite(n)&&!isNaN(n)},normalizeScaleTo=function(s){var invalidErr;switch(invalidErr="scaleTo param must be number or array of two numbers",getType(s)){case"Number":if(!isValidNumber(s))throw invalidErr;s=[0,s];break;case"Array":if(2!==s.length)throw invalidErr;if(!isValidNumber(s[0])||!isValidNumber(s[1]))throw invalidErr;break;default:throw invalidErr}return s},shallowCopy=function(obj){var copy,k,v;copy={};for(k in obj)hasProp.call(obj,k)&&(v=obj[k],copy[k]=v);return copy},Smooth=function(arr,config){var baseDomainEnd,dimension,i,interpolator,interpolatorClass,interpolators,k,n,properties,smoothFunc,v;null==config&&(config={}),properties={},config=shallowCopy(config),properties.config=shallowCopy(config),null==config.scaleTo&&(config.scaleTo=config.period),null==config.sincFilterSize&&(config.sincFilterSize=config.lanczosFilterSize);for(k in defaultConfig)hasProp.call(defaultConfig,k)&&(v=defaultConfig[k],null==config[k]&&(config[k]=v));if(!(interpolatorClass={nearest:NearestInterpolator,linear:LinearInterpolator,cubic:CubicInterpolator,lanczos:SincFilterInterpolator,sinc:SincFilterInterpolator}[config.method]))throw"Invalid method: "+config.method;if("lanczos"===config.method&&(config.sincWindow=makeLanczosWindow(config.sincFilterSize)),arr.length<2)throw"Array must have at least two elements";properties.count=arr.length,smoothFunc=function(){var j,l,len,len1;switch(getType(arr[0])){case"Number":if(properties.dimension="scalar",Smooth.deepValidation)for(j=0,len=arr.length;j<len;j++)n=arr[j],validateNumber(n);return interpolator=new interpolatorClass(arr,config),function(t){return interpolator.interpolate(t)};case"Array":if(properties.dimension=dimension=arr[0].length,!dimension)throw"Vectors must be non-empty";if(Smooth.deepValidation)for(l=0,len1=arr.length;l<len1;l++)v=arr[l],validateVector(v,dimension);return interpolators=function(){var o,ref,results;for(results=[],i=o=0,ref=dimension;0<=ref?o<ref:o>ref;i=0<=ref?++o:--o)results.push(new interpolatorClass(getColumn(arr,i),config));return results}(),function(t){var len2,o,results;for(results=[],o=0,len2=interpolators.length;o<len2;o++)interpolator=interpolators[o],results.push(interpolator.interpolate(t));return results};default:throw"Invalid element type: "+getType(arr[0])}}(),baseDomainEnd="periodic"===config.clip?arr.length:arr.length-1,config.scaleTo||(config.scaleTo=baseDomainEnd),properties.domain=normalizeScaleTo(config.scaleTo),smoothFunc=makeScaledFunction(smoothFunc,baseDomainEnd,properties.domain),properties.domain.sort();for(k in properties)hasProp.call(properties,k)&&(v=properties[k],smoothFunc[k]=v);return smoothFunc};for(k in Enum)hasProp.call(Enum,k)&&(v=Enum[k],Smooth[k]=v);Smooth.deepValidation=!0,("undefined"!=typeof exports&&null!==exports?exports:window).Smooth=Smooth;var TouchMotion,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.TouchMotion=TouchMotion=function(){function TouchMotion($element,device){this.onTouchEnd=bind(this.onTouchEnd,this),this.onTouchMove=bind(this.onTouchMove,this),this.onTouchStart=bind(this.onTouchStart,this),Happens(this),this.$el=$($element),this.mc=new Hammer($element[0]),this.pointers=[],device&&(this.deviceSensitivityMultiplier=.5),this.mc.get("pan").set({direction:Hammer.DIRECTION_ALL})}return TouchMotion.prototype.isDown=!1,TouchMotion.prototype.deviceSensitivityMultiplier=1,TouchMotion.prototype.getEventPointers=function(event){var i,j,len,len1,pointer,pointers,ref,ref1;if(pointers=[],null!=event.pointers)for(ref=event.pointers,i=0,len=ref.length;i<len;i++)pointer=ref[i],pointers.push({x:pointer.pageX/window.innerWidth,y:pointer.pageY/window.innerHeight,velocityX:event.velocityX,velocityY:event.velocityY});else if(null!=event.originalEvent.touches)for(ref1=event.originalEvent.touches,j=0,len1=ref1.length;j<len1;j++)pointer=ref1[j],pointers.push({x:pointer.pageX/window.innerWidth,y:pointer.pageY/window.innerHeight});else pointers.push({x:event.pageX/window.innerWidth,y:event.pageY/window.innerHeight});return pointers},TouchMotion.prototype.onTouchStart=function(event){return event.preventDefault(),this.$el.addClass("dragging"),this.isDown=!0,this.pointers=this.getEventPointers(event),this.emit("touchstart",this.pointers)},TouchMotion.prototype.onTouchMove=function(event){var obj;if(this.isDown)return this.pointers=this.getEventPointers(event),obj={pointers:this.pointers,velocityX:event.velocityX,velocityY:event.velocityY},this.emit("touchmove",obj)},TouchMotion.prototype.onTouchEnd=function(event){var obj,vx,vy;return this.isDown=!1,this.$el.removeClass("dragging"),this.pointers.length>0?(vx=this.pointers[0].velocityX,vy=this.pointers[0].velocityY):(vx=0,vy=0),obj={velocityX:vx,velocityY:vy},this.emit("touchend",obj)},TouchMotion.prototype.bind=function(){return this.mc.on("pan",this.onTouchMove),this.$el.on("touchstart",this.onTouchStart),this.$el.on("touchend",this.onTouchEnd),this.$el.on("mousedown",this.onTouchStart),this.$el.on("mouseup",this.onTouchEnd)},TouchMotion.prototype.unbind=function(){return this.mc.on("pan",this.onTouchMove),this.$el.off("touchstart",this.onTouchStart),this.$el.off("touchend",this.onTouchEnd),this.$el.off("mousedown",this.onTouchStart),this.$el.off("mouseup",this.onTouchEnd)},TouchMotion}();var Touch,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};window.Touch=Touch=function(){function Touch($element,opts){null==opts&&(opts={}),this.onTouchEnd=bind(this.onTouchEnd,this),this.onTouchMove=bind(this.onTouchMove,this),this.onTouchStart=bind(this.onTouchStart,this),Happens(this),this.settings={enableMoveWhenDown:!1},utils.merge(this.settings,opts),this.pointers=[],this.$el=$($element)}return Touch.prototype.isDown=!1,Touch.prototype.getEventPointers=function(event){var i,len,pointer,pointers,ref;if(pointers=[],null!=event.originalEvent.touches)for(ref=event.originalEvent.touches,i=0,len=ref.length;i<len;i++)pointer=ref[i],pointers.push({x:pointer.pageX/window.innerWidth,y:pointer.pageY/window.innerHeight});else pointers.push({x:event.pageX/window.innerWidth,y:event.pageY/window.innerHeight});return pointers},Touch.prototype.onTouchStart=function(event){return event.preventDefault(),this.isDown=!0,this.pointers=this.getEventPointers(event),this.emit("touchstart",this.pointers)},Touch.prototype.onTouchMove=function(event){if(!1!==this.isDown||!1!==this.settings.enableMoveWhenDown)return this.pointers=this.getEventPointers(event),this.emit("touchmove",this.pointers)},Touch.prototype.onTouchEnd=function(event){return this.isDown=!1,this.pointers=[],this.emit("touchend",this.getEventPointers(event))},Touch.prototype.bind=function(){return this.$el.on("touchstart",this.onTouchStart),this.$el.on("touchmove",this.onTouchMove),this.$el.on("touchend",this.onTouchEnd),this.$el.on("mousedown",this.onTouchStart),this.$el.on("mouseup",this.onTouchEnd),this.$el.on("mousemove",this.onTouchMove)},Touch.prototype.unbind=function(){return this.$el.off("touchstart",this.onTouchStart),this.$el.off("touchmove",this.onTouchMove),this.$el.off("touchend",this.onTouchEnd),this.$el.off("mousedown",this.onTouchStart),this.$el.off("mouseup",this.onTouchEnd),this.$el.off("mousemove",this.onTouchMove)},Touch}();var GUI;GUI=function(){function GUI(Browser){var Folder,GUIWrapper;return Folder=function(){function Folder(){}return Folder.prototype.add=function(){return this},Folder.prototype.listen=function(){return this},Folder.prototype.name=function(){return this},Folder.prototype.open=function(){return this},Folder.prototype.onChange=function(){return this},Folder.prototype.addFolder=function(){return new Folder},Folder.prototype.addColor=function(){return this},Folder}(),GUIWrapper=function(){function GUIWrapper(){}return GUIWrapper.prototype.add=function(){return this},GUIWrapper.prototype.addFolder=function(){return new Folder},GUIWrapper.prototype.name=function(){return this},GUIWrapper.prototype.close=function(){return this},GUIWrapper.prototype.step=function(){return this},GUIWrapper.prototype.onChange=function(){return this},GUIWrapper.prototype.setValue=function(){return this},GUIWrapper.prototype.listen=function(){return this},GUIWrapper.prototype.open=function(){return this},GUIWrapper.prototype.destroy=function(){return this},GUIWrapper.prototype.min=function(){return this},GUIWrapper.prototype.max=function(){return this},GUIWrapper}(),this.create=function(debug){return null==debug&&(debug=!1),new(env.DEVELOPMENT&&debug&&!Browser.device?dat.GUI:GUIWrapper)},this}return GUI}(),angular.module("app").factory("GUI",["Browser",GUI]);var Utils;window.PI=Math.PI,window.HALF_PI=.5*PI,window.QUARTER_PI=.5*HALF_PI,window.TWO_PI=2*PI,Number.prototype.map=function(in_min,in_max,out_min,out_max){return(this-in_min)*(out_max-out_min)/(in_max-in_min)+out_min},window.utils=new(Utils=function(){function Utils(){return this.distance=function(x1,x2,y1,y2){return Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))},this.distanceLinear=function(x1,x2){return Math.sqrt((x2-x1)*(x2-x1))},this.lerp=function(min,max,ratio){return min+(max-min)*ratio},this.random=function(min,max){return min+Math.random()*(max-min)},this.componentToHex=function(c){var hex;return hex=c.toString(16),1===hex.length?"0"+hex:hex},this.rgbToHex=function(r,g,b){return"#"+this.componentToHex(r)+this.componentToHex(g)+this.componentToHex(b)},this.hexToRgb=function(hex){var result;return result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex),result?[parseInt(result[1],16),parseInt(result[2],16),parseInt(result[3],16)]:null},this.formatColorForWebgl=function(hex){return"0x"+hex.toString(16)},this.formatColorForCSS=function(hex){return"#"+hex.toString(16)},this.userColorForCSS=function(hex){return hex.replace("0x","#")},this.generateUUID=function(){var d;return d=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r;return r=(d+16*Math.random())%16|0,d=Math.floor(d/16),("x"===c?r:3&r|8).toString(16)})},this.cleanRoomId=function(roomId){return null==roomId&&(roomId=""),roomId.split(":")[0]},this.merge=function(target,source){var a,l,property,sourceProperty;"object"!=typeof target&&(target={});for(property in source)if(source.hasOwnProperty(property)){if("object"==typeof(sourceProperty=source[property])){target[property]=this.merge(target[property],sourceProperty);continue}target[property]=sourceProperty}for(a=2,l=arguments.length;a<l;)this.merge(target,arguments[a]),a++;return target},this.getParameterByName=function(name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search),null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},this}return Utils}()),$.fx.step.clip=function(fx){var $elem,calcRect,ea,elem,perc,sa;elem=fx.elem,$elem=$(elem),"rect(0px, 0px, 0px, 0px)"===fx.start||0===fx.start?fx.start="rect("+parseFloat(elem.scrollTop)+", "+parseFloat(elem.scrollWidth)+", "+parseFloat(elem.scrollHeight)+", "+parseFloat(elem.scrollLeft)+")":fx.start=$elem.css("clip"),calcRect=function(pos){var arr,i,rect;for(arr=[],rect=fx[pos].slice(5).split(" "),i=0;i<rect.length;)arr.push(parseFloat(rect[i])),i++;return arr},sa=calcRect("start"),ea=calcRect("end"),perc=parseFloat(fx.pos).toFixed(4),elem.style.clip="rect("+parseFloat(perc*(ea[0]-sa[0])+sa[0])+fx.unit+", "+parseFloat(perc*(ea[1]-sa[1])+sa[1])+fx.unit+", "+parseFloat(perc*(ea[2]-sa[2])+sa[2])+fx.unit+", "+parseFloat(perc*(ea[3]-sa[3])+sa[3])+fx.unit+")"};var Window;Window=function(){function Window($window,Browser){var $$window,getOrientation,onOrientationChange,onResize,state,visibilityChange;return Happens(this),$$window=$($window),$("#header"),$("#footer"),this.width=$$window.width(),this.height=$$window.height(),getOrientation=function(){var orientationInt;return Browser.desktop?"landscape":(orientationInt=Math.abs(window.orientation)||0,0===orientationInt||180===orientationInt?"portrait":"landscape")},this.orientation=getOrientation(),onResize=function(_this){return function(event){return _this.width=$$window.width(),_this.height=$$window.height(),_this.emit("resize")}}(this),$$window.on("resize",onResize),onOrientationChange=function(_this){return function(event){return _this.orientation=getOrientation(),_this.emit("orientationchange",_this.orientation)}}(this),$$window.on("orientationchange",onOrientationChange),void 0,state=void 0,visibilityChange=void 0,void 0!==document.hidden?("hidden",visibilityChange="visibilitychange",state="visibilityState"):void 0!==document.mozHidden?("mozHidden",visibilityChange="mozvisibilitychange",state="mozVisibilityState"):void 0!==document.msHidden?("msHidden",visibilityChange="msvisibilitychange",state="msVisibilityState"):void 0!==document.webkitHidden&&("webkitHidden",visibilityChange="webkitvisibilitychange",state="webkitVisibilityState"),visibilityChange&&document.addEventListener(visibilityChange,function(_this){return function(){switch(document[state]){case"visible":return _this.emit("focused");default:return _this.emit("idle")}}}(this),!1),onResize(),this}return Window}(),angular.module("app").factory("Window",["$window","Browser",Window]);var Routes,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1};Routes=function(){function Routes($locationProvider,$routeProvider){var checkRoomDeeplink,routeProvider,universalResolves,validateBrowserFeatures;$locationProvider.html5Mode(!0),universalResolves={},routeProvider=angular.extend({},$routeProvider,{when:function(path,route){return route.resolve=route.resolve?route.resolve:{},angular.extend(route.resolve,universalResolves),$routeProvider.when(path,route),this}}),checkRoomDeeplink=function(sessionService,$location){var path,ref,roomId;return!1===sessionService.get("userHasClickedStart")&&!1===VOID_SETTINGS.DEV_DEEPLINK_TO_ROOM&&(path=$location.path().split("/"),ref=path[2],indexOf.call(env.VOID_CONFIG.rooms,ref)>=0&&(roomId=path[2]),c.debug("roomId",roomId),sessionService.set("deeplinkRoomId",roomId),$location.url("/")),!0},validateBrowserFeatures=function(BrowserTest,$location){return BrowserTest.validate()||$location.url("/computer-says-no"),!0},routeProvider.when("/dev/sandbox/:type/:id",{templateUrl:"sandbox.html",controller:"sandboxController"}).when("/computer-says-no",{templateUrl:"computer-says-no.html",controller:"computerSaysNoController",resolve:{browser:function(BrowserTest,$location){return BrowserTest.validate()&&$location.url("/"),!0}}}).when("/dev/menu",{templateUrl:"dev-menu.html",resolve:{browser:function(BrowserTest,$location){return validateBrowserFeatures(BrowserTest,$location)}}}).when("/room/:id",{templateUrl:"room.html",controller:"roomController",resolve:{browser:function(BrowserTest,$location){return validateBrowserFeatures(BrowserTest,$location)},session:function(sessionService,$location){return checkRoomDeeplink(sessionService,$location)}}}).otherwise({templateUrl:"home.html",controller:"homeController",resolve:{browser:function(BrowserTest,$location){return validateBrowserFeatures(BrowserTest,$location)}}})}return Routes}(),angular.module("app").config(["$locationProvider","$routeProvider",Routes]);var AssetLoader,BinaryLoader,GeometryLoader,ImageLoader,JSONLoader,ShaderLoader,SoundLoader,VimageLoader,XMLLoader;SoundLoader=function(){function SoundLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){return new Howl({src:[asset.url+".mp3"],onload:function(){return asset.data=this,fullfill(asset)},onloaderror:function(_this){return function(error){return console.error("Failed to load sound error",asset.url),reject(error)}}()})})},{load:load}}return SoundLoader}(),JSONLoader=function(){function JSONLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){var req;return req=$.ajax(asset.url,{type:"get"}),req.success(function(response){return asset.data=response,fullfill(asset)}),req.error(function(error){return reject(error)})})},{load:load}}return JSONLoader}(),XMLLoader=function(){function XMLLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){var req;return req=$.ajax(asset.url,{type:"get"}),req.success(function(response){return asset.data=response,fullfill(asset)}),req.error(function(error){return reject(error)})})},{load:load}}return XMLLoader}(),ShaderLoader=function(){function ShaderLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){var req;return req=$.ajax(asset.url,{type:"get"}),req.success(function(response){return asset.data=response,fullfill(asset)}),req.error(function(error){return reject(error)})})},{load:load}}return ShaderLoader}(),GeometryLoader=function(){function GeometryLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){var loader;return loader=new THREE.JSONLoader,loader.load(asset.url,function(_this){return function(geometry){return null!=geometry?(asset.data=geometry,fullfill(asset)):reject("failed to load geometry: "+asset.id)}}())})},{load:load}}return GeometryLoader}(),ImageLoader=function(){function ImageLoader($q){var load;return load=function(asset){return $q(function(fullfill,reject){var image;return image=new Image,image.onload=function(_this){return function(){return asset.data=image,fullfill(asset)}}(),image.onerror=function(_this){return function(error){return reject("Failed to load image: "+asset.url)}}(),image.src=asset.url})},{load:load}}return ImageLoader}(),BinaryLoader=function(){function BinaryLoader($q){var load;return load=function(asset){var req;return req=function(){return window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("MSXML2.XMLHTTP.3.0"):void 0},$q(function(fullfill,reject){var type,xhr;if(xhr=req(),!type){type="arraybuffer";try{Blob.prototype.slice&&(type="blob")}catch(error1){}}return xhr.open("GET",asset.url,!0),xhr.responseType=type,xhr.onprogress=function(e){},xhr.onerror=function(){return reject(xhr.status)},xhr.onreadystatechange=function(_this){return function(e){4===xhr.readyState&&(asset.data=xhr.response,fullfill(asset),xhr.onreadystatechange=null)}}(),xhr.send(null)})},{load:load}}return BinaryLoader}(),VimageLoader=function(){function VimageLoader($q,BinaryLoader){var load;return load=function(asset){return $q(function(fullfill,reject){var req;return req=$.ajax(asset.url,{type:"get"}),req.success(function(response){var i,j,loaders,path,ref,url;for(asset.data=response,path=asset.url.split("/"),path.pop(),path=path.join("/"),loaders=[],i=j=0,ref=response.total_packs;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)url=path+"/"+i+".pack",loaders.push(BinaryLoader.load({id:i,type:"pack",url:url}));return $q.all(loaders).then(function(response){return fullfill(response)},function(error){return reject(error)})}),req.error(function(error){return reject(error)})})},{load:load}}return VimageLoader}(),AssetLoader=function(){function AssetLoader($q,ImageLoader,JSONLoader,XMLLoader,GeometryLoader,VimageLoader,ShaderLoader,SoundLoader,lodash){var getAsset,load;return null,load=function(manifest){var asset,date,i,j,len,loaders;for(manifest.length,date=new Date,loaders=[],i=j=0,len=manifest.length;j<len;i=++j)switch(asset=manifest[i],asset.type){case"json":loaders.push(JSONLoader.load(asset));break;case"xml":loaders.push(XMLLoader.load(asset));break;case"image":loaders.push(ImageLoader.load(asset));break;case"geometry":loaders.push(GeometryLoader.load(asset));break;case"vimage":loaders.push(VimageLoader.load(asset));break;case"shader":loaders.push(ShaderLoader.load(asset));break;case"sound":loaders.push(SoundLoader.load(asset))}return $q(function(fullfill,reject){return $q.all(loaders).then(function(response){return c.debug("Loaded in",(new Date-date)/1e3),fullfill(response)},function(error){return reject(error)})})},getAsset=function(id,assets){return lodash.where(assets,{id:id})},{load:load,getAsset:getAsset}}return AssetLoader}(),angular.module("app").factory("SoundLoader",["$q",SoundLoader]).factory("JSONLoader",["$q",JSONLoader]).factory("XMLLoader",["$q",XMLLoader]).factory("ShaderLoader",["$q",ShaderLoader]).factory("GeometryLoader",["$q",GeometryLoader]).factory("ImageLoader",["$q",ImageLoader]).factory("BinaryLoader",["$q",BinaryLoader]).factory("VimageLoader",["$q","BinaryLoader",VimageLoader]).factory("AssetLoader",["$q","ImageLoader","JSONLoader","XMLLoader","GeometryLoader","VimageLoader","ShaderLoader","SoundLoader","lodash",AssetLoader]);var BrowserTest;BrowserTest=function(){function BrowserTest(Browser){var features,testWebAudio,testWebgl;return features=["webgl","webaudio"],testWebgl=function(){try{return!!window.WebGLRenderingContext&&!!document.createElement("canvas").getContext("experimental-webgl")}catch(error){return error,!1}},testWebAudio=function(){return void 0!==(window.AudioContext||window.webkitAudioContext)},this.validate=function(){var i,len,passed;for(passed=!0,i=0,len=features.length;i<len;i++)switch(features[i]){case"webgl":if(!(passed=testWebgl()))return;break;case"webaudio":if(!(passed=testWebAudio()))return}return passed},this}return BrowserTest}(),angular.module("app").factory("BrowserTest",["Browser",BrowserTest]);var Browser;Browser=function(){function Browser(){var md;return md=new MobileDetect(window.navigator.userAgent),this.mobile=null!==md.mobile(),this.tablet=null!==md.tablet(),this.device=!0===(this.mobile||this.tablet),this.desktop=!1===this.device,this}return Browser}(),angular.module("app").factory("Browser",[Browser]);var Cookie;Cookie=function(){function Cookie(){return window.cookie=this,this.set=function(key,value){return store.set(key,value)},this.get=function(key){return store.get(key)},this.del=function(key){return store.remove(key)},this.clear=function(){return store.clear()},this}return Cookie}(),angular.module("app").service("cookieService",[Cookie]);var Dictionary;Dictionary=function(){function Dictionary(AssetLoader,ENV,$q){var data,exists,get;return data=VOID_DATA.dictionary,exists=function(key){return null!=data[key]},get=function(key){return null!=data?exists(key)?data[key][0]:"Dictionary ["+key+"] field doesn't exist.":"Dictionary ["+key+"] not loaded"},{get:get,exists:exists}}return Dictionary}(),angular.module("app").service("dictionaryService",["AssetLoader","ENV","$q",Dictionary]);var Geolocation;Geolocation=function(){function Geolocation($q){var _hasSharedlocation,_location,debug,radians,testLocation;return debug=!1,testLocation={coords:{latitude:51.5265273,longitude:-.0821902}},_hasSharedlocation=!1,_location=null,this.request=function(){return $q(function(fullfill,reject){var handleError,showPosition;return VOID_SETTINGS.DEV_FAST_TRANSITION_TO_MENU&&(_location={lat:0,lng:0},fullfill()),showPosition=function(position){return _hasSharedlocation=!0,_location={lat:position.coords.latitude,lng:position.coords.longitude},fullfill(position)},handleError=function(error){var message;switch(message="",error.code){case error.PERMISSION_DENIED:message="User denied the request for Geolocation.";break;case error.POSITION_UNAVAILABLE:message="Location information is unavailable.";break;case error.TIMEOUT:message="The request to get user location timed out.";break;case error.UNKNOWN_ERROR:message="An unknown error occurred."}return reject(message)},debug?fullfill(testLocation):navigator.geolocation?navigator.geolocation.getCurrentPosition(showPosition,handleError,{enableHighAccuracy:!0,timeout:5e3,maximumAge:0}):reject("Geolocation not supported by browser")})},this.get=function(){return _location},this.hasSharedlocation=function(){return _hasSharedlocation},radians=function(x){return x*Math.PI/180},this.computeDistanceBetween=function(p1,p2){var R,a,c,dLat,dLong;return R=6378137,dLat=radians(p2.lat-p1.lat),dLong=radians(p2.lng-p1.lng),a=Math.sin(dLat/2)*Math.sin(dLat/2)+Math.cos(radians(p1.lat))*Math.cos(radians(p2.lat))*Math.sin(dLong/2)*Math.sin(dLong/2),c=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)),R*c},function(_this){return function(){return googleMapsLoaderService.then(function(){var location1,location2;return location1={lat:51.5265273,lng:-.0821902},location2={lat:51.5412621,lng:-.08813879999999999},c.log("with google method"),c.log(google.maps.geometry.spherical.computeDistanceBetween(new google.maps.LatLng(location1.lat,location1.lng),new google.maps.LatLng(location2.lat,location2.lng))),c.log("with other method"),c.log(_this.computeDistanceBetween(location1,location2))})}}(this),this}return Geolocation}(),angular.module("app").service("geolocationService",["$q",Geolocation]);var GoogleMapsLoader;GoogleMapsLoader=function(){function GoogleMapsLoader($window,$q){var deferred,loadScript;return deferred=$q.defer(),loadScript=function(){var script;return script=document.createElement("script"),script.src="https://web.archive.org/web/20200308171819/http://maps.googleapis.com/maps/api/js?sensor=false&language=en&libraries=geometry&callback=initMap",document.body.appendChild(script)},$window.initMap=function(){return deferred.resolve()},loadScript(),deferred.promise}return GoogleMapsLoader}(),angular.module("app").service("googleMapsLoaderService",["$window","$q",GoogleMapsLoader]);var MediaQuery;MediaQuery=function(){function MediaQuery(Window){var onResize;return this.mobile=!1,this.tablet=!1,this.desktop=!1,onResize=function(_this){return function(){return _this.mobile=!1,_this.tablet=!1,_this.desktop=!1,Window.width<600?_this.mobile=!0:Window.width<1200?_this.tablet=!0:_this.desktop=!0}}(this),onResize(),Window.on("resize",onResize),this}return MediaQuery}(),angular.module("app").service("mediaQueryService",["Window",MediaQuery]);var Rooms;Rooms=function(){function Rooms($rootScope,lodash,GUI,socketService){var folder,gui,i,j,len,len1,onUpdate,ref,room,rooms;for(rooms=[],ref=env.VOID_CONFIG.rooms,i=0,len=ref.length;i<len;i++)room=ref[i],rooms.push({roomId:room,count:0});for(this.get=function(){return rooms},this.getRoomIds=function(){var ids,j,len1;for(ids=[],j=0,len1=rooms.length;j<len1;j++)room=rooms[j],ids.push(room.roomId);return ids},gui=GUI.create(!1),gui=gui.addFolder("rooms"),gui.open(),j=0,len1=rooms.length;j<len1;j++)room=rooms[j],folder=gui.addFolder(room.roomId),folder.add(room,"count").listen(),folder.open();return onUpdate=function($event,data){var ref1,results,roomId,roomIdFull;ref1=data.rooms,results=[];for(roomIdFull in ref1)data=ref1[roomIdFull],roomId=roomIdFull.split(":")[0],results.push(lodash.find(rooms,{roomId:roomId}).count=data.count);return results},$rootScope.$on("rooms.update",onUpdate),this}return Rooms}(),angular.module("app").service("roomsService",["$rootScope","lodash","GUI","socketService",Rooms]);var Session;Session=function(){function Session($rootScope,Browser){var data;return data={userHasClickedStart:!1,deeplinkRoomId:null,konami:!1,konamiPath:""},data.konami="time"===utils.getParameterByName("konami"),data.konamiPath=data.konami?"_konami/":"",data.userHasClickedStart=VOID_SETTINGS.DEV_DEEPLINK_TO_ROOM,this.set=function(key,val){return key in data?data[key]=val:c.warn("SessionService::set "+key+" not defined in data")},this.get=function(key){return key in data?data[key]:c.warn("SessionService::get "+key+" not defined in data")},this}return Session}(),angular.module("app").service("sessionService",["$rootScope","Browser",Session]);var Share,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Share=function(){function Share(){this.twitter=bind(this.twitter,this),this.facebook=bind(this.facebook,this),this.google=bind(this.google,this),this.open_window=bind(this.open_window,this),this.url=window.location.href}return Share.prototype.open_window=function(url,w,h){var left,top;return left=screen.availWidth-w>>1,top=screen.availHeight-h>>1,window.open(url,"","top="+top+",left="+left+",width="+w+",height="+h+",location=no,menubar=no"),!1},Share.prototype.google=function(url){return url=encodeURIComponent(url||this.url),this.open_window("https://web.archive.org/web/20200308171819/https://plus.google.com/share?url="+url,650,385),!1},Share.prototype.facebook=function(url,copy){var decsr;return null==copy&&(copy=""),url=encodeURIComponent(url||this.url),decsr=encodeURIComponent(copy),this.open_window("https://web.archive.org/web/20200308171819/http://www.facebook.com/share.php?u="+url+"&t="+decsr,600,300),!1},Share.prototype.twitter=function(url,copy){var descr;return null==copy&&(copy=""),url=encodeURIComponent(url||this.url),""===copy&&(copy="Generic share text here!"),descr=encodeURIComponent(copy),this.open_window("https://web.archive.org/web/20200308171819/http://twitter.com/intent/tweet/?text="+descr+"&url="+url,600,300),!1},Share}(),angular.module("app").service("shareService",[Share]);var Socket,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++)if(i in this&&this[i]===item)return i;return-1}
;Socket=function(){function Socket($rootScope,$timeout,sessionService,geolocationService,BrowserTest,lodash,ENV,GUI,$q){var color,colorFolder,colorPresetKeys,connect,deformatHexColor,folder,formatHexColor,gui,joinRoomFromDeeplink,onSocketDisconnect,results,socket;return socket=null,connect=function(){if(c.log("connecting..."),socket=io.connect(ENV.SOCKET_ADDR),socket.connected)return c.log("connected")},connect(),onSocketDisconnect=function(){return c.log("socket disconnected"),c.log("reconnecting...")},socket.on("disconnect",onSocketDisconnect),this.clientId="",this.actionUUIDs=[],color=lodash.shuffle(VOID_SETTINGS.COLORS)[0],this.clientColor={user:color.user,ambient:color.ambient,directional:color.directional},this.colorPreset="",colorPresetKeys=function(){results=[];for(var i=0,ref=VOID_SETTINGS.COLORS.length;0<=ref?i<ref:i>ref;0<=ref?i++:i--)results.push(i);return results}.apply(this),Object.observe(this.clientColor,function(_this){return function(changes){return $rootScope.$emit("socket.clientcolor.change",{ambientColor:_this.clientColor.ambient,directionalColor:_this.clientColor.directional,userColor:_this.clientColor.user,oldUserColor:changes.oldValue})}}(this)),this.roomId="",this.isRegistered=!1,formatHexColor=function(hexInt){return utils.componentToHex(hexInt)},deformatHexColor=function(hexString){var hex;return hex=parseInt(hexString.replace(/^#/,""),16),"0x"+hex.toString(16)},this.pushUserInteractionStartEvent=function(pointers,roomData){var uuid;return null==roomData&&(roomData={}),uuid=utils.generateUUID(),this.actionUUIDs.push(uuid),env.PRODUCTION&&ga("send","event","Room","userActionStartEvent",utils.cleanRoomId(""+this.roomId),pointers.length),socket.emit("user.interaction.start",{pointers:pointers,clientId:this.clientId,clientColor:formatHexColor(this.clientColor.user),clientGeolocation:geolocationService.get(),roomId:this.roomId,uuid:uuid,roomData:roomData})},this.pushUserInteractionEvent=function(pointers,roomData){var uuid;return null==roomData&&(roomData={}),uuid=this.actionUUIDs[this.actionUUIDs.length-1],socket.emit("user.interaction",{pointers:pointers,clientId:this.clientId,clientColor:formatHexColor(this.clientColor.user),clientGeolocation:geolocationService.get(),roomId:this.roomId,uuid:uuid,roomData:roomData})},this.pushUserInteractionEndEvent=function(pointers,roomData){var uuid;return null==pointers&&(pointers=[]),null==roomData&&(roomData={}),uuid=this.actionUUIDs[this.actionUUIDs.length-1],socket.emit("user.interaction.end",{pointers:pointers,clientId:this.clientId,clientGeolocation:geolocationService.get(),roomId:this.roomId,uuid:uuid,roomData:roomData}),this.actionUUIDs.shift()},this.joinRoom=function(roomId){return c.log("joinRoom",roomId),socket.emit("room.join",{roomId:roomId,clientGeolocation:geolocationService.get()})},this.leaveRoom=function(){return c.log("leaveRoom",this.roomId),socket.emit("room.leave",{roomId:this.roomId,clientGeolocation:geolocationService.get()})},this.onSocketMessage=function(_this){return function(data){return _this.clientId=data,_this.isRegistered=!0}}(this),socket.on("message",this.onSocketMessage),this.onSocketData=function(data){return c.log("onSocketData",data)},socket.on("data",this.onSocketData),this.onRoomsUpdate=function(data){return $rootScope.$broadcast("rooms.update",data)},socket.on("rooms.update",this.onRoomsUpdate),this.onRoomJoined=function(_this){return function(data){return c.log("onRoomJoined",data),_this.roomId=data.roomId,$rootScope.$broadcast("room.joined",data)}}(this),socket.on("room.joined",this.onRoomJoined),this.onRoomLeft=function(_this){return function(data){return c.log("onRoomLeft",data),_this.roomId=data.roomId,$rootScope.$broadcast("room.left",data)}}(this),socket.on("room.left",this.onRoomLeft),this.onUserRoomJoined=function(_this){return function(data){return c.log("onUserRoomJoined",data),$rootScope.$broadcast("user.room.joined",data)}}(),socket.on("user.room.joined",this.onRoomJoined),this.onUserRoomLeft=function(_this){return function(data){return c.log("onUserRoomLeft",data),$rootScope.$broadcast("user.room.left",data)}}(),socket.on("user.room.left",this.onRoomLeft),this.onUserInteractionStartEvent=function(_this){return function(data){return data.clientColor=deformatHexColor(data.clientColor),geolocationService.hasSharedlocation()?null!==data.clientGeolocation&&geolocationService.computeDistanceBetween(geolocationService.get(),data.clientGeolocation)<=VOID_SETTINGS.LOCATION_RADIUS?$rootScope.$broadcast("user.interaction.start",data):void 0:$rootScope.$broadcast("user.interaction.start",data)}}(),socket.on("user.interaction.start",this.onUserInteractionStartEvent),this.onUserInteractionEvent=function(_this){return function(data){var distanceKm;return data.clientColor=deformatHexColor(data.clientColor),geolocationService.hasSharedlocation()?null!==data.clientGeolocation&&(distanceKm=geolocationService.computeDistanceBetween(geolocationService.get(),data.clientGeolocation),c.log("distanceKm",distanceKm),distanceKm<=VOID_SETTINGS.LOCATION_RADIUS)?$rootScope.$broadcast("user.interaction",data):void 0:$rootScope.$broadcast("user.interaction",data)}}(),socket.on("user.interaction",this.onUserInteractionEvent),this.onUserInteractionEndEvent=function(_this){return function(data){var distanceKm;return geolocationService.hasSharedlocation()?null!==data.clientGeolocation&&(distanceKm=geolocationService.computeDistanceBetween(geolocationService.get(),data.clientGeolocation),c.log("distanceKm",distanceKm),distanceKm<=VOID_SETTINGS.LOCATION_RADIUS)?$rootScope.$broadcast("user.interaction.end",data):void 0:$rootScope.$broadcast("user.interaction.end",data)}}(),socket.on("user.interaction.end",this.onUserInteractionEndEvent),this.setClientColor=function(colorIndex){return color=VOID_SETTINGS.COLORS[colorIndex],this.clientColor.user=color.user,this.clientColor.ambient=color.ambient,this.clientColor.directional=color.directional},joinRoomFromDeeplink=function(_this){return function(){var path,ref1;if(path=window.location.pathname.split("/"),ref1=path[2],indexOf.call(env.VOID_CONFIG.rooms,ref1)>=0)return _this.joinRoom(path[2])}}(this),VOID_SETTINGS.DEV_DEEPLINK_TO_ROOM&&joinRoomFromDeeplink(),gui=GUI.create(!0),folder=gui.addFolder("client"),folder.open(),folder.add(this,"clientId").listen(),folder.add(this,"roomId").listen(),colorFolder=folder.addFolder("color"),colorFolder.open(),colorFolder.addColor(this.clientColor,"user").listen(),colorFolder.addColor(this.clientColor,"ambient").listen(),colorFolder.addColor(this.clientColor,"directional").listen(),colorFolder.add(this,"colorPreset",colorPresetKeys).onChange(function(_this){return function(val){return _this.setClientColor(Number(val))}}(this)),this}return Socket}(),angular.module("app").service("socketService",["$rootScope","$timeout","sessionService","geolocationService","BrowserTest","lodash","ENV","GUI","$q",Socket]),window.ClientPointers=function(){function _Class(Scene,opts){var container,geometry,j,material,mesh,ref;for(null==opts&&(opts={}),this.settings={scale:1,depth:5,intensity:5,lightDistance:100,visible:!1},utils.merge(this.settings,opts),this.points=[],this.pointers=[],this.totalPointers=0,container=new THREE.Object3D,this.pointlight=new THREE.PointLight(16777215,0,this.settings.lightDistance),this.pointlight.position.set(1,1,this.settings.depth),Scene.add(this.pointlight),j=0,ref=VOID_SETTINGS.MAX_POINTERS;0<=ref?j<ref:j>ref;0<=ref?++j:--j)geometry=new THREE.SphereGeometry(1,16,16),material=new THREE.MeshBasicMaterial({color:16777215}),mesh=new THREE.Mesh(geometry,material),mesh.visible=!1,mesh.scale.set(this.settings.scale,this.settings.scale,this.settings.scale),this.points.push(mesh),container.add(mesh);Scene.add(container)}return _Class.prototype.debug=!1,_Class.prototype.onTouchStart=function(pointers1){var i,j,point,ref;for(this.pointers=pointers1,this.totalPointers++,this.device||(this.totalPointers=Math.min(this.totalPointers,1)),i=j=0,ref=this.pointers.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)point=this.pointers[i],this.points[i].visible=this.settings.visible||this.debug,this.points[i].position.set(point.x,point.y,this.settings.depth);return point=this.points[0].position,this.pointlight.position.set(point.x,point.y,this.settings.depth),TweenMax.killTweensOf(this.pointlight),TweenMax.to(this.pointlight,.25,{intensity:this.settings.intensity})},_Class.prototype.onTouchMove=function(pointers1){var i,j,point,ref;for(this.pointers=pointers1,i=j=0,ref=this.pointers.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)point=this.pointers[i],this.points[i].visible=this.settings.visible||this.debug,this.points[i].position.set(point.x,point.y,this.settings.depth);return point=this.points[0].position,this.pointlight.position.set(point.x,point.y,this.settings.depth)},_Class.prototype.onTouchEnd=function(pointers){var i,j,len,point,ref;for(this.totalPointers=pointers.length,c.log("onTouchEnd",this.totalPointers),this.device||(this.totalPointers=0),ref=this.points,i=j=0,len=ref.length;j<len;i=++j)point=ref[i],point.visible=!1;return TweenMax.killTweensOf(this.pointlight),TweenMax.to(this.pointlight,.5,{intensity:0})},_Class}(),window.ConnectionPointers=function(){function _Class(Scene,scale,depth,lightDistance){var container,geometry,j,material,mesh,ref;for(null==scale&&(scale=1),this.depth=null!=depth?depth:5,this.lightDistance=null!=lightDistance?lightDistance:100,this.points=[],container=new THREE.Object3D,this.pointlight=new THREE.PointLight(16777215,0,this.lightDistance),this.pointlight.position.set(1,1,this.depth),Scene.add(this.pointlight),j=0,ref=VOID_SETTINGS.MAX_POINTERS;0<=ref?j<ref:j>ref;0<=ref?++j:--j)geometry=new THREE.SphereGeometry(1,16,16),material=new THREE.MeshBasicMaterial({color:16777215}),mesh=new THREE.Mesh(geometry,material),mesh.visible=!1,mesh.scale.set(scale,scale,scale),this.points.push(mesh),container.add(mesh);Scene.add(container)}return _Class.prototype.onTouch=function(pointers,clientColor){var i,j,point,ref;for(i=j=0,ref=pointers.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)point=pointers[i],this.points[i].material.color.setHex(clientColor),this.points[i].position.set(point.x,point.y,this.depth);return point=this.points[0].position,this.pointlight.position.set(point.x,point.y,this.depth),TweenMax.killTweensOf(this.pointlight)},_Class.prototype.onTouchEnd=function(){var j,len,point,ref;for(ref=this.points,j=0,len=ref.length;j<len;j++)point=ref[j],point.visible=!1;return TweenMax.killTweensOf(this.pointlight)},_Class}();var WebGLText;window.WebGLText=WebGLText=function(){function WebGLText(){}return WebGLText.prototype.create=function(_settings){var geometry,j,len1,material,ref,settings,v;for(settings={text:"x",size:80,height:10,curve_segments:2,font:"Montserrat",color:16777215},utils.merge(settings,_settings),geometry=new THREE.TextGeometry(settings.text,{size:settings.size,height:settings.height,curveSegments:settings.curve_segments,font:settings.font}),geometry.computeBoundingBox(),ref=geometry.vertices,j=0,len1=ref.length;j<len1;j++)v=ref[j],v.x+=-.5*(geometry.boundingBox.max.x-geometry.boundingBox.min.x);return material=new THREE.MeshBasicMaterial({color:settings.color,transparent:!0}),new THREE.Mesh(geometry,material)},WebGLText.prototype.create_multichar=function(_settings){var char,geometry,i,j,k,len,len1,material,mesh,meshes,offset_x,ref,ref1,settings,v;for(settings={text:"x",size:80,height:10,line_height:160,curve_segments:2,font:"montserrat",color:16777215},utils.merge(settings,_settings),len=settings.text.length,meshes=[],offset_x=len*settings.size/2-settings.size/2,i=j=0,ref=len;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j){for(char=settings.text.charAt(i),geometry=new THREE.TextGeometry(char,{size:settings.size,height:settings.height,curveSegments:settings.curve_segments,font:settings.font}),geometry.computeBoundingBox(),ref1=geometry.vertices,k=0,len1=ref1.length;k<len1;k++)v=ref1[k],v.x+=-.5*(geometry.boundingBox.max.x-geometry.boundingBox.min.x),v.y+=-.5*(geometry.boundingBox.max.y-geometry.boundingBox.min.y);material=new THREE.MeshLambertMaterial({color:settings.color,transparent:!0}),mesh=new THREE.Mesh(geometry,material),mesh.position.x=i*settings.size-offset_x,mesh.name=char,meshes.push(mesh)}return meshes},WebGLText.prototype.create_multiline=function(_settings){var geom,geometry,i,j,k,len1,len2,line,lines,material,ref,settings,v;for(settings={text:"x",size:80,height:10,line_height:160,curve_segments:2,font:"montserrat",color:16777215},utils.merge(settings,_settings),lines=settings.text.split("\\n"),geometry=new THREE.Geometry,i=j=0,len1=lines.length;j<len1;i=++j){for(line=lines[i],geom=new THREE.TextGeometry(line,{size:settings.size,height:settings.height,curveSegments:settings.curve_segments,font:settings.font}),geom.computeBoundingBox(),ref=geom.vertices,k=0,len2=ref.length;k<len2;k++)v=ref[k],v.x+=-.5*(geom.boundingBox.max.x-geom.boundingBox.min.x),v.y-=i*settings.line_height;geometry.merge(geom)}return material=new THREE.MeshBasicMaterial({color:settings.color,transparent:!0}),new THREE.Mesh(geometry,material)},WebGLText}();var IntroductionVisual,LetterHitTest;LetterHitTest=function(){function LetterHitTest(name1,mesh1){this.name=name1,this.mesh=mesh1,Happens(this),this.raycaster=new THREE.Raycaster,this.mouse=new THREE.Vector3(0,0,.5),this.isOver=!1}return LetterHitTest.prototype.intersectOver=function(camera,pointers){var i,intersects,j,len,pointer,results;for(results=[],i=j=0,len=pointers.length;j<len;i=++j)pointer=pointers[i],this.mouse.x=2*pointer.x-1,this.mouse.y=2*-pointer.y+1,this.raycaster.setFromCamera(this.mouse,camera),intersects=this.raycaster.intersectObject(this.mesh),intersects.length>0?(!1===this.isOver&&this.emit("over",this.name),results.push(this.isOver=!0)):(this.isOver&&this.emit("out",this.name),results.push(this.isOver=!1));return results},LetterHitTest.prototype.intersectClick=function(camera,pointers){var i,intersects,j,len,pointer,results;for(results=[],i=j=0,len=pointers.length;j<len;i=++j)pointer=pointers[i],this.mouse.x=2*pointer.x-1,this.mouse.y=2*-pointer.y+1,this.raycaster.setFromCamera(this.mouse,camera),intersects=this.raycaster.intersectObject(this.mesh),intersects.length>0?results.push(this.emit("click",this.name)):results.push(void 0);return results},LetterHitTest}(),IntroductionVisual=function(){function IntroductionVisual($rootScope,$timeout,AssetLoader,GUI,lodash,Window,Browser,socketService,sessionService,BrowserTest){return{restrict:"E",link:function($scope,$element,attrs){var $$element,$background,ANIMATE_IN_TEXT_COMPLETE,DESTROY,_render,addKonamiPasses,ambLight,ambiantColor,animateIn,animateOut,assets,cameras,changeLetterColor,composer,controls,destroy,destroySounds,dirColor,dirLight,folder,font,geometry,gui,helperAxis,helperCamera,helperGrid,hittestContainer,hittestMesh,i,j,konamiPath,len,letterContainer,letterData,letterHitTest,letterHitTests,letterMeshes,letters,lettersFolder,lightFolder,lights,material,mesh,noiseFolder,noiseSettings,onLetterClick,onLetterOut,onLetterOver,onOrientationChange,onResize,onTouchMove,onTouchStart,passes,password,passwordPercent,position,range,render,renderer,result,rotation,scene,settings,size,sounds,text3d,textContainer,textContainerPosition,touch,update,updateLights,zoom;if($$element=$element,$background=$(".background-tint"),$("#menu"),BrowserTest.validate()){for(DESTROY=!1,ANIMATE_IN_TEXT_COMPLETE=!1,sounds={},VOID_SETTINGS.SOUND_ENABLED?(konamiPath=sessionService.get("konamiPath"),assets=[{id:"V",url:"/sounds/introduction/"+konamiPath+"v",type:"sound"},{id:"O",url:"/sounds/introduction/"+konamiPath+"o",type:"sound"},{id:"I",url:"/sounds/introduction/"+konamiPath+"i",type:"sound"},{id:"D",url:"/sounds/introduction/"+konamiPath+"d",type:"sound"},{id:"Vclick",url:"/sounds/introduction/"+konamiPath+"v-click",type:"sound"},{id:"Oclick",url:"/sounds/introduction/"+konamiPath+"o-click",type:"sound"},{id:"Iclick",url:"/sounds/introduction/"+konamiPath+"i-click",type:"sound"},{id:"Dclick",url:"/sounds/introduction/"+konamiPath+"d-click",type:"sound"},{id:"pass",url:"/sounds/introduction/"+konamiPath+"pass",type:"sound"}],sessionService.get("konami")&&Browser.desktop&&assets.push({id:"20th",url:"/sounds/introduction/"+konamiPath+"20th",type:"sound"}),AssetLoader.load(assets).then(function(_assets){var j,len,sound;for(j=0,len=_assets.length;j<len;j++)sound=_assets[j],sounds[sound.id]=sound.data;return sounds.V.volume(0),sounds.O.volume(0),sounds.I.volume(0),sounds.D.volume(0),sounds.Vclick.volume(.5),sounds.Oclick.volume(.5),sounds.Iclick.volume(.5),sounds.Dclick.volume(.5),sounds.V.loop(!0),sounds.O.loop(!0),sounds.I.loop(!0),sounds.D.loop(!0),sounds.V.play(),sounds.O.play(),sounds.I.play(),sounds.D.play(),$rootScope.$emit("loading.hide"),animateIn()})):c.log("no sound"),gui=new GUI.create(!1),settings={debug:!1,showHelpers:!1},gui.add(settings,"debug"),cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.PerspectiveCamera(75,Window.width/Window.height,.1,1e5)},cameras.user.position.set(0,0,400),renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),composer=new WAGNER.Composer(renderer,{useRGBA:!0}),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),$element[0].appendChild(renderer.domElement),passes=[],addKonamiPasses=function(){var j,k,len,len1,param,pass,passConfig,ref,ref1;for(ref=VOID_SETTINGS.KONAMI.PASSES,j=0,len=ref.length;j<len;j++){for(passConfig=ref[j],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,k=0,len1=ref1.length;k<len1;k++)param=ref1[k],pass.params[param.id]=param.value;passes.push(pass)}return["halftone"]},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,scene.fog=new THREE.FogExp2(0,1e-4),folder=gui.addFolder("fog"),gui.add(scene.fog,"density",0,.01),folder.open(),helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&(scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),ambiantColor=(new THREE.Color).setHex(socketService.clientColor.ambient),dirColor=(new THREE.Color).setHex(socketService.clientColor.directional),lights={ambient:{color:ambiantColor},directional:{color:dirColor}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.PointLight(lights.directional.color,1),dirLight.position.set(0,0,1e3),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),updateLights=function(){return ambLight.color.setHex(String(lights.ambient.color).replace("#","0x")),dirLight.color.setHex(String(lights.directional.color).replace("#","0x"))},lightFolder.addColor(lights.ambient,"color").name("ambient").onChange(updateLights),lightFolder.addColor(lights.directional,"color").name("directional").onChange(updateLights),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),password={V:!1,O:!1,I:!1,D:!1},passwordPercent=0,noiseSettings={radius:7,speed:.005,hoverRadius:100,hoverSpeed:.01},noiseFolder=gui.addFolder("noise"),noiseFolder.add(noiseSettings,"radius",0,40),noiseFolder.add(noiseSettings,"speed",0,.1),noiseFolder.add(noiseSettings,"hoverRadius",0,1e3),noiseFolder.add(noiseSettings,"hoverSpeed",0,.1),noiseFolder.open(),letters={V:null,O:null,I:null,D:null},textContainer=new THREE.Object3D,textContainerPosition={landscape:[0,29,250],portrait:[0,60,250]},textContainer.position.fromArray(textContainerPosition[Window.orientation]),scene.add(textContainer),range=500,folder=gui.addFolder("text container"),folder.add(textContainer.position,"x",-range,range),folder.add(textContainer.position,"y",-range,range),folder.add(textContainer.position,"z",-range,range),folder.open(),letterData=[{id:"V",hover:0,hittest:{position:new THREE.Vector3(0,0,0),size:{width:48,height:50}},transitionIn:{landscape:{start:{position:new THREE.Vector3(0,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0)}},portrait:{start:{position:new THREE.Vector3(50,60,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(50,0,0),rotation:new THREE.Vector3(0,0,0)}}},transitionOut:{landscape:{end:{position:new THREE.Vector3(-150,0,150),rotation:new THREE.Vector3(0,0,-200)}},portrait:{end:{position:new THREE.Vector3(50,0,150),rotation:new THREE.Vector3(0,0,0)}}},noise:{x:{x:0,y:0,vector:utils.random(-1,1)},y:{x:0,y:0,vector:utils.random(-1,1)},z:{x:0,y:0,vector:utils.random(-1,1)}}},{id:"O",hover:0,hittest:{position:new THREE.Vector3(5,0,0),size:{width:50,height:50}},transitionIn:{landscape:{start:{position:new THREE.Vector3(0,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0)}},portrait:{start:{position:new THREE.Vector3(43,60,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(43,0,0),rotation:new THREE.Vector3(0,0,0)}}},transitionOut:{landscape:{end:{position:new THREE.Vector3(-50,0,150),rotation:new THREE.Vector3(0,0,0)}},portrait:{end:{position:new THREE.Vector3(43,0,150),rotation:new THREE.Vector3(0,0,0)}}},noise:{x:{x:0,y:0,vector:utils.random(-1,1)},y:{x:0,y:0,vector:utils.random(-1,1)},z:{x:0,y:0,vector:utils.random(-1,1)}}},{id:"I",hover:0,hittest:{position:new THREE.Vector3(6,0,0),size:{width:30,height:50}},transitionIn:{landscape:{start:{position:new THREE.Vector3(0,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0)}},portrait:{start:{position:new THREE.Vector3(-59,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(-59,-58,0),rotation:new THREE.Vector3(0,0,0)}}},transitionOut:{landscape:{end:{position:new THREE.Vector3(50,0,150),rotation:new THREE.Vector3(0,0,0)}},portrait:{end:{position:new THREE.Vector3(-59,-60,150),rotation:new THREE.Vector3(0,0,0)}}},noise:{x:{x:0,y:0,vector:utils.random(-1,1)},y:{x:0,y:0,vector:utils.random(-1,1)},z:{x:0,y:0,vector:utils.random(-1,1)}}},{id:"D",hover:0,hittest:{position:new THREE.Vector3(5,0,0),size:{width:50,height:50}},transitionIn:{landscape:{start:{position:new THREE.Vector3(0,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(0,0,0),rotation:new THREE.Vector3(0,0,0)}},portrait:{start:{position:new THREE.Vector3(-59,0,150),rotation:new THREE.Vector3(0,0,0)},end:{position:new THREE.Vector3(-59,-58,0),rotation:new THREE.Vector3(0,0,0)}}},transitionOut:{landscape:{end:{position:new THREE.Vector3(150,0,150),rotation:new THREE.Vector3(0,0,0)}},portrait:{end:{position:new THREE.Vector3(-59,-60,150),rotation:new THREE.Vector3(0,0,0)}}},noise:{x:{x:0,y:0,vector:utils.random(-1,1)},y:{x:0,y:0,vector:utils.random(-1,1)},z:{x:0,y:0,vector:utils.random(-1,1)}}}],text3d=new WebGLText,font=sessionService.get("konami")?"Comic Sans MS":"montserrat",letterHitTests=[],letterMeshes=text3d.create_multichar({text:"VOID",size:50,curve_segments:10,font:font}),result=!1,lettersFolder=gui.addFolder("letters"),onLetterOver=function(name){var obj;if(!password[name])return $element.addClass("hover"),c.log("over name",name),obj=lodash.find(letterData,{id:name}),TweenMax.killTweensOf(obj),TweenMax.to(obj,1,{hover:1}),c.log("name",name),TweenMax.to(sounds[name],3,{volume:.35}),TweenMax.to($background,3,{opacity:0})},onLetterOut=function(name){var obj;if($element.removeClass("hover"),c.log("out name",name),obj=lodash.find(letterData,{id:name}),TweenMax.killTweensOf(obj),TweenMax.killTweensOf(sounds[name]),TweenMax.to(obj,1,{hover:0}),TweenMax.to(sounds[name],3,{volume:0}),!result)return TweenMax.to($background,1.5,{opacity:.7})},onLetterClick=function(name){if(!password[name])return sounds[name+"click"].play(),changeLetterColor(letters[name])},i=j=0,len=letterMeshes.length;j<len;i=++j)mesh=letterMeshes[i],mesh.position._default=new THREE.Vector3(mesh.position.x,mesh.position.y,mesh.position.z),letters[Object.keys(letters)[i]]=mesh,scene.add(mesh),rotation=letterData[i].transitionIn[Window.orientation].start.rotation,letterContainer=new THREE.Object3D,letterContainer.position.copy(letterData[i].transitionIn[Window.orientation].start.position),mesh.rotation.set(rotation.x,rotation.y,rotation.z),letterContainer.add(mesh),folder=lettersFolder.addFolder("letter-"+mesh.name),folder.add(letterContainer.position,"x",-range,range),folder.add(letterContainer.position,"y",-range,range),folder.add(letterContainer.position,"z",-range,range),folder.open(),textContainer.add(letterContainer),hittestContainer=new THREE.Object3D,letterContainer.add(hittestContainer),size=letterData[i].hittest.size,position=letterData[i].hittest.position,geometry=new THREE.PlaneBufferGeometry(size.width,size.height),material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:!0,transparent:!0,opacity:0}),hittestMesh=new THREE.Mesh(geometry,material),hittestMesh.name=mesh.name,hittestMesh.position.copy(mesh.position),hittestContainer.add(hittestMesh),letterHitTest=new LetterHitTest(mesh.name,hittestMesh),letterHitTest.on("click",onLetterClick),letterHitTest.on("over",onLetterOver),letterHitTest.on("out",onLetterOut),letterHitTests.push(letterHitTest),folder=lettersFolder.addFolder("hittest-"+mesh.name),folder.add(hittestContainer.position,"x",-range,range),folder.add(hittestContainer.position,"y",-range,range),folder.add(hittestContainer.position,"z",-range,range),folder.open();return new THREE.Raycaster,new THREE.Vector3(0,0,.5),onTouchMove=function(pointers){var k,len1,results;for(results=[],k=0,len1=letterHitTests.length;k<len1;k++)letterHitTest=letterHitTests[k],results.push(letterHitTest.intersectOver(cameras.user,pointers));return results},onTouchStart=function(pointers){var k,len1,results;for(results=[],k=0,len1=letterHitTests.length;k<len1;k++)letterHitTest=letterHitTests[k],results.push(letterHitTest.intersectClick(cameras.user,pointers));return results},touch=new Touch($element,{enableMoveWhenDown:!0}),touch.bind(),touch.on("touchmove",onTouchMove),touch.on("touchstart",onTouchStart),changeLetterColor=function(currentHitMesh){var color,key,lastValue,letter,percent,tween,userColor;if(!password[currentHitMesh.name]){letter=letters[currentHitMesh.name],userColor=(new THREE.Color).setHex(socketService.clientColor.user),color=(new THREE.Color).setHex(letter.material.color.getHex()),tween={val:0},TweenMax.to(tween,1,{val:1,onUpdate:function(){return color.lerp(userColor,tween.val),letter.material.color.setHex(color.getHex())}}),lastValue=password[currentHitMesh.name],password[currentHitMesh.name]=!0,password[currentHitMesh.name]!==lastValue&&(passwordPercent++,percent=passwordPercent/Object.keys(password).length,$rootScope.$emit("introduction.password.update",percent)),result=!0;for(key in password)if(!1===password[key]){result=!1;break}return result?(sounds.pass.play(),animateOut()):void 0}},animateIn=function(){var FAST_ANIMATE_IN,FOG_DURATION,TEXT_DELAY,TEXT_DURATION,obj,tweenVector;if(FAST_ANIMATE_IN=!1,TEXT_DURATION=FAST_ANIMATE_IN?.1:10,FOG_DURATION=FAST_ANIMATE_IN?.1:10,TEXT_DELAY=FAST_ANIMATE_IN?.1:1e3,TweenMax.to($background,5,{opacity:.7,delay:4}),tweenVector=new THREE.Vector3,obj={alpha:0},TweenMax.to(obj,TEXT_DURATION,{alpha:1,delay:1,onUpdate:function(){var end,k,len1,letter,ref,results,start;for(textContainer.position.fromArray(textContainerPosition[Window.orientation]),ref=textContainer.children,results=[],i=k=0,len1=ref.length;k<len1;i=++k)letter=ref[i],start=letterData[i].transitionIn[Window.orientation].start.position,end=letterData[i].transitionIn[Window.orientation].end.position,tweenVector.lerpVectors(start,end,obj.alpha),results.push(letter.position.set(tweenVector.x,tweenVector.y,tweenVector.z));return results},onComplete:function(){return ANIMATE_IN_TEXT_COMPLETE=!0}}),$timeout(function(){return $scope.showIntroductionText=!0},TEXT_DELAY),TweenMax.to(scene.fog,FOG_DURATION,{density:0,delay:1}),sessionService.get("konami")&&Browser.desktop)return sounds["20th"].play()},animateOut=function(){var BACKGROUND_DURATION,FOG_DURATION,TEXT_DURATION,k,key,len1,letter,obj,ref,tweenVector;touch.unbind(),TEXT_DURATION=2,FOG_DURATION=5,BACKGROUND_DURATION=5,$scope.$apply(function(){return $scope.showIntroductionText=!1,$scope.hideIntroductionText=!0}),TweenMax.killTweensOf($background),TweenMax.to($background,BACKGROUND_DURATION,{opacity:0});for(key in letters)onLetterOut(key);for(ref=textContainer.children,i=k=0,len1=ref.length;k<len1;i=++k)letter=ref[i],letterData[i].transitionOut[Window.orientation].start={position:letter.position.clone()};return tweenVector=new THREE.Vector3,obj={alpha:0},TweenMax.to(obj,TEXT_DURATION,{alpha:1,ease:Power4.easeIn,onUpdate:function(){var end,l,len2,ref1,results,start;for(ref1=textContainer.children,results=[],i=l=0,len2=ref1.length;l<len2;i=++l)letter=ref1[i],start=letterData[i].transitionOut[Window.orientation].start.position,end=letterData[i].transitionOut[Window.orientation].end.position,tweenVector.lerpVectors(start,end,obj.alpha),results.push(letter.position.set(tweenVector.x,tweenVector.y,tweenVector.z));return results},onComplete:function(){return setTimeout(destroySounds,5e3),destroy()}}),TweenMax.to(scene.fog,FOG_DURATION,{density:.005}),sessionService.get("konami")&&Browser.desktop&&sounds["20th"].volume()>0&&sounds["20th"].fade(1,0,3e3),$rootScope.$emit("introduction.animate.out")},zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},onResize=function(){var height,ratio,width;return width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(width,height),composer.setSize(width,height)},onOrientationChange=function(){var k,len1,letter,ref,results;if(ANIMATE_IN_TEXT_COMPLETE){for(textContainer.position.fromArray(textContainerPosition[Window.orientation]),ref=textContainer.children,results=[],i=k=0,len1=ref.length;k<len1;i=++k)letter=ref[i],position=letterData[i].transitionIn[Window.orientation].end.position,results.push(letter.position.set(position.x,position.y,position.z));return results}},onResize(),Window.on("resize",onResize),Window.on("orientationchange",onOrientationChange),window.xxx=function(){return onOrientationChange()},_render=function(camera,left,bottom,width,height){return left*=Window.width,bottom*=Window.height,width*=Window.width,height*=Window.height,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,0),renderer.render(scene,camera)},update=function(){var k,len1,letterMesh,radius,random,results,x,y,z;for(settings.debug&&null!=controls&&controls.update(),results=[],i=k=0,len1=letterMeshes.length;k<len1;i=++k)letterMesh=letterMeshes[i],random=utils.random(-.1,.1),radius=noiseSettings.radius,letterData[i].noise.x.x+=letterData[i].noise.x.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,letterData[i].noise.y.x+=letterData[i].noise.y.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,letterData[i].noise.z.x+=letterData[i].noise.z.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,letterData[i].noise.x.y+=letterData[i].noise.x.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,letterData[i].noise.y.y+=letterData[i].noise.y.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,letterData[i].noise.z.y+=letterData[i].noise.z.vector*noiseSettings.speed+letterData[i].hover*noiseSettings.hoverSpeed,x=Math.sin(noise.perlin2(letterData[i].noise.x.x,letterData[i].noise.x.y))*radius,y=Math.sin(noise.perlin2(letterData[i].noise.y.x,letterData[i].noise.y.y))*radius,z=Math.sin(noise.perlin2(letterData[i].noise.z.x,letterData[i].noise.z.y))*radius,letterMesh.position.x=letterMesh.position._default.x+x,letterMesh.position.y=letterMesh.position._default.y+y,
letterMesh.position.z=letterMesh.position._default.z+z,results.push(letterMesh.rotation.y=letterData[i].hover*random);return results},render=function(){var k,len1,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),update(),settings.debug)return _render(cameras.dev,0,0,1,1),_render(cameras.user,0,0,.25,.25);for(composer.reset(),composer.render(scene,cameras.user),k=0,len1=passes.length;k<len1;k++)pass=passes[k],composer.pass(pass);return composer.toScreen()},zoom(cameras.dev,150),render(),destroySounds=function(){var id,results,sound;results=[];for(id in sounds)sound=sounds[id],results.push(sound.unload());return results},destroy=function(){var k,len1,object,ref;for(DESTROY=!0,Window.off("resize",onResize),Window.off("orientationchange",onOrientationChange),ref=scene.children,k=0,len1=ref.length;k<len1;k++)object=ref[k],scene.remove(object);return renderer.domElement.addEventListener("dblclick",null,!1),renderer.domElement=null,renderer=null,scene=null,$$element.html(""),$scope.$emit("introduction.destroy")}}}}}return IntroductionVisual}(),angular.module("app").directive("introductionVisual",["$rootScope","$timeout","AssetLoader","GUI","lodash","Window","Browser","socketService","sessionService","BrowserTest",IntroductionVisual]);var MenuVisual;MenuVisual=function(){function MenuVisual($rootScope,$timeout,GUI,Window,AssetLoader,$location,Browser,lodash,BrowserTest,sessionService,dictionaryService,mediaQueryService,socketService){return{restrict:"E",link:function($scope,$element){var $$element,$bottomFace,CAMERA_ZOOM_IN,CAMERA_ZOOM_OUT,CAMERA_ZOOM_START,DESTROY,MENU_SOUND_RATE,MENU_SOUND_VOLUME,ROTATE_MENU_CONTINIOUS,ambLight,cameraFolder,cameraMovementController,cameraMovementFolder,cameras,controls,createObjects,css3dArrows,css3dCube,dirLight,getCurrentFaceIndex,gui,helperAxis,helperCamera,helperGrid,hideTitleOnTouchMove,konamiPath,lightFolder,lights,menuSound,menuSoundAsset,normaliseCubeRotation,onResize,onTouchEnd,onTouchMove,onTouchStart,range,render,renderers,rotationIndices,rotations,scenes,settings,soundVelocity,startTransition,touch,update,updateArrowPositions,zoom;return TweenMax.set($element,{opacity:0}),MENU_SOUND_VOLUME=.55,MENU_SOUND_RATE=1,DESTROY=!1,ROTATE_MENU_CONTINIOUS=!0,CAMERA_ZOOM_START=2200,CAMERA_ZOOM_IN=1295,CAMERA_ZOOM_OUT=1400,Browser.device&&(CAMERA_ZOOM_IN=1100),startTransition={speed:8},$$element=$($element),$("#room-title"),gui=new GUI.create(!1),gui.addFolder("menu visual"),VOID_SETTINGS.SOUND_ENABLED&&(konamiPath=sessionService.get("konamiPath"),menuSound=null,menuSoundAsset={id:"introSound",url:"/sounds/menu/"+konamiPath+"01.loop",type:"sound"},AssetLoader.load([menuSoundAsset],"menuSound").then(function(_this){return function(response){return menuSound=response[0].data,menuSound.loop(!0),menuSound.rate(MENU_SOUND_RATE),menuSound.volume(MENU_SOUND_VOLUME),menuSound.play()}}())),settings={debug:!1,showHelpers:!1},cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.PerspectiveCamera(50,Window.width/Window.height,.1,1e5)},cameras.user.position.set(0,0,CAMERA_ZOOM_START),range=5e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderers={css3d:new THREE.CSS3DRenderer},settings.debug&&(renderers.webgl=new THREE.WebGLRenderer({antialias:!0}),renderers.webgl.domElement.classList.add("webgl-renderer"),renderers.webgl.shadowMap.enabled=!0,renderers.webgl.shadowMap.type=THREE.BasicShadowMap,renderers.webgl.setSize(Window.width,Window.height),$element[0].appendChild(renderers.webgl.domElement)),renderers.css3d.domElement.classList.add("css3d-renderer"),renderers.css3d.setSize(Window.width,Window.height),$element[0].appendChild(renderers.css3d.domElement),scenes={css3d:new THREE.Scene},settings.debug&&(scenes.webgl=new THREE.Scene),helperGrid=new THREE.GridHelper(500,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&settings.debug&&(scenes.webgl.add(helperGrid),scenes.webgl.add(helperAxis),scenes.webgl.add(helperCamera)),settings.debug&&(lights={ambient:{color:4473924},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(1,1,1).normalize(),scenes.webgl.add(ambLight),scenes.webgl.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),controls=new THREE.OrbitControls(cameras.dev,$element[0])),cameraMovementController={value:.1},cameraMovementFolder=gui.addFolder("camera movement"),cameraMovementFolder.add(cameraMovementController,"value",-PI,PI).onChange(function(){return css3dCube.rotation.y=cameraMovementController.value*HALF_PI,$scope.$emit("menu.rotation",{value:css3dCube.rotation.y,faceIndex:getCurrentFaceIndex()})}),cameraMovementFolder.open(),css3dCube=null,$bottomFace=null,css3dArrows=null,createObjects=function(){var arrow,directives,element,halfSize,i,j,key,len,object,results,side,sides,size;for(size=512,halfSize=.5*size,directives=["menu-visual-lamentations","menu-visual-urban-jungle","menu-visual-digital-skin","menu-visual-cicada"],sides=[{position:[0,0,halfSize],rotation:[0,PI,0]},{position:[halfSize,0,0],rotation:[0,-PI/2,0]},{position:[0,0,-halfSize],rotation:[0,0,0]},{position:[-halfSize,0,0],rotation:[0,PI/2,0]},{position:[0,-halfSize,0],rotation:[PI/2,0,0]}],css3dCube=new THREE.Object3D,scenes.css3d.add(css3dCube),i=j=0,len=sides.length;j<len;i=++j)side=sides[i],element=document.getElementsByTagName(directives[i])[0],null==element&&(element=document.createElement("div"),element.classList.add("face-"+i,"face")),element.style.width=size+"px",element.style.height=size+"px",element.style.opacity=1,object=new THREE.CSS3DObject(element),object.position.fromArray(side.position),object.rotation.fromArray(side.rotation),object.rotation.y-=PI,css3dCube.add(object);css3dCube.rotation.x=1e-4,css3dCube.rotation.y=1e-4,css3dCube.rotation.z=1e-4,setTimeout(function(){return css3dCube.rotation.x=0,css3dCube.rotation.y=0,css3dCube.rotation.z=0,$bottomFace=$(".face-4"),$bottomFace.hide()},500),css3dArrows={left:new THREE.CSS3DObject(document.getElementsByClassName("arrow-left")[0]),right:new THREE.CSS3DObject(document.getElementsByClassName("arrow-right")[0])},range=1e3,gui.add(css3dArrows.left.position,"x",-range,range),gui.add(css3dArrows.left.position,"y",-range,range),gui.add(css3dArrows.left.position,"z",-range,range),i=0,results=[];for(key in css3dArrows)arrow=css3dArrows[key],scenes.css3d.add(arrow),results.push(i++);return results},createObjects(),updateArrowPositions=function(){var arrow,arrowPositions,i,key,position,results;arrowPositions={desktop:[[-300,0,300],[300,0,300]],tablet:{portrait:[[-215,0,300],[215,0,300]],landscape:[[-300,0,300],[300,0,300]]},mobile:{portrait:[[-215,0,300],[215,0,300]],landscape:[[-300,0,300],[300,0,300]]}},position=arrowPositions.desktop,mediaQueryService.mobile?position=arrowPositions.mobile[Window.orientation]:mediaQueryService.tablet&&(Browser.desktop||(position=arrowPositions.tablet[Window.orientation])),i=0,results=[];for(key in css3dArrows)arrow=css3dArrows[key],arrow.position.fromArray(position[i]),results.push(i++);return results},normaliseCubeRotation=function(){var intToSubtract,maxRotation,rotation;return rotation=css3dCube.rotation.y,maxRotation=TWO_PI,rotation/maxRotation,intToSubtract=Math.floor(rotation/maxRotation),rotation-=intToSubtract*maxRotation},rotationIndices={0:0,90:3,180:2,270:1,360:0},getCurrentFaceIndex=function(){var rotation;return rotation=Math.floor(THREE.Math.radToDeg(normaliseCubeRotation())),rotationIndices[90*Math.round(rotation/90)]},hideTitleOnTouchMove=!1,onTouchStart=function(event){return hideTitleOnTouchMove=!1},soundVelocity=0,onTouchMove=function(event){var duration,y;return TweenMax.killTweensOf(css3dCube.rotation),!1===hideTitleOnTouchMove&&$rootScope.$emit("menu.rotation.start"),hideTitleOnTouchMove=!0,y=Browser.device?css3dCube.rotation.y+1.2*-event.velocityX:css3dCube.rotation.y+.4*-event.velocityX,soundVelocity=.01*-event.velocityX,VOID_SETTINGS.SOUND_ENABLED&&menuSound.rate(MENU_SOUND_RATE+soundVelocity),duration=.1+Math.abs(.1*THREE.Math.clamp(event.velocityX,-3,3)),TweenMax.to(css3dCube.rotation,duration,{y:y,ease:Quad.easeOut,onUpdate:function(_this){return function(){var rotation;return rotation=normaliseCubeRotation(),$scope.$emit("menu.rotation",{value:rotation,faceIndex:getCurrentFaceIndex()})}}()})},onTouchEnd=function(event){var duration,y;if(void 0!==event.velocityX)return TweenMax.killTweensOf(css3dCube.rotation),VOID_SETTINGS.SOUND_ENABLED&&TweenMax.to(menuSound,1.5,{rate:MENU_SOUND_RATE}),y=css3dCube.rotation.y+1.6*-event.velocityX,y=Math.round(y/HALF_PI)*HALF_PI,duration=.5+Math.abs(.3*THREE.Math.clamp(event.velocityX,-3,3)),TweenMax.to(css3dCube.rotation,duration,{y:y,ease:Quad.easeOut,onUpdate:function(_this){return function(){var rotation;return rotation=normaliseCubeRotation(),$scope.$emit("menu.rotation",{value:rotation,faceIndex:getCurrentFaceIndex()})}}(),onComplete:function(){return $rootScope.$emit("menu.rotation.end",getCurrentFaceIndex())}})},touch=new TouchMotion($element,Browser.device),touch.on("touchstart",onTouchStart),touch.on("touchmove",onTouchMove),touch.on("touchend",onTouchEnd),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},update=function(){var rotation;if(ROTATE_MENU_CONTINIOUS&&(css3dCube.rotation.y-=.0045*startTransition.speed,css3dCube.rotation.y<=TWO_PI&&(css3dCube.rotation.y+=TWO_PI),rotation=normaliseCubeRotation(),$scope.$emit("menu.rotation",{value:rotation,faceIndex:getCurrentFaceIndex()})),settings.debug)return controls.update()},onResize=function(){var height,ratio,width;return updateArrowPositions(),width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),settings.debug&&renderers.webgl.setSize(width,height),renderers.css3d.setSize(width,height),$$element.attr({width:Window.width,height:Window.height})},onResize(),Window.on("resize",onResize),Window.on("orientationchange",updateArrowPositions),render=function(){return DESTROY?window.cancelAnimationFrame(render):(requestAnimationFrame(render),update(),settings.debug?(renderers.webgl.render(scenes.webgl,cameras.dev),renderers.css3d.render(scenes.css3d,cameras.dev)):renderers.css3d.render(scenes.css3d,cameras.user))},zoom(cameras.dev,700),render(),$scope.rotateMenu=function(direction){return null==direction&&(direction=1),$rootScope.$emit("menu.rotation.start"),onTouchEnd({velocityX:direction*QUARTER_PI})},$scope.$on("menu.animate.out",function(){var params;return params={opacity:.2},TweenMax.to($element,.5,params)}),$rootScope.$on("room.join",function(){return setTimeout(function(){return TweenMax.set($element,{opacity:1})},2e3)}),rotations={lamentations:0,"urban-jungle":-HALF_PI,"digital-skin":-PI,cicada:-.75*TWO_PI},$rootScope.$on("room.animate.in.for.menu",function(){if(VOID_SETTINGS.SOUND_ENABLED)return menuSound.fade(MENU_SOUND_VOLUME,0,3e3)}),$rootScope.$on("room.animate.out.for.menu",function(event,fullRoomId){var roomId,rotation;return roomId=utils.cleanRoomId(fullRoomId),rotation=rotations[roomId],css3dCube.rotation.y=rotation,VOID_SETTINGS.SOUND_ENABLED&&null!=menuSound&&menuSound.fade(0,MENU_SOUND_VOLUME,3e3),$scope.$emit("menu.rotation",{value:rotation,faceIndex:getCurrentFaceIndex()})}),$rootScope.$on("start.animate.out",function(event,roomId){return TweenMax.to(cameras.user.position,1,{z:CAMERA_ZOOM_IN})}),$rootScope.$on("credits.toggle",function($event,creditsOpen){var params;return params={y:0,onStart:function(){if(Browser.mobile)return $bottomFace.hide()},onComplete:function(_this){return function(){return $bottomFace.hide()}}()},creditsOpen&&($bottomFace.show(),params={y:-900}),TweenMax.to(cameras.user.position,1,params)}),$timeout(function(){var duration;return css3dCube.rotation.y=PI,duration=20,TweenMax.to(startTransition,duration,{speed:1,ease:Quad.easeOut}),TweenMax.to(cameras.user.position,duration,{z:CAMERA_ZOOM_OUT}),TweenMax.to($element,.5,{opacity:1})},500),$rootScope.$on("start.animate.out",function(){var y;return ROTATE_MENU_CONTINIOUS=!1,null!==sessionService.get("deeplinkRoomId")?(y=Math.floor(css3dCube.rotation.y/TWO_PI)*TWO_PI,y+=rotations[sessionService.get("deeplinkRoomId")],c.debug("NEED TO GET THE NEXT NEAREST ROTATION")):y=Math.floor(css3dCube.rotation.y/HALF_PI)*HALF_PI,TweenMax.to(css3dCube.rotation,1.25,{y:y,ease:Quad.easeOut,onUpdate:function(){var rotation;return rotation=normaliseCubeRotation(),$scope.$emit("menu.rotation",{value:rotation,faceIndex:getCurrentFaceIndex()})},onComplete:function(_this){return function(){return $rootScope.$emit("menu.start.transition.end",getCurrentFaceIndex()),touch.bind()}}()})})}}}return MenuVisual}(),angular.module("app").directive("menuVisual",["$rootScope","$timeout","GUI","Window","AssetLoader","$location","Browser","lodash","BrowserTest","sessionService","dictionaryService","mediaQueryService","socketService",MenuVisual]);var Geometry;Geometry=function(){function Geometry(){return{tiles:function(rows,cols,width,height,hexColor){var H,S,boundsHeight,boundsWidth,color,face,geometry,h,i,i1,i2,j,k,l,posX,posY,ref,ref1,reverse,s,startX,startY,v0,v1,v2,x,y;for(null==rows&&(rows=1),null==cols&&(cols=1),null==width&&(width=5),null==height&&(height=10),null==hexColor&&(hexColor=16777215),i=0,H=(new THREE.Color).setHex(hexColor).getHSL().h,S=(new THREE.Color).setHex(hexColor).getHSL().s,(new THREE.Color).setHex(hexColor).getHSL().l,boundsWidth=cols*(.5*width),boundsHeight=rows*(.5*height),startX=.5*-boundsWidth,startY=.5*height-boundsHeight,geometry=new THREE.Geometry,y=j=0,ref=rows;0<=ref?j<ref:j>ref;y=0<=ref?++j:--j)for(x=k=0,ref1=cols;0<=ref1?k<ref1:k>ref1;x=0<=ref1?++k:--k)posX=startX+x*width*.5,posY=startY+y*height,reverse=!1,y%2!=0&&(posX=startX+cols*(.5*width)+.5*width,posX-=x*width*.5,reverse=!0),v0=new THREE.Vector3,v1=new THREE.Vector3,v2=new THREE.Vector3,x%2==0?reverse?(v0.x=posX-.5*width,v0.y=posY+.5*height,v1.x=posX,v1.y=posY-.5*height,v2.x=posX-width,v2.y=posY-.5*height,geometry.vertices.push(v0),geometry.vertices.push(v2),geometry.vertices.push(v1)):(v0.x=posX+.5*width,v0.y=posY+.5*height,v1.x=posX,v1.y=posY-.5*height,v2.x=posX+width,v2.y=posY-.5*height,geometry.vertices.push(v0),geometry.vertices.push(v1),geometry.vertices.push(v2)):reverse?(v0.x=posX-.5*width,v0.y=posY-.5*height,v1.x=posX,v1.y=posY+.5*height,v2.x=posX-width,v2.y=posY+.5*height,geometry.vertices.push(v0),geometry.vertices.push(v1),geometry.vertices.push(v2)):(v0.x=posX+.5*width,v0.y=posY-.5*height,v1.x=posX,v1.y=posY+.5*height,v2.x=posX+width,v2.y=posY+.5*height,geometry.vertices.push(v0),geometry.vertices.push(v2),geometry.vertices.push(v1)),i,i1=i+1,i2=i+2,face=new THREE.Face3(i,i1,i2),color=new THREE.Color,h=H+utils.random(-.01,.01),s=S,l=.04,utils.random(1,5)>4&&(l=utils.random(.04,.08)),color.setHSL(h,s,l),face.vertexColors[0]=color,face.vertexColors[1]=color,face.vertexColors[2]=color,geometry.faces.push(face),i+=3;return geometry.computeFaceNormals(),geometry.computeBoundingBox(),geometry}}}return Geometry}(),angular.module("app").factory("Geometry",[Geometry]);var Shaders;Shaders=function(){function Shaders(){return{snoise2:function(){var str;return str=["vec3 mod289(vec3 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec2 mod289(vec2 x) {","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec3 permute(vec3 x) {","return mod289(((x*34.0)+1.0)*x);","}","float snoise(vec2 v)","{","const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0","0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)","-0.577350269189626,  // -1.0 + 2.0 * C.x","0.024390243902439); // 1.0 / 41.0","// First corner","vec2 i  = floor(v + dot(v, C.yy) );","vec2 x0 = v -   i + dot(i, C.xx);","// Other corners","vec2 i1;","//web.archive.org/web/20200308171819/http://i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0","//web.archive.org/web/20200308171819/http://i1.y = 1.0 - i1.x;","i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);","// x0 = x0 - 0.0 + 0.0 * C.xx ;","// x1 = x0 - i1 + 1.0 * C.xx ;","// x2 = x0 - 1.0 + 2.0 * C.xx ;","vec4 x12 = x0.xyxy + C.xxzz;","x12.xy -= i1;","// Permutations","i = mod289(i); // Avoid truncation effects in permutation","vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))","+ i.x + vec3(0.0, i1.x, 1.0 ));","vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);","m = m*m ;","m = m*m ;","// Gradients: 41 points uniformly over a line, mapped onto a diamond.","// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)","vec3 x = 2.0 * fract(p * C.www) - 1.0;","vec3 h = abs(x) - 0.5;","vec3 ox = floor(x + 0.5);","vec3 a0 = x - ox;","// Normalise gradients implicitly by scaling m","// Approximation of: m *= inversesqrt( a0*a0 + h*h );","m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );","// Compute final noise value at P","vec3 g;","g.x  = a0.x  * x0.x  + h.x  * x0.y;","g.yz = a0.yz * x12.xz + h.yz * x12.yw;","return 130.0 * dot(m, g);","}"],str.join("\n")},classicnoise:function(){var str;return str=["vec4 mod289(vec4 x)","{","return x - floor(x * (1.0 / 289.0)) * 289.0;","}","vec4 permute(vec4 x)","{","return mod289(((x*34.0)+1.0)*x);","}","vec4 taylorInvSqrt(vec4 r)","{","return 1.79284291400159 - 0.85373472095314 * r;","}","vec2 fade(vec2 t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","// Classic Perlin noise","float cnoise(vec2 P)","{","vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);","vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);","Pi = mod289(Pi); // To avoid truncation effects in permutation","vec4 ix = Pi.xzxz;","vec4 iy = Pi.yyww;","vec4 fx = Pf.xzxz;","vec4 fy = Pf.yyww;","vec4 i = permute(permute(ix) + iy);","vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;","vec4 gy = abs(gx) - 0.5 ;","vec4 tx = floor(gx + 0.5);","gx = gx - tx;","vec2 g00 = vec2(gx.x,gy.x);","vec2 g10 = vec2(gx.y,gy.y);","vec2 g01 = vec2(gx.z,gy.z);","vec2 g11 = vec2(gx.w,gy.w);","vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));","g00 *= norm.x;","g01 *= norm.y;","g10 *= norm.z;","g11 *= norm.w;","float n00 = dot(g00, vec2(fx.x, fy.x));","float n10 = dot(g10, vec2(fx.y, fy.y));","float n01 = dot(g01, vec2(fx.z, fy.z));","float n11 = dot(g11, vec2(fx.w, fy.w));","vec2 fade_xy = fade(Pf.xy);","vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);","float n_xy = mix(n_x.x, n_x.y, fade_xy.y);","return 2.3 * n_xy;","}","// Classic Perlin noise, periodic variant","float pnoise(vec2 P, vec2 rep)","{","vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);","vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);","Pi = mod(Pi, rep.xyxy); // To create noise with explicit period","Pi = mod289(Pi);        // To avoid truncation effects in permutation","vec4 ix = Pi.xzxz;","vec4 iy = Pi.yyww;","vec4 fx = Pf.xzxz;","vec4 fy = Pf.yyww;","vec4 i = permute(permute(ix) + iy);","vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0 ;","vec4 gy = abs(gx) - 0.5 ;","vec4 tx = floor(gx + 0.5);","gx = gx - tx;","vec2 g00 = vec2(gx.x,gy.x);","vec2 g10 = vec2(gx.y,gy.y);","vec2 g01 = vec2(gx.z,gy.z);","vec2 g11 = vec2(gx.w,gy.w);","vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));","g00 *= norm.x;  ","g01 *= norm.y;  ","g10 *= norm.z;  ","g11 *= norm.w;  ","float n00 = dot(g00, vec2(fx.x, fy.x));","float n10 = dot(g10, vec2(fx.y, fy.y));","float n01 = dot(g01, vec2(fx.z, fy.z));","float n11 = dot(g11, vec2(fx.w, fy.w));","vec2 fade_xy = fade(Pf.xy);","vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);","float n_xy = mix(n_x.x, n_x.y, fade_xy.y);","return 2.3 * n_xy;","}"],str.join("\n")}}}return Shaders}(),angular.module("app").factory("Shaders",[Shaders]);var MenuVisualCicada;MenuVisualCicada=function(){function MenuVisualCicada($rootScope,GUI,Window,AssetLoader,socketService,sessionService,Browser,lodash){return{restrict:"E",link:function($scope,$element,attrs){var $$element,DESTROY,HEIGHT,IS_IDLE,IS_IN_VIEW,RENDER_SCENE,VISUAL_INDEX,WIDTH,_render,addKonamiPasses,ambLight,arr,attrColors,attrPositions,buffer1,buffer2,cameraFolder,cameraMovementController,cameraMovementFolder,cameras,center,clientColor,composer,connectionColor,controls,createObjects,cubeSize,cubeSizeHalf,dirLight,fogController,fogFolder,folder,grid,gui,helperAxis,helperCamera,helperGrid,k,len,lightFolder,lights,liquidSettings,onMenuRotation,onResize,onWindowFocused,onWindowIdle,passes,radius,range,render,renderer,resetBuffers,s,scaleController,scene,settings,size,tmpColor,totalVoxels,update,updateUserBufferPointers,voxelMesh,zoom;return RENDER_SCENE=!0,IS_IN_VIEW=!1,IS_IDLE=!1,DESTROY=!1,WIDTH=512,HEIGHT=512,VISUAL_INDEX=parseInt(attrs.index),$$element=$($element),gui=new GUI.create(!1),gui.addFolder("cubes visual"),settings={debug:!1,showHelpers:!1},cameras={dev:new THREE.PerspectiveCamera(65,WIDTH/HEIGHT,.1,1e5),user:new THREE.PerspectiveCamera(75,WIDTH/HEIGHT,.1,1e5)},radius=385,cameras.user.position.set(0,0,radius),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0}),composer=new WAGNER.Composer(renderer),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.BasicShadowMap,renderer.domElement.classList.add("webgl-renderer"),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$element[0].appendChild(renderer.domElement),passes=[],addKonamiPasses=function(){var j,len1,len2,m,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],j=0,len1=ref.length;j<len1;j++){for(passConfig=ref[j],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,m=0,len2=ref1.length;m<len2;m++)param=ref1[m],pass.params[param.id]=param.valueMenu;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,fogController={fog:0,fogMax:.005},scene.fog=new THREE.FogExp2(0,fogController.fog),fogFolder=gui.addFolder("fog"),fogFolder.open(),fogFolder.add(scene.fog,"density",0,fogController.fogMax).listen(),settings.showHelpers&&(helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:16777215},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,.4),dirLight.position.set(0,10,10),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),scaleController={x:1,y:1},folder=gui.addFolder("scale controller"),folder.add(scaleController,"x",0,10).onChange(function(){return onResize()}),folder.add(scaleController,"y",0,10).onChange(function(){return onResize()}),null,voxelMesh=null,clientColor=new THREE.Color(socketService.clientColor.user),grid=Browser.device?20:30,size=2*WIDTH,null,cubeSize=size/grid,cubeSizeHalf=cubeSize/2,totalVoxels=grid*grid,attrPositions=new Float32Array(3*totalVoxels*3*2),attrColors=new Float32Array(3*totalVoxels*3*2),buffer1=[],buffer2=[],liquidSettings={depth:.6},len=grid*grid+2*grid,resetBuffers=function(){var i,j,ref,results;for(results=[],i=j=0,ref=len;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)buffer1[i]=0,results.push(buffer2[i]=0);return results},resetBuffers(),createObjects=function(){var BGmesh,b1,colorB,colorG,colorR,connectionColor,g1,geometry,i,j,material,r1,ref,tmpColor,v0x,v0y,v1x,v1y,v2x,v2y,v3x,v3y,v4x,v4y,v5x,v5y,x,y;for(geometry=new THREE.BufferGeometry,i=j=0,ref=totalVoxels;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)x=.5*-size+cubeSizeHalf+i%grid*cubeSize,y=.5*-size+cubeSizeHalf+Math.floor(i/grid)*cubeSize,0,v0x=x-cubeSizeHalf,v0y=y-cubeSizeHalf,v1x=x+cubeSizeHalf,v1y=y-cubeSizeHalf,v2x=x-cubeSizeHalf,v2y=y+cubeSizeHalf,v3x=x+cubeSizeHalf,v3y=y-cubeSizeHalf,v4x=x-cubeSizeHalf,v4y=y+cubeSizeHalf,v5x=x+cubeSizeHalf,v5y=y+cubeSizeHalf,attrPositions[18*i]=v0x,attrPositions[18*i+1]=v0y,attrPositions[18*i+2]=0,attrPositions[18*i+3]=v1x,attrPositions[18*i+4]=v1y,attrPositions[18*i+5]=0,attrPositions[18*i+6]=v2x,attrPositions[18*i+7]=v2y,attrPositions[18*i+8]=0,attrPositions[18*i+9]=v3x,attrPositions[18*i+10]=v3y,attrPositions[18*i+11]=0,attrPositions[18*i+12]=v4x,attrPositions[18*i+13]=v4y,attrPositions[18*i+14]=0,attrPositions[18*i+15]=v5x,attrPositions[18*i+16]=v5y,attrPositions[18*i+17]=0,r1=0,g1=0,b1=0,attrColors[18*i]=r1,attrColors[18*i+1]=b1,attrColors[18*i+2]=g1,attrColors[18*i+3]=r1,attrColors[18*i+4]=b1,attrColors[18*i+5]=g1,attrColors[18*i+6]=r1,attrColors[18*i+7]=b1,attrColors[18*i+8]=g1,attrColors[18*i+9]=r1,attrColors[18*i+10]=b1,attrColors[18*i+11]=g1,attrColors[18*i+12]=r1,attrColors[18*i+13]=b1,attrColors[18*i+14]=g1,attrColors[18*i+15]=r1,attrColors[18*i+16]=b1,attrColors[18*i+17]=g1;return geometry.addAttribute("position",new THREE.BufferAttribute(attrPositions,3)),geometry.addAttribute("color",new THREE.BufferAttribute(attrColors,3)),geometry.computeBoundingSphere(),material=new THREE.MeshPhongMaterial({color:11184810,specular:16777215,shininess:250,side:THREE.DoubleSide,vertexColors:THREE.VertexColors}),voxelMesh=new THREE.Mesh(geometry,material),scene.add(voxelMesh),tmpColor=new THREE.Color,connectionColor=utils.formatColorForWebgl(socketService.clientColor.user),tmpColor.setHex(connectionColor),colorR=.1*tmpColor.g,colorG=.1*tmpColor.b,colorB=.1*tmpColor.r,tmpColor.setRGB(colorR,colorG,colorB),geometry=new THREE.PlaneGeometry(2.5*WIDTH,2.5*HEIGHT),material=new THREE.MeshLambertMaterial({color:tmpColor,wireframe:!1}),BGmesh=new THREE.Mesh(geometry,material),BGmesh.position.z=-300,scene.add(BGmesh)},createObjects(),updateUserBufferPointers=function(){var x,z;return x=Math.floor(Math.random()*grid),z=Math.floor(Math.random()*grid),buffer1[x+z*grid+grid]=2.3},setInterval(updateUserBufferPointers,1e3),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},10,tmpColor=new THREE.Color,connectionColor=socketService.clientColor.user,tmpColor.setHex(connectionColor),tmpColor.r,tmpColor.g,tmpColor.b,center=new THREE.Vector3,k=0,update=function(){var b,g,i,l,minB,minG,minR,r,temp,x1,x2,y1,y2,z;if(!1!==IS_IN_VIEW){if(settings.debug&&null!=controls&&controls.update(),++k>2){for(i=grid,l=grid*grid+grid;i<l;)x1=void 0,x2=void 0,y1=void 0,y2=void 0,i%grid==0?(x1=0,x2=buffer1[i+1]):i%grid==grid-1?(x1=buffer1[i-1],x2=0):(x1=buffer1[i-1],x2=buffer1[i+1]),i<grid?(y1=0,y2=buffer1[i+grid]):i>l-grid-1?(y1=buffer1[i-grid],y2=0):(y1=buffer1[i-grid],y2=buffer1[i+grid]),buffer2[i]=(x1+x2+y1+y2)/2-buffer2[i],buffer1[i]+=.25*(buffer2[i]-buffer1[i]),i++;for(temp=buffer1,buffer1=buffer2,buffer2=temp,i=0,l=grid*grid,minR=.2*clientColor.g,minG=.2*clientColor.b,minB=.2*clientColor.r;i<l;)z=350*(THREE.Math.clamp(buffer2[i+grid]*liquidSettings.depth,-0,.4)-.2),attrPositions[18*i+2]=z,attrPositions[18*i+5]=z,attrPositions[18*i+8]=z,attrPositions[18*i+11]=z,attrPositions[18*i+14]=z,attrPositions[18*i+17]=z,r=clientColor.r*THREE.Math.clamp(buffer2[i+grid],.01,.8)*2+minR,g=clientColor.g*THREE.Math.clamp(buffer2[i+grid],.01,.8)*2+minG,b=clientColor.b*THREE.Math.clamp(buffer2[i+grid],.01,.8)*2+minB,attrColors[18*i]=r,attrColors[18*i+1]=g,attrColors[18*i+2]=b,attrColors[18*i+3]=r,attrColors[18*i+4]=g,attrColors[18*i+5]=b,attrColors[18*i+6]=r,attrColors[18*i+7]=g,attrColors[18*i+8]=b,attrColors[18*i+9]=r,attrColors[18*i+10]=g,attrColors[18*i+11]=b,attrColors[18*i+12]=r,attrColors[18*i+13]=g,attrColors[18*i+14]=b,attrColors[18*i+15]=r,attrColors[18*i+16]=g,attrColors[18*i+17]=b,i++;k=0}return voxelMesh.geometry.attributes.position.needsUpdate=!0,voxelMesh.geometry.attributes.color.needsUpdate=!0}},onResize=function(){var height,ratio,width;return width=WIDTH,height=HEIGHT,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$$element.attr({width:WIDTH,height:HEIGHT}),WIDTH-WIDTH*scaleController.x,$(renderer.domElement).css({width:WIDTH*scaleController.x,height:HEIGHT*scaleController.y})},onResize(),onWindowIdle=function(){return IS_IDLE=!0,resetBuffers()},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),setInterval(function(){return resetBuffers()},3e4),_render=function(camera,left,bottom,width,height){return left*=WIDTH,bottom*=HEIGHT,width*=WIDTH,height*=HEIGHT,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},render=function(){var j,len1,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE&&IS_IN_VIEW&&RENDER_SCENE){if(update(),settings.debug)return _render(cameras.dev,0,0,1,1),_render(cameras.user,.75,0,.25,.25);for(composer.reset(),composer.render(scene,cameras.user),j=0,len1=passes.length;j<len1;j++)pass=passes[j],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,200),render(),gui.add(cameras.user,"fov",0,100).onChange(function(){return onResize()}),arr=[1,1.05,1.1,1.2,1.4,1.8,2,2.8,3.8,5.8,15],s=Smooth(arr,{method:"linear"}),onMenuRotation=function(event,obj){var percent,scale,value,x,y,z;return value=obj.value,value+=VISUAL_INDEX*HALF_PI,value>=PI&&(value=-(TWO_PI-value)),y=THREE.Math.clamp(value,-HALF_PI,HALF_PI),percent=Math.abs(value).map(0,HALF_PI,0,1),percent<1&&(x=radius*Math.cos(HALF_PI+y),z=radius*Math.sin(HALF_PI+y),cameras.user.position.set(x,y,z),cameras.user.lookAt(center),scale=s(percent*arr.length),scene.fog.density=utils.lerp(0,fogController.fogMax,percent),$(renderer.domElement).css({transform:"scale("+scale+", 1)"})),IS_IN_VIEW=percent<1},$scope.$on("menu.rotation",onMenuRotation),cameraMovementController={value:.1},cameraMovementFolder=gui.addFolder("camera movement"),cameraMovementFolder.add(cameraMovementController,"value",-PI,PI).onChange(function(){return onMenuRotation(null,{value:cameraMovementController.value})}),cameraMovementFolder.open(),$scope.$on("menu.animate.out",function(){var params;return params={density:.0055},TweenMax.to(scene.fog,2,params)}),$rootScope.$on("room.animate.in.for.menu",function(){return RENDER_SCENE=!1}),$rootScope.$on("room.animate.out.for.menu",function(){return resetBuffers(),RENDER_SCENE=!0}),$rootScope.$on("socket.clientcolor.change",function(event,data){var newColor,tween,userColor;return userColor=(new THREE.Color).setHex(clientColor.getHex()),newColor=(new THREE.Color).setHex(data.userColor),tween={value:0},TweenMax.to(tween,3,{value:1,onUpdate:function(){var b,g,r;return r=utils.lerp(userColor.r,newColor.r,tween.value),g=utils.lerp(userColor.g,newColor.g,tween.value),b=utils.lerp(userColor.b,newColor.b,tween.value),clientColor.setRGB(r,g,b)}})})}}}return MenuVisualCicada}(),angular.module("app").directive("menuVisualCicada",["$rootScope","GUI","Window","AssetLoader","socketService","sessionService","Browser","lodash",MenuVisualCicada]);var MenuVisualDigitalSkin;MenuVisualDigitalSkin=function(){
function MenuVisualDigitalSkin($rootScope,GUI,Window,AssetLoader,Browser,Geometry,socketService,sessionService,DigitalSkinShaders,lodash){return{restrict:"E",link:function($scope,$element,attrs){var $$element,DESTROY,HEIGHT,IS_IDLE,IS_IN_VIEW,RENDER_SCENE,VISUAL_INDEX,WIDTH,_render,addKonamiPasses,ambLight,animateFaceRandom,arr,cameraFolder,cameraMovementController,cameraMovementFolder,cameras,center,composer,controls,createObjects,dirLight,faceTweensRandom,fogController,fogFolder,folder,gui,helperAxis,helperCamera,helperGrid,lightFolder,lights,mesh,onMenuRotation,onResize,onWindowFocused,onWindowIdle,passes,platform,randomFacesLuminosity,range,render,renderer,s,scaleController,scene,settings,spotLight,tmpColorRandom,tmpSocketClientColor,uniforms,update,zoom;return RENDER_SCENE=!0,IS_IN_VIEW=!1,IS_IDLE=!1,DESTROY=!1,WIDTH=512,HEIGHT=512,VISUAL_INDEX=parseInt(attrs.index),$$element=$($element),gui=new GUI.create(!1),gui.addFolder("triangles visual"),settings={debug:!1,showHelpers:!1,camera:{z:{desktop:1e3,device:450}},tilesSpeed:{desktop:30,device:5}},platform=Browser.device?"device":"desktop",cameras={dev:new THREE.PerspectiveCamera(65,WIDTH/HEIGHT,.1,1e5),user:new THREE.PerspectiveCamera(20,WIDTH/HEIGHT,.1,1e5)},cameras.user.position.set(0,0,1e3),cameras.user.position.set(0,0,settings.camera.z[platform]),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0}),composer=new WAGNER.Composer(renderer),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.BasicShadowMap,renderer.domElement.classList.add("webgl-renderer"),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$element[0].appendChild(renderer.domElement),passes=[],addKonamiPasses=function(){var j,k,len,len1,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],j=0,len=ref.length;j<len;j++){for(passConfig=ref[j],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,k=0,len1=ref1.length;k<len1;k++)param=ref1[k],pass.params[param.id]=param.valueMenu;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,fogController={fog:.002,fogMax:95e-5},scene.fog=new THREE.FogExp2(0,fogController.fog),fogFolder=gui.addFolder("fog"),fogFolder.open(),fogFolder.add(scene.fog,"density",0,fogController.fogMax).listen(),settings.showHelpers&&(helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:4473924},directional:{color:16777215},spot:{color:16711935}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),spotLight=new THREE.SpotLight(lights.spot.color),spotLight.position.set(0,0,100),spotLight.distance=200,spotLight.castShadow=!0,spotLight.shadowMapWidth=1024,spotLight.shadowMapHeight=1024,spotLight.shadowCameraNear=500,spotLight.shadowCameraFar=4e3,spotLight.shadowCameraFov=30,scene.add(spotLight),dirLight.position.set(.5,0,1).normalize(),scene.add(ambLight),scene.add(dirLight),scene.add(spotLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),lightFolder.addColor(lights.spot,"color").name("point"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),scaleController={x:1,y:1},folder=gui.addFolder("scale controller"),folder.add(scaleController,"x",0,10).onChange(function(){return onResize()}),folder.add(scaleController,"y",0,10).onChange(function(){return onResize()}),mesh=null,uniforms=null,createObjects=function(){var geometry,lambert,material;return lambert=THREE.ShaderLib.lambert,uniforms=THREE.UniformsUtils.merge([lambert.uniforms,{time:{type:"f",value:0}}]),material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:DigitalSkinShaders.vertexShaderForMenu(),fragmentShader:lambert.fragmentShader,vertexColors:THREE.VertexColors,lights:!0,fog:!0}),geometry=Geometry.tiles(10,100,50,100,utils.formatColorForWebgl(socketService.clientColor.user)),mesh=new THREE.Mesh(geometry,material),mesh.receiveShadow=!0,scene.add(mesh),mesh.position.z=-300},createObjects(),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},center=new THREE.Vector3,update=function(){if(!1!==IS_IN_VIEW)return uniforms.time.value+=.1,mesh.geometry.colorsNeedUpdate=!0,settings.debug&&null!=controls?controls.update():void 0},faceTweensRandom={},{},tmpColorRandom=new THREE.Color,animateFaceRandom=function(face,_connectionIndex,connectionColor){var color,connectionColorHSL,faceId,h,l,s,tween;if(null!=face)return faceId=face.a+":"+face.b+":"+face.c,null!=faceTweensRandom[faceId]&&faceTweensRandom[faceId].kill(),connectionColorHSL=tmpColorRandom.setHex(connectionColor).getHSL(),h=connectionColorHSL.h,s=connectionColorHSL.s,l=connectionColorHSL.l,color={h:h,s:s,l:l},face.vertexColors[0].setHSL(h,s,l),l=.04,utils.random(1,5)>2&&(l=utils.random(.04,.08)),tween={value:0},faceTweensRandom[faceId]=TweenMax.to(tween,.8,{value:1,onUpdate:function(){var hsl,lightness;return tmpColorRandom.setHex(socketService.clientColor.user),hsl=tmpColorRandom.getHSL(),lightness=utils.lerp(color.l,l,tween.value),face.vertexColors[0].setHSL(hsl.h,hsl.s,lightness)},onComplete:function(_this){return function(){return delete faceTweensRandom[faceId]}}()})},randomFacesLuminosity=function(){var face;return face=mesh.geometry.faces[Math.floor(Math.random()*mesh.geometry.faces.length)-1],animateFaceRandom(face,0,utils.formatColorForWebgl(socketService.clientColor.user))},setInterval(randomFacesLuminosity,settings.tilesSpeed[platform]),onResize=function(){var height,ratio,width;return width=WIDTH,height=HEIGHT,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$$element.attr({width:WIDTH,height:HEIGHT}),WIDTH-WIDTH*scaleController.x,$(renderer.domElement).css({width:WIDTH*scaleController.x,height:HEIGHT*scaleController.y})},onResize(),onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),_render=function(camera,left,bottom,width,height){return left*=WIDTH,bottom*=HEIGHT,width*=WIDTH,height*=HEIGHT,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},render=function(){var j,len,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE&&IS_IN_VIEW&&RENDER_SCENE){if(update(),settings.debug)return _render(cameras.dev,0,0,1,1),_render(cameras.user,.75,0,.25,.25);for(composer.reset(),composer.render(scene,cameras.user),j=0,len=passes.length;j<len;j++)pass=passes[j],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,200),render(),gui.add(cameras.user,"fov",0,100).onChange(function(){return onResize()}),arr=[1,1,1.1,1.2,1.4,1.6,1.8,2.2,2.6,2.8,3],s=Smooth(arr,{method:"linear"}),onMenuRotation=function(event,obj){var percent,radius,scale,value,x,y,z;return value=obj.value,value+=VISUAL_INDEX*HALF_PI,value>=PI&&(value=-(TWO_PI-value)),y=THREE.Math.clamp(1.3*value,-HALF_PI,HALF_PI),percent=Math.abs(value).map(0,HALF_PI,0,1),percent<1&&(radius=settings.camera.z[platform],x=radius*Math.cos(HALF_PI+y),z=radius*Math.sin(HALF_PI+y),cameras.user.position.set(x,y,z),cameras.user.lookAt(center),scale=s(percent*arr.length),scene.fog.density=utils.lerp(0,fogController.fogMax,percent),$(renderer.domElement).css({transform:"scale("+scale+", 1)"})),IS_IN_VIEW=percent<1},$scope.$on("menu.rotation",onMenuRotation),cameraMovementController={value:.1},cameraMovementFolder=gui.addFolder("camera movement"),cameraMovementFolder.add(cameraMovementController,"value",-HALF_PI,HALF_PI).onChange(function(){return onMenuRotation(null,{value:cameraMovementController.value})}),cameraMovementFolder.open(),$scope.$on("menu.animate.out",function(){var params;return params={density:.0055},TweenMax.to(scene.fog,2,params)}),$rootScope.$on("room.animate.in.for.menu",function(){return RENDER_SCENE=!1}),$rootScope.$on("room.animate.out.for.menu",function(){return RENDER_SCENE=!0}),tmpSocketClientColor=new THREE.Color(socketService.clientColor.user),$rootScope.$on("socket.clientcolor.change",function(event,data){var newColor,tmpColor,tween,userColor;return userColor=(new THREE.Color).setHex(tmpSocketClientColor.getHex()),newColor=(new THREE.Color).setHex(data.userColor),tmpColor=new THREE.Color,tween={value:0},TweenMax.to(tween,3,{value:1,onUpdate:function(){var H,b,face,g,h,hsl,i,j,len,r,ref;for(r=utils.lerp(userColor.r,newColor.r,tween.value),g=utils.lerp(userColor.g,newColor.g,tween.value),b=utils.lerp(userColor.b,newColor.b,tween.value),tmpColor.setRGB(r,g,b),H=tmpColor.getHSL().h,ref=mesh.geometry.faces,i=j=0,len=ref.length;j<len;i=++j)face=ref[i],hsl=face.vertexColors[0].getHSL(),h=H+utils.random(-.01,.01),face.vertexColors[0].setHSL(h,hsl.s,hsl.l),face.vertexColors[1].setHSL(h,hsl.s,hsl.l),face.vertexColors[2].setHSL(h,hsl.s,hsl.l);return mesh.geometry.colorsNeedUpdate=!0}}),tmpSocketClientColor.setHex(newColor.getHex())})}}}return MenuVisualDigitalSkin}(),angular.module("app").directive("menuVisualDigitalSkin",["$rootScope","GUI","Window","AssetLoader","Browser","Geometry","socketService","sessionService","DigitalSkinShaders","lodash",MenuVisualDigitalSkin]);var MenuVisualLamentations;MenuVisualLamentations=function(){function MenuVisualLamentations($rootScope,GUI,Window,AssetLoader,Browser,Geometry,socketService,sessionService,LamentationsShaders,lodash){return{restrict:"E",link:function($scope,$element,attrs){var $$element,DESTROY,HEIGHT,IS_IDLE,IS_IN_VIEW,RENDER_SCENE,VISUAL_INDEX,WIDTH,_render,addKonamiPasses,ambLight,arr,cameraFolder,cameraMovementController,cameraMovementFolder,cameras,center,composer,controls,createObjects,dirLight,fogController,fogFolder,folder,gui,helperAxis,helperCamera,helperGrid,lightFolder,lights,onMenuRotation,onResize,onWindowFocused,onWindowIdle,passes,platform,radius,range,render,renderer,s,scaleController,scene,settings,uniforms,update,zoom;return RENDER_SCENE=!0,IS_IN_VIEW=!1,IS_IDLE=!1,DESTROY=!1,WIDTH=512,HEIGHT=512,VISUAL_INDEX=parseInt(attrs.index),$$element=$($element),gui=new GUI.create(!1),gui.addFolder("lamentations visual"),settings={debug:!1,showHelpers:!1,camera:{z:{desktop:250,device:150}}},platform=Browser.device?"device":"desktop",cameras={dev:new THREE.PerspectiveCamera(65,WIDTH/HEIGHT,.1,1e5),user:new THREE.PerspectiveCamera(20,WIDTH/HEIGHT,.1,1e5)},cameras.user.position.set(0,0,settings.camera.z[platform]),radius=settings.camera.z[platform],range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0}),composer=new WAGNER.Composer(renderer),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.BasicShadowMap,renderer.domElement.classList.add("webgl-renderer"),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$element[0].appendChild(renderer.domElement),passes=[],addKonamiPasses=function(){var i,j,len,len1,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],i=0,len=ref.length;i<len;i++){for(passConfig=ref[i],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,j=0,len1=ref1.length;j<len1;j++)param=ref1[j],pass.params[param.id]=param.valueMenu;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,fogController={fog:0,fogMax:.002},scene.fog=new THREE.FogExp2(0,fogController.fog),fogFolder=gui.addFolder("fog"),fogFolder.open(),fogFolder.add(scene.fog,"density",0,fogController.fogMax).listen(),settings.showHelpers&&(helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:socketService.clientColor.ambient},directional:{color:socketService.clientColor.directional}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(.5,0,1).normalize(),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),scaleController={x:1,y:1},folder=gui.addFolder("scale controller"),folder.add(scaleController,"x",0,10).onChange(function(){return onResize()}),folder.add(scaleController,"y",0,10).onChange(function(){return onResize()}),null,uniforms=null,createObjects=function(){var geometry,lambert,material,mesh;return lambert=THREE.ShaderLib.lambert,uniforms=THREE.UniformsUtils.merge([lambert.uniforms,{time:{type:"f",value:0}}]),material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:LamentationsShaders.vertexShaderForRoom(),fragmentShader:LamentationsShaders.fragmentShaderForRoom(),side:THREE.DoubleSide,lights:!0,fog:!0}),geometry=new THREE.PlaneGeometry(600,600,50,50),mesh=new THREE.Mesh(geometry,material),scene.add(mesh),mesh.position.z=-100},createObjects(),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},center=new THREE.Vector3,update=function(){if(!1!==IS_IN_VIEW)return uniforms.time.value+=.1,settings.debug&&null!=controls?controls.update():void 0},onResize=function(){var height,ratio,width;return width=WIDTH,height=HEIGHT,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$$element.attr({width:WIDTH,height:HEIGHT}),WIDTH-WIDTH*scaleController.x,$(renderer.domElement).css({width:WIDTH*scaleController.x,height:HEIGHT*scaleController.y})},onResize(),onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),_render=function(camera,left,bottom,width,height){return left*=WIDTH,bottom*=HEIGHT,width*=WIDTH,height*=HEIGHT,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},render=function(){var i,len,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE&&IS_IN_VIEW&&RENDER_SCENE){if(update(),settings.debug)return _render(cameras.dev,0,0,1,1),_render(cameras.user,.75,0,.25,.25);for(composer.reset(),composer.render(scene,cameras.user),i=0,len=passes.length;i<len;i++)pass=passes[i],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,200),render(),gui.add(cameras.user,"fov",0,100).onChange(function(){return onResize()}),arr=[1,1.05,1.1,1.2,1.4,1.8,2,2.8,3.8,5.8,15],s=Smooth(arr,{method:"linear"}),onMenuRotation=function(event,obj){var percent,scale,value,x,y,z;return value=obj.value,value+=VISUAL_INDEX*HALF_PI,value>=PI&&(value=-(TWO_PI-value)),y=THREE.Math.clamp(1.2*value,-HALF_PI,HALF_PI),percent=Math.abs(value).map(0,HALF_PI,0,1),percent<1&&(x=radius*Math.cos(HALF_PI+y),z=radius*Math.sin(HALF_PI+y),cameras.user.position.set(x,y,z),cameras.user.lookAt(center),scale=s(percent*arr.length),scene.fog.density=utils.lerp(0,fogController.fogMax,percent),$(renderer.domElement).css({transform:"scale("+scale+", 1)"})),IS_IN_VIEW=percent<1},$scope.$on("menu.rotation",onMenuRotation),cameraMovementController={value:.1},cameraMovementFolder=gui.addFolder("camera movement"),cameraMovementFolder.add(cameraMovementController,"value",-PI,PI).onChange(function(){return onMenuRotation(null,{value:cameraMovementController.value})}),cameraMovementFolder.open(),$scope.$on("menu.animate.out",function(){return{density:.0055}}),$rootScope.$on("room.animate.in.for.menu",function(){return RENDER_SCENE=!1}),$rootScope.$on("room.animate.out.for.menu",function(){return RENDER_SCENE=!0}),$rootScope.$on("socket.clientcolor.change",function(event,data){var ambientColor,directionalColor,newAmbientColor,newDirectionalColor,tween;return ambientColor=(new THREE.Color).setHex(ambLight.color.getHex()),newAmbientColor=(new THREE.Color).setHex(data.ambientColor),directionalColor=(new THREE.Color).setHex(dirLight.color.getHex()),newDirectionalColor=(new THREE.Color).setHex(data.directionalColor),tween={value:0},TweenMax.to(tween,3,{value:1,onUpdate:function(){var b1,b2,g1,g2,r1,r2;return r1=utils.lerp(ambientColor.r,newAmbientColor.r,tween.value),g1=utils.lerp(ambientColor.g,newAmbientColor.g,tween.value),b1=utils.lerp(ambientColor.b,newAmbientColor.b,tween.value),r2=utils.lerp(directionalColor.r,newDirectionalColor.r,tween.value),g2=utils.lerp(directionalColor.g,newDirectionalColor.g,tween.value),b2=utils.lerp(directionalColor.b,newDirectionalColor.b,tween.value),ambLight.color.setRGB(r1,g1,b1),dirLight.color.setRGB(r2,g2,b2)}})})}}}return MenuVisualLamentations}(),angular.module("app").directive("menuVisualLamentations",["$rootScope","GUI","Window","AssetLoader","Browser","Geometry","socketService","sessionService","LamentationsShaders","lodash",MenuVisualLamentations]);var MenuVisualUrbanJungle;MenuVisualUrbanJungle=function(){function MenuVisualUrbanJungle($rootScope,GUI,Window,AssetLoader,Browser,socketService,sessionService,lodash){return{restrict:"E",link:function($scope,$element,attrs){var $$element,DESTROY,HEIGHT,IS_IDLE,IS_IN_VIEW,RENDER_SCENE,VISUAL_INDEX,WIDTH,_render,addKonamiPasses,ambLight,arr,cameraFolder,cameraMovementController,cameraMovementFolder,cameras,center,composer,controls,createObjects,cubeIndex,cubeSize,d,dirLight,fogController,fogFolder,folder,gradientMesh,gradientMesh2,gui,helperAxis,helperCamera,helperGrid,lightFolder,lights,meshes,offsetX,onMenuRotation,onResize,onWindowFocused,onWindowIdle,passes,range,render,renderer,s,scaleController,scene,settings,tmpColor,totalCubes,update,updateTick,zoom;return RENDER_SCENE=!0,IS_IN_VIEW=!1,IS_IDLE=!1,DESTROY=!1,WIDTH=512,HEIGHT=512,VISUAL_INDEX=parseInt(attrs.index),$$element=$($element),gui=new GUI.create(!1),gui.addFolder("urban jungle visual"),settings={debug:!1,showHelpers:!1},cameras={dev:new THREE.PerspectiveCamera(65,WIDTH/HEIGHT,.1,1e5),user:new THREE.OrthographicCamera(-WIDTH/2,WIDTH/2,HEIGHT/2,-HEIGHT/2,.1,2e3)},cameras.user.position.set(0,260,1500),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0}),composer=new WAGNER.Composer(renderer),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.BasicShadowMap,renderer.domElement.classList.add("webgl-renderer"),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$element[0].appendChild(renderer.domElement),passes=[],addKonamiPasses=function(){var j,k,len,len1,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],j=0,len=ref.length;j<len;j++){for(passConfig=ref[j],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,k=0,len1=ref1.length;k<len1;k++)param=ref1[k],pass.params[param.id]=param.valueMenu;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,fogController={fog:.002,fogMax:20},scene.fog=new THREE.FogExp2(0,fogController.fog),fogFolder=gui.addFolder("fog"),fogFolder.open(),fogFolder.add(scene.fog,"density",0,fogController.fogMax).listen(),settings.showHelpers&&(helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:4473924},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(.5,0,1).normalize(),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),scaleController={x:1,y:1},folder=gui.addFolder("scale controller"),folder.add(scaleController,"x",0,10).onChange(function(){return onResize()}),folder.add(scaleController,"y",0,10).onChange(function(){return onResize()}),meshes=[],null,cubeSize=Browser.device?40:18,gradientMesh=null,gradientMesh2=null,totalCubes=WIDTH/cubeSize+2,offsetX=-totalCubes*cubeSize*.5+.5*cubeSize,createObjects=function(){var color,generateTexture,generateTexture2,geometry,gradientColor,h,i,j,l,material,mesh,ref,s,texture;for(i=j=0,ref=totalCubes;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)geometry=new THREE.BoxGeometry(cubeSize,HEIGHT,cubeSize),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*HEIGHT,cubeSize)),color=new THREE.Color(socketService.clientColor.user),h=utils.random(.5,.6),s=utils.random(.65,.7),l=utils.random(0,0),color.setHSL(h,s,l),material=new THREE.MeshPhongMaterial({color:color}),mesh=new THREE.Mesh(geometry,material),mesh.position.x=offsetX+cubeSize*i,mesh.position.y=-256,mesh.position.z=-500,mesh.scale.y=.1,meshes.push(mesh),scene.add(mesh);return geometry=new THREE.PlaneBufferGeometry(WIDTH,HEIGHT),generateTexture=function(){var canvas,context,gradient;return canvas=document.createElement("canvas"),canvas.width=WIDTH,canvas.height=HEIGHT,context=canvas.getContext("2d"),context.rect(0,0,WIDTH,HEIGHT),gradient=context.createLinearGradient(WIDTH,0,0,HEIGHT),gradient.addColorStop(1,"#ffffff"),gradient.addColorStop(.5,"transparent"),context.fillStyle=gradient,context.fill(),canvas},texture=new THREE.Texture(generateTexture()),texture.needsUpdate=!0,gradientColor=new THREE.Color(socketService.clientColor.user),material=new THREE.MeshBasicMaterial({color:gradientColor,wireframe:!1,transparent:!0,map:texture,opacity:.9}),gradientMesh=new THREE.Mesh(geometry,material),gradientMesh.position.z=-50,gradientMesh.scale.x=1,gradientMesh.position.x=WIDTH/2,gradientMesh.position.y=0,scene.add(gradientMesh),generateTexture2=function(){var canvas,context,gradient;return canvas=document.createElement("canvas"),canvas.width=WIDTH,canvas.height=HEIGHT,context=canvas.getContext("2d"),context.rect(0,0,WIDTH,HEIGHT),gradient=context.createLinearGradient(0,0,WIDTH,HEIGHT),gradient.addColorStop(1,"#ffffff"),gradient.addColorStop(.5,"transparent"),context.fillStyle=gradient,context.fill(),canvas},texture=new THREE.Texture(generateTexture2()),texture.needsUpdate=!0,gradientColor=new THREE.Color(socketService.clientColor.user),material=new THREE.MeshBasicMaterial({color:gradientColor,wireframe:!1,transparent:!0,map:texture,opacity:.9}),gradientMesh2=new THREE.Mesh(geometry,material),gradientMesh2.position.z=-50,gradientMesh2.position.x=-WIDTH/2,gradientMesh2.scale.x=1,gradientMesh2.position.y=0,scene.add(gradientMesh2)},createObjects(),cubeIndex=0,d=0,tmpColor=new THREE.Color,updateTick=function(){var updateRow;return cubeIndex>=meshes.length-1&&(cubeIndex=0),updateRow=function(clientIndex){var h,l,percent,s,y;return TweenMax.killTweensOf(meshes[cubeIndex].scale),tmpColor.setHex(socketService.clientColor.user),h=tmpColor.getHSL().h,s=tmpColor.getHSL().s+utils.random(-.05,.05),l=tmpColor.getHSL().l+utils.random(-.05,.05),meshes[cubeIndex].material.color.setHSL(h,s,1),d+=.31,percent=Math.sin(d)/2+.45,y=1,meshes[cubeIndex].material.color.setHSL(h+h*percent/10,s,percent*l),TweenMax.to(meshes[cubeIndex].scale,.5,{y:y,yoyo:!1}),TweenMax.to(meshes[cubeIndex].position,.5,{z:100*percent-200,yoyo:!1})},cubeIndex++,updateRow(0)},setInterval(updateTick,150),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},center=new THREE.Vector3,update=function(){if(!1!==IS_IN_VIEW)return settings.debug&&null!=controls?controls.update():void 0},onResize=function(){var ratio;return ratio=WIDTH/HEIGHT,cameras.dev.aspect=ratio,cameras.user.left=WIDTH/-2,cameras.user.right=WIDTH/2,cameras.user.top=HEIGHT/2,cameras.user.bottom=HEIGHT/-2,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(WIDTH,HEIGHT),composer.setSize(WIDTH,HEIGHT),$$element.attr({width:WIDTH,height:HEIGHT}),$(renderer.domElement).css({width:WIDTH,height:HEIGHT})},onResize(),onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),_render=function(camera,left,bottom,width,height){return left*=WIDTH,bottom*=HEIGHT,width*=WIDTH,height*=HEIGHT,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},render=function(){var j,len,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE&&IS_IN_VIEW&&RENDER_SCENE){if(update(),settings.debug)return _render(cameras.dev,0,0,1,1),_render(cameras.user,.75,0,.25,.25);for(composer.reset(),composer.render(scene,cameras.user),j=0,len=passes.length;j<len;j++)pass=passes[j],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,200),render(),arr=[1,1.05,1.1,1.2,1.4,1.8,2,2.8,3.8,5.8,15],s=Smooth(arr,{method:"linear"}),onMenuRotation=function(event,obj){var percent,radius,scale,value,x,y,z;return value=obj.value,value+=VISUAL_INDEX*HALF_PI,value>=PI&&(value=-(TWO_PI-value)),y=THREE.Math.clamp(1.2*value,1*-HALF_PI,1*HALF_PI),percent=Math.abs(value).map(0,HALF_PI,0,1),percent<1&&(radius=100,x=radius*Math.cos(HALF_PI+y),z=radius*Math.sin(HALF_PI+y),cameras.user.position.x=x,cameras.user.position.z=z,cameras.user.position.y=0,cameras.user.lookAt(center),scale=s(percent*arr.length),scene.fog.density=utils.lerp(0,fogController.fogMax,percent),$(renderer.domElement).css({transform:"scale("+scale+", 1)"})),IS_IN_VIEW=percent<1},$scope.$on("menu.rotation",onMenuRotation),cameraMovementController={value:.1},cameraMovementFolder=gui.addFolder("camera movement"),cameraMovementFolder.add(cameraMovementController,"value",-PI,PI).onChange(function(){return onMenuRotation(null,{value:cameraMovementController.value})}),cameraMovementFolder.open(),$scope.$on("menu.animate.out",function(){var params;return params={density:25},TweenMax.to(scene.fog,2,params)}),$rootScope.$on("room.animate.in.for.menu",function(){return RENDER_SCENE=!1}),$rootScope.$on("room.animate.out.for.menu",function(){return RENDER_SCENE=!0}),$rootScope.$on("socket.clientcolor.change",function(event,data){var newColor,tween,userColor;return userColor=(new THREE.Color).setHex(gradientMesh.material.color.getHex()),newColor=(new THREE.Color).setHex(data.userColor),tween={value:0},TweenMax.to(tween,3,{value:1,onUpdate:function(){var b,g,r;return r=utils.lerp(userColor.r,newColor.r,tween.value),g=utils.lerp(userColor.g,newColor.g,tween.value),b=utils.lerp(userColor.b,newColor.b,tween.value),gradientMesh.material.color.setRGB(r,g,b),gradientMesh2.material.color.setRGB(r,g,b)}})})}}}return MenuVisualUrbanJungle}(),angular.module("app").directive("menuVisualUrbanJungle",["$rootScope","GUI","Window","AssetLoader","Browser","socketService","sessionService","lodash",MenuVisualUrbanJungle]);var CicadaPointerTween,RoomVisualCicada;CicadaPointerTween=function(){function CicadaPointerTween(connectionIndex1,connectedUsersData,value,endValue,duration,totalPointers){var params;this.connectionIndex=connectionIndex1,this.value=null!=value?value:0,this.endValue=null!=endValue?endValue:1,null==duration&&(duration=1),params={value:this.endValue,onUpdate:function(_this){return function(){if(connectedUsersData[_this.connectionIndex][0].value=_this.value,2===totalPointers)return connectedUsersData[_this.connectionIndex][1].value=_this.value}}(this)},TweenMax.to(this,duration,params)}return CicadaPointerTween.prototype.kill=function(){return TweenMax.killTweensOf(this)},CicadaPointerTween}(),RoomVisualCicada=function(){function RoomVisualCicada($rootScope,GUI,Window,AssetLoader,Browser,lodash,$timeout,socketService,sessionService,Geometry){return{restrict:"A",link:function($scope,$element){var $$element,BGmesh,CAMERA_DEFAULT_Z,DESTROY,IS_IDLE,MAX_POINTERS_FOR_TOUCH,_render,addKonamiPasses,ambLight,assets,attrColors,attrPositions,boom,boomObj,boomTimer,buffer1,buffer2,cameraFolder,cameras,clientColor,clientPointers,composer,connectedUsersData,connectionColor,connectionData,connectionIndex,connectionPointers,controls,createObjects,cubeSize,cubeSizeHalf,currentBufferIndex,dirLight,distanceController,getPointerVectors,gradientMesh,grid,gui,helperAxis,helperCamera,helperGrid,hittestMesh,i,j,konamiPath,lightFolder,lights,liquidSettings,m,melodyLine,melodyTune,melodytoplay,mouse,n,o,onClientColorChange,onResize,onTouchEnd,onTouchMove,onTouchStart,onUserAction,onUserActionEnd,onUserActionStart,onWindowFocused,onWindowIdle,passes,pointersEnabledTweens,range,raycaster,ref,ref1,render,renderer,resetBuffers,scene,settings,size,sounds,time,tmpColor,totalVoxels,touch,unbindAnimateOut,unbindClientColorChange,unbindUserInteractionEndHandler,unbindUserInteractionHandler,unbindUserInteractionStartHandler,update,updateBufferPointersEnd,updateBufferPointersStart,updateConnectedUsersDataEnd,updateConnectedUsersDataMove,updateConnectedUsersDataStart,updateUserBufferPointers,updatemelody,voxelMesh,zoom;for(DESTROY=!1,IS_IDLE=!1,CAMERA_DEFAULT_Z=345,MAX_POINTERS_FOR_TOUCH=2,$$element=$($element),gui=new GUI.create(!0),gui.addFolder("cicada"),gui.open(),VOID_SETTINGS.SOUND_ENABLED?(sounds={glitches:[]},konamiPath=sessionService.get("konamiPath"),assets=[{id:"base",url:"/sounds/cicada/"+konamiPath+"loculstes",type:"sound"},{id:"raising",url:"/sounds/cicada/"+konamiPath+"raising",type:"sound"},{id:"raisingloculstes",url:"/sounds/cicada/"+konamiPath+"raising-loculstes",type:"sound"},{id:"playerA1",url:"/sounds/cicada/player/"+konamiPath+"A-1",type:"sound"},{id:"playerA2",url:"/sounds/cicada/player/"+konamiPath+"A-2",type:"sound"},{id:"playerA3",url:"/sounds/cicada/player/"+konamiPath+"A-3",type:"sound"},{id:"playerB1",url:"/sounds/cicada/player/"+konamiPath+"B-1",type:"sound"},{id:"playerB2",url:"/sounds/cicada/player/"+konamiPath+"B-2",type:"sound"},{id:"playerB3",url:"/sounds/cicada/player/"+konamiPath+"B-3",type:"sound"},{id:"playerC1",url:"/sounds/cicada/player/"+konamiPath+"C-1",type:"sound"},{id:"playerC2",url:"/sounds/cicada/player/"+konamiPath+"C-2",type:"sound"},{id:"playerC3",url:"/sounds/cicada/player/"+konamiPath+"C-3",type:"sound"},{id:"playerD1",url:"/sounds/cicada/player/"+konamiPath+"D-1",type:"sound"},{id:"playerD2",url:"/sounds/cicada/player/"+konamiPath+"D-2",type:"sound"},{id:"playerD3",url:"/sounds/cicada/player/"+konamiPath+"D-3",type:"sound"},{id:"playerAall",url:"/sounds/cicada/player/"+konamiPath+"A-all",type:"sound"},{id:"playerBall",
url:"/sounds/cicada/player/"+konamiPath+"B-all",type:"sound"},{id:"playerCall",url:"/sounds/cicada/player/"+konamiPath+"C-all",type:"sound"},{id:"playerDall",url:"/sounds/cicada/player/"+konamiPath+"D-all",type:"sound"},{id:"guestA1",url:"/sounds/cicada/guest/"+konamiPath+"A-1",type:"sound"},{id:"guestA2",url:"/sounds/cicada/guest/"+konamiPath+"A-2",type:"sound"},{id:"guestA3",url:"/sounds/cicada/guest/"+konamiPath+"A-3",type:"sound"},{id:"guestB1",url:"/sounds/cicada/guest/"+konamiPath+"B-1",type:"sound"},{id:"guestB2",url:"/sounds/cicada/guest/"+konamiPath+"B-2",type:"sound"},{id:"guestB3",url:"/sounds/cicada/guest/"+konamiPath+"B-3",type:"sound"},{id:"guestC1",url:"/sounds/cicada/guest/"+konamiPath+"C-1",type:"sound"},{id:"guestC2",url:"/sounds/cicada/guest/"+konamiPath+"C-2",type:"sound"},{id:"guestC3",url:"/sounds/cicada/guest/"+konamiPath+"C-3",type:"sound"},{id:"guestD1",url:"/sounds/cicada/guest/"+konamiPath+"D-1",type:"sound"},{id:"guestD2",url:"/sounds/cicada/guest/"+konamiPath+"D-2",type:"sound"},{id:"guestD3",url:"/sounds/cicada/guest/"+konamiPath+"D-3",type:"sound"},{id:"guestAall",url:"/sounds/cicada/guest/"+konamiPath+"A-all",type:"sound"},{id:"guestBall",url:"/sounds/cicada/guest/"+konamiPath+"B-all",type:"sound"},{id:"guestCall",url:"/sounds/cicada/guest/"+konamiPath+"C-all",type:"sound"},{id:"guestDall",url:"/sounds/cicada/guest/"+konamiPath+"D-all",type:"sound"}],AssetLoader.load(assets).then(function(_assets){var i,m,ref,sound;for(i=m=0,ref=_assets.length;0<=ref?m<ref:m>ref;i=0<=ref?++m:--m)sound=_assets[i],sounds[sound.id]=sound.data;return sounds.base.loop(!0),sounds.raisingloculstes.loop(!0),sounds.base.play(),sounds.raisingloculstes.play(),sounds.raisingloculstes.volume(0),sounds.base.volume(0),sounds.raisingloculstes.pos(0),sounds.base.fade(0,.5,1e3),sounds.playerAall.volume(.7),sounds.playerBall.volume(.7),sounds.playerCall.volume(.7),sounds.playerDall.volume(.7),sounds.guestAall.volume(.7),sounds.guestBall.volume(.7),sounds.guestCall.volume(.7),sounds.guestDall.volume(.7),sounds.guestA1.volume(.4),sounds.guestA2.volume(.4),sounds.guestA3.volume(.4),sounds.guestB1.volume(.4),sounds.guestB2.volume(.4),sounds.guestB3.volume(.4),sounds.guestC1.volume(.4),sounds.guestC2.volume(.4),sounds.guestC3.volume(.4),sounds.guestD1.volume(.4),sounds.guestD2.volume(.4),sounds.guestD3.volume(.4),$scope.$emit("room.assets.loaded")})):$scope.$emit("room.assets.loaded"),settings={debug:!1,showHelpers:!1},cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.PerspectiveCamera(75,Window.width/Window.height,.1,1e5)},cameras.user.position.set(0,0,CAMERA_DEFAULT_Z),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),cameraFolder.add(cameras.user,"fov",0,200).onChange(function(_this){return function(){return onResize()}}()),renderer=new THREE.WebGLRenderer({antialias:!0,canvas:$element[0]}),composer=new WAGNER.Composer(renderer),renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),passes=[],addKonamiPasses=function(){var len1,len2,m,n,param,pass,passConfig,ref,ref1,results;if(!Browser.device){for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],m=0,len1=ref.length;m<len1;m++){for(passConfig=ref[m],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,n=0,len2=ref1.length;n<len2;n++)param=ref1[n],pass.params[param.id]=param.valueCicada;results.push(passes.push(pass))}return results}},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&(scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:16777215},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(0,10,10),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),distanceController={x1:0,y1:0,value1:0,x2:0,y2:0,value2:0},range=500,gui.add(distanceController,"x1",-range,range),gui.add(distanceController,"y1",-range,range),gui.add(distanceController,"value1",0,1),gui.add(distanceController,"x2",-range,range),gui.add(distanceController,"y2",-range,range),gui.add(distanceController,"value2",0,1),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),clientPointers=new ClientPointers(scene,{visible:!1}),clientPointers.device=Browser.device,connectionPointers=[],i=m=0,ref=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM;0<=ref?m<ref:m>ref;i=0<=ref?++m:--m)connectionPointers.push(new ConnectionPointers(scene,1,100,200));for(Browser.device?(grid=30,size=800):(grid=75,size=1e3),boomObj={progress:0},hittestMesh=null,voxelMesh=null,BGmesh=null,null,cubeSize=size/grid,cubeSizeHalf=cubeSize/2,totalVoxels=grid*grid,attrPositions=new Float32Array(3*totalVoxels*3*2),attrColors=new Float32Array(3*totalVoxels*3*2),clientColor=new THREE.Color(socketService.clientColor.user),buffer1=[],buffer2=[],liquidSettings={depth:2},resetBuffers=function(){var len,n,ref1,results;for(len=grid*grid+2*grid,results=[],i=n=0,ref1=len;0<=ref1?n<ref1:n>ref1;i=0<=ref1?++n:--n)buffer1[i]=0,results.push(buffer2[i]=0);return results},resetBuffers(),gradientMesh=null,connectedUsersData=[],i=n=0,ref1=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM;0<=ref1?n<ref1:n>ref1;i=0<=ref1?++n:--n)for(connectedUsersData[i]=[],j=o=0;o<2;j=++o)connectedUsersData[i].push({value:0,x:utils.random(-300,300),y:utils.random(-300,300),r:0,g:0,b:0});return createObjects=function(){var b1,colorB,colorG,colorR,connectionColor,g1,generateTexture,geometry,gradientMaterial,gradientTexture,height,material,p,r1,ref2,tmpColor,v0x,v0y,v1x,v1y,v2x,v2y,v3x,v3y,v4x,v4y,v5x,v5y,width,x,y;for(geometry=new THREE.BufferGeometry,i=p=0,ref2=totalVoxels;0<=ref2?p<ref2:p>ref2;i=0<=ref2?++p:--p)x=.5*-size+cubeSizeHalf+i%grid*cubeSize,y=.5*-size+cubeSizeHalf+Math.floor(i/grid)*cubeSize,0,v0x=x-cubeSizeHalf,v0y=y-cubeSizeHalf,v1x=x+cubeSizeHalf,v1y=y-cubeSizeHalf,v2x=x-cubeSizeHalf,v2y=y+cubeSizeHalf,v3x=x+cubeSizeHalf,v3y=y-cubeSizeHalf,v4x=x-cubeSizeHalf,v4y=y+cubeSizeHalf,v5x=x+cubeSizeHalf,v5y=y+cubeSizeHalf,attrPositions[18*i]=v0x,attrPositions[18*i+1]=v0y,attrPositions[18*i+2]=0,attrPositions[18*i+3]=v1x,attrPositions[18*i+4]=v1y,attrPositions[18*i+5]=0,attrPositions[18*i+6]=v2x,attrPositions[18*i+7]=v2y,attrPositions[18*i+8]=0,attrPositions[18*i+9]=v3x,attrPositions[18*i+10]=v3y,attrPositions[18*i+11]=0,attrPositions[18*i+12]=v4x,attrPositions[18*i+13]=v4y,attrPositions[18*i+14]=0,attrPositions[18*i+15]=v5x,attrPositions[18*i+16]=v5y,attrPositions[18*i+17]=0,r1=Math.random(),g1=Math.random(),b1=Math.random(),attrColors[18*i]=r1,attrColors[18*i+1]=b1,attrColors[18*i+2]=g1,attrColors[18*i+3]=r1,attrColors[18*i+4]=b1,attrColors[18*i+5]=g1,attrColors[18*i+6]=r1,attrColors[18*i+7]=b1,attrColors[18*i+8]=g1,attrColors[18*i+9]=r1,attrColors[18*i+10]=b1,attrColors[18*i+11]=g1,attrColors[18*i+12]=r1,attrColors[18*i+13]=b1,attrColors[18*i+14]=g1,attrColors[18*i+15]=r1,attrColors[18*i+16]=b1,attrColors[18*i+17]=g1;return geometry.addAttribute("position",new THREE.BufferAttribute(attrPositions,3)),geometry.addAttribute("color",new THREE.BufferAttribute(attrColors,3)),geometry.computeBoundingSphere(),material=new THREE.MeshPhongMaterial({color:11184810,specular:16777215,shininess:250,side:THREE.DoubleSide,vertexColors:THREE.VertexColors}),voxelMesh=new THREE.Mesh(geometry,material),scene.add(voxelMesh),tmpColor=new THREE.Color,connectionColor=utils.formatColorForWebgl(socketService.clientColor.user),tmpColor.setHex(connectionColor),colorR=.15*tmpColor.g,colorG=.15*tmpColor.b,colorB=.15*tmpColor.r,tmpColor.setRGB(colorR,colorG,colorB),geometry=new THREE.PlaneGeometry(Window.width,Window.height),material=new THREE.MeshLambertMaterial({color:tmpColor,wireframe:!1}),BGmesh=new THREE.Mesh(geometry,material),BGmesh.position.z=-1,scene.add(BGmesh),geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,0)),generateTexture=function(){var gradient,gradientCanvas,gradientContext,gradientSize;return gradientSize=1024,gradientCanvas=document.createElement("canvas"),gradientCanvas.width=gradientSize,gradientCanvas.height=gradientSize,gradientContext=gradientCanvas.getContext("2d"),gradientContext.rect(0,0,gradientSize,gradientSize),gradient=gradientContext.createLinearGradient(gradientSize,0,gradientSize,gradientSize),gradient.addColorStop(1,"#ffffff"),gradient.addColorStop(0,"transparent"),gradientContext.fillStyle=gradient,gradientContext.fill(),gradientCanvas},gradientTexture=new THREE.Texture(generateTexture()),gradientTexture.needsUpdate=!0,gradientMaterial=new THREE.MeshBasicMaterial({color:socketService.clientColor.user,side:THREE.DoubleSide,blending:THREE.AdditiveBlending,wireframe:!1,transparent:!0,map:gradientTexture,opacity:0}),gradientMesh=new THREE.Mesh(geometry,gradientMaterial),gradientMesh.position.z=235,gradientMesh.position.y=-Window.height/4,gradientMesh.scale.x=.5,gradientMesh.scale.y=.5,scene.add(gradientMesh),width=size,height=size,geometry=new THREE.PlaneBufferGeometry(width,height),material=new THREE.MeshBasicMaterial({color:65280,side:THREE.DoubleSide,wireframe:!0,transparent:!0,opacity:0}),hittestMesh=new THREE.Mesh(geometry,material),scene.add(hittestMesh)},createObjects(),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},boom=0,null,melodyLine="A",melodyTune=1,melodytoplay=null,updatemelody=function(){return melodyLine="A"===melodyLine?"B":"B"===melodyLine?"C":"C"===melodyLine?"D":"A"},setInterval(updatemelody,500),updateBufferPointersStart=function(){return TweenMax.killTweensOf(liquidSettings),liquidSettings.depth=.6},updateBufferPointersEnd=function(pointers){var len1,p,pointer;if(3===melodyTune?melodyTune=1:melodyTune++,-1,TweenMax.killTweensOf(liquidSettings),1===boom)liquidSettings.depth=2.3,TweenMax.to(liquidSettings,1.5,{depth:.6,delay:.1}),gradientMesh.material.opacity=1,TweenMax.to(gradientMesh.material,2,{opacity:0}),VOID_SETTINGS.SOUND_ENABLED&&("A"===melodyLine&&sounds.playerAall.play(),"B"===melodyLine&&sounds.playerBall.play(),"C"===melodyLine&&sounds.playerCall.play(),"D"===melodyLine&&sounds.playerDall.play());else if(liquidSettings.depth=1.5,TweenMax.to(liquidSettings,1.5,{depth:.6,delay:.1}),VOID_SETTINGS.SOUND_ENABLED&&(pointers?("A"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.playerA1),2===melodyTune&&(melodytoplay=sounds.playerA2),3===melodyTune&&(melodytoplay=sounds.playerA3)),"B"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.playerB1),2===melodyTune&&(melodytoplay=sounds.playerB2),3===melodyTune&&(melodytoplay=sounds.playerB3)),"C"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.playerC1),2===melodyTune&&(melodytoplay=sounds.playerC2),3===melodyTune&&(melodytoplay=sounds.playerC3)),"D"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.playerD1),2===melodyTune&&(melodytoplay=sounds.playerD2),3===melodyTune&&(melodytoplay=sounds.playerD3))):("A"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.guestA1),2===melodyTune&&(melodytoplay=sounds.guestA2),3===melodyTune&&(melodytoplay=sounds.guestA3)),"B"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.guestB1),2===melodyTune&&(melodytoplay=sounds.guestB2),3===melodyTune&&(melodytoplay=sounds.guestB3)),"C"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.guestC1),2===melodyTune&&(melodytoplay=sounds.guestC2),3===melodyTune&&(melodytoplay=sounds.guestC3)),"D"===melodyLine&&(1===melodyTune&&(melodytoplay=sounds.guestD1),2===melodyTune&&(melodytoplay=sounds.guestD2),3===melodyTune&&(melodytoplay=sounds.guestD3))),melodytoplay.play(),pointers))for(p=0,len1=pointers.length;p<len1;p++)pointer=pointers[p],melodytoplay.pos(4*(pointer.x-.5),4*(pointer.y-.5));return boom=0},currentBufferIndex=-1,updateUserBufferPointers=function(_pointerVectors,touchend){var len1,p,results,vector,x,z;for(null==touchend&&(touchend=!1),results=[],p=0,len1=_pointerVectors.length;p<len1;p++)vector=_pointerVectors[p],x=vector.x+size/2,z=vector.y+size/2,x=Math.floor(x/size*grid),z=Math.floor(z/size*grid),currentBufferIndex=x+z*grid+grid,results.push(buffer1[currentBufferIndex]=liquidSettings.depth);return results},10,tmpColor=new THREE.Color,connectionColor=utils.formatColorForWebgl(socketService.clientColor.user),tmpColor.setHex(connectionColor),tmpColor.r,tmpColor.g,tmpColor.b,time=0,update=function(){var b,connectedData,connectedDataTouch,distance,g,highestIndex,highestPosition,k,l,lastHighestDepth,len1,len2,minB,minG,minR,p,q,r,temp,x1,x2,y1,y2,z;for(time+=.01,ambLight.color.setHex(String(lights.ambient.color).replace("#","0x")),dirLight.color.setHex(String(lights.directional.color).replace("#","0x")),settings.debug&&null!=controls&&controls.update(),i=grid,l=grid*grid+grid;i<l;)x1=void 0,x2=void 0,y1=void 0,y2=void 0,i%grid==0?(x1=0,x2=buffer1[i+1]):i%grid==grid-1?(x1=buffer1[i-1],x2=0):(x1=buffer1[i-1],x2=buffer1[i+1]),i<grid?(y1=0,y2=buffer1[i+grid]):i>l-grid-1?(y1=buffer1[i-grid],y2=0):(y1=buffer1[i-grid],y2=buffer1[i+grid]),buffer2[i]=(x1+x2+y1+y2)/2-buffer2[i],buffer1[i]+=(buffer2[i]-buffer1[i])/4,i++;for(temp=buffer1,buffer1=buffer2,buffer2=temp,i=0,l=grid*grid,minR=.2*clientColor.g,minG=.2*clientColor.b,minB=.2*clientColor.r,highestPosition=0,highestIndex=0;i<l;){for(z=350*(THREE.Math.clamp(buffer2[i+grid]*liquidSettings.depth,.2,.4)-.2),attrPositions[18*i+2]=z,attrPositions[18*i+5]=z,attrPositions[18*i+8]=z,attrPositions[18*i+11]=z,attrPositions[18*i+14]=z,attrPositions[18*i+17]=z,z>highestPosition&&(highestPosition=z,highestIndex=i),r=clientColor.r*THREE.Math.clamp(buffer2[i+grid],.01,.8)/4+minR,g=clientColor.g*THREE.Math.clamp(buffer2[i+grid],.01,.8)/4+minG,b=clientColor.b*THREE.Math.clamp(buffer2[i+grid],.01,.8)/4+minB,k=p=0,len1=connectedUsersData.length;p<len1;k=++p)for(connectedData=connectedUsersData[k],q=0,len2=connectedData.length;q<len2;q++)connectedDataTouch=connectedData[q],distance=Math.abs(utils.distance(connectedDataTouch.y,attrPositions[18*i+1],connectedDataTouch.x,attrPositions[18*i])),distance=distance.map(0,800,1,0),0===k?(r+=connectedDataTouch.r*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)*2.5,g+=connectedDataTouch.g*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)*2.5,b+=connectedDataTouch.b*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)*2.5):(Math.abs(r+=connectedDataTouch.r*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)),Math.abs(g+=connectedDataTouch.g*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)),Math.abs(b+=connectedDataTouch.b*connectedDataTouch.value*distance*THREE.Math.clamp(buffer2[i+grid],-5,1)));attrColors[18*i]=r,attrColors[18*i+1]=g,attrColors[18*i+2]=b,attrColors[18*i+3]=r,attrColors[18*i+4]=g,attrColors[18*i+5]=b,attrColors[18*i+6]=r,attrColors[18*i+7]=g,attrColors[18*i+8]=b,attrColors[18*i+9]=r,attrColors[18*i+10]=g,attrColors[18*i+11]=b,attrColors[18*i+12]=r,attrColors[18*i+13]=g,attrColors[18*i+14]=b,attrColors[18*i+15]=r,attrColors[18*i+16]=g,attrColors[18*i+17]=b,i++}return touch.isDown&&(lastHighestDepth=attrPositions[3*currentBufferIndex+2],attrPositions[18*highestIndex+2]=lastHighestDepth,attrPositions[18*highestIndex+2]=z,attrPositions[18*highestIndex+5]=z,attrPositions[18*highestIndex+8]=z,attrPositions[18*highestIndex+11]=z,attrPositions[18*highestIndex+14]=z,attrPositions[18*highestIndex+17]=z,attrPositions[18*currentBufferIndex+2]=highestPosition,attrPositions[18*currentBufferIndex+5]=highestPosition,attrPositions[18*currentBufferIndex+8]=highestPosition,attrPositions[18*currentBufferIndex+11]=highestPosition,attrPositions[18*currentBufferIndex+14]=highestPosition,attrPositions[18*currentBufferIndex+17]=highestPosition,attrColors[18*currentBufferIndex]+=boomObj.progress,attrColors[18*currentBufferIndex+1]+=boomObj.progress,attrColors[18*currentBufferIndex+2]+=boomObj.progress,attrColors[18*currentBufferIndex+3]+=boomObj.progress,attrColors[18*currentBufferIndex+4]+=boomObj.progress,attrColors[18*currentBufferIndex+5]+=boomObj.progress,attrColors[18*currentBufferIndex+6]+=boomObj.progress,attrColors[18*currentBufferIndex+7]+=boomObj.progress,attrColors[18*currentBufferIndex+8]+=boomObj.progress,attrColors[18*currentBufferIndex+9]+=boomObj.progress,attrColors[18*currentBufferIndex+10]+=boomObj.progress,attrColors[18*currentBufferIndex+11]+=boomObj.progress,attrColors[18*currentBufferIndex+12]+=boomObj.progress,attrColors[18*currentBufferIndex+13]+=boomObj.progress,attrColors[18*currentBufferIndex+14]+=boomObj.progress,attrColors[18*currentBufferIndex+15]+=boomObj.progress,attrColors[18*currentBufferIndex+16]+=boomObj.progress,attrColors[18*currentBufferIndex+17]+=boomObj.progress),voxelMesh.geometry.attributes.position.needsUpdate=!0,voxelMesh.geometry.attributes.color.needsUpdate=!0},onResize=function(){var divisor,height,ratio,standardRatio,width,windowRatio;return width=Window.width,height=Window.height,ratio=width/height,standardRatio=1280/720,windowRatio=width/height,divisor=windowRatio/standardRatio,divisor=Math.max(divisor,1),voxelMesh.scale.set(divisor,divisor,1),hittestMesh.scale.set(divisor,divisor,1),BGmesh.scale.set(divisor,divisor,1),cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.user.left=width/-2,cameras.user.right=width/2,cameras.user.top=height/2,cameras.user.bottom=height/-2,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(width,height),composer.setSize(width,height),$$element.attr({width:Window.width,height:Window.height})},onResize(),onWindowIdle=function(){return IS_IDLE=!0,resetBuffers()},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),_render=function(camera,left,bottom,width,height){return left*=Window.width,bottom*=Window.height,width*=Window.width,height*=Window.height,renderer.setViewport(left,bottom,width,height),renderer.setScissor(left,bottom,width,height),renderer.enableScissorTest(!0),renderer.setClearColor(0,1),renderer.render(scene,camera)},render=function(){var len1,p,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE){if(update(),settings.debug)return _render(cameras.dev,0,0,1,1);for(composer.reset(),composer.render(scene,cameras.user),p=0,len1=passes.length;p<len1;p++)pass=passes[p],composer.pass(pass);return composer.toScreen()}},raycaster=new THREE.Raycaster,mouse=new THREE.Vector3(0,0,.5),pointersEnabledTweens={},tmpColor=new THREE.Color,updateConnectedUsersDataStart=function(connectionIndex,userColor,pointerVectors){var len1,p,tweenId,vector;for(tmpColor.setHex(userColor),j=0,i=p=0,len1=pointerVectors.length;p<len1&&(vector=pointerVectors[i],!(i>MAX_POINTERS_FOR_TOUCH));i=++p)j++,connectedUsersData[connectionIndex][i].x=vector.x,connectedUsersData[connectionIndex][i].y=vector.y,connectedUsersData[connectionIndex][i].r=tmpColor.r,connectedUsersData[connectionIndex][i].g=tmpColor.g,connectedUsersData[connectionIndex][i].b=tmpColor.b;return tweenId=connectionIndex+":"+connectionIndex,null!=pointersEnabledTweens[tweenId]&&pointersEnabledTweens[tweenId].kill(),pointersEnabledTweens[tweenId]=new CicadaPointerTween(connectionIndex,connectedUsersData,0,1,.5,j)},updateConnectedUsersDataMove=function(connectionIndex,userColor,pointerVectors){var len1,p,results,vector;for(tmpColor.setHex(userColor),results=[],i=p=0,len1=pointerVectors.length;p<len1&&(vector=pointerVectors[i],!(i>MAX_POINTERS_FOR_TOUCH));i=++p)connectedUsersData[connectionIndex][i].x=vector.x,connectedUsersData[connectionIndex][i].y=vector.y,connectedUsersData[connectionIndex][i].r=tmpColor.r,connectedUsersData[connectionIndex][i].g=tmpColor.g,results.push(connectedUsersData[connectionIndex][i].b=tmpColor.b);return results},updateConnectedUsersDataEnd=function(connectionIndex){var tweenId;return tweenId=connectionIndex+":"+connectionIndex,null!=pointersEnabledTweens[tweenId]&&pointersEnabledTweens[tweenId].kill(),pointersEnabledTweens[tweenId]=new CicadaPointerTween(connectionIndex,connectedUsersData,1,0,5,2)},getPointerVectors=function(pointers){var intersects,len1,p,pointer,pointerVectors;for(pointerVectors=[],i=p=0,len1=pointers.length;p<len1;i=++p)pointer=pointers[i],mouse.x=2*pointer.x-1,mouse.y=2*-pointer.y+1,raycaster.setFromCamera(mouse,cameras.user),intersects=raycaster.intersectObject(hittestMesh),intersects.length>0&&pointerVectors.push(intersects[0].point);return pointerVectors},boomTimer=null,onTouchStart=function(pointers){var pointerVectors;if(pointers,pointerVectors=getPointerVectors(pointers),clientPointers.onTouchStart(pointerVectors),updateBufferPointersStart(pointerVectors),updateUserBufferPointers(pointerVectors),updateConnectedUsersDataStart(0,socketService.clientColor.user,pointerVectors),socketService.pushUserInteractionStartEvent(pointers),TweenMax.killTweensOf(boomTimer),boomObj.progress=0,boomTimer=TweenMax.to(boomObj,1,{progress:1,onComplete:function(_this){return function(){return c.debug("boom is 1"),boom=1}}()}),VOID_SETTINGS.SOUND_ENABLED)return sounds.raisingloculstes.volume(.4),sounds.raising.stop(),sounds.raising.play(),sounds.raising.rate(utils.random(.8,1.3)),sounds.raising.volume(.2)},onTouchMove=function(pointers){var len1,p,pointer,pointerVectors,userPointers;if(userPointers=pointers,pointerVectors=getPointerVectors(pointers),clientPointers.onTouchMove(pointerVectors),updateUserBufferPointers(pointerVectors),updateConnectedUsersDataMove(0,socketService.clientColor.user,pointerVectors),VOID_SETTINGS.SOUND_ENABLED)for(p=0,len1=userPointers.length;p<len1;p++)pointer=userPointers[p],sounds.raising.pos(4*(pointer.x-.5),4*(pointer.y-.5)),sounds.raisingloculstes.pos(4*(pointer.x-.5),4*(pointer.y-.5));return socketService.pushUserInteractionEvent(pointers)},onTouchEnd=function(pointers){if(getPointerVectors(pointers),updateBufferPointersEnd(pointers),updateConnectedUsersDataEnd(0),socketService.pushUserInteractionEndEvent(pointers),clientPointers.onTouchEnd(pointers),TweenMax.killTweensOf(boomTimer),boomTimer=TweenMax.to(boomObj,1,{progress:0}),VOID_SETTINGS.SOUND_ENABLED)return sounds.raisingloculstes.fade(.2,0,500),sounds.raising.fade(.15,0,500)},touch=new Touch($element,{touchdownInterval:!0}),touch.bind(),touch.on("touchstart",onTouchStart),touch.on("touchmove",onTouchMove),touch.on("touchend",onTouchEnd),connectionIndex=1,connectionData={},onUserActionStart=function(event,data){var pointerVectors;if(null==connectionData[data.clientId]&&(connectionData[data.clientId]=[]),connectionData[data.clientId][data.uuid]={index:connectionIndex,pointers:data.pointers,color:data.clientColor},pointerVectors=getPointerVectors(data.pointers),connectionPointers[connectionIndex].onTouch(pointerVectors,data.clientColor),updateBufferPointersStart(),updateUserBufferPointers(pointerVectors),updateConnectedUsersDataStart(connectionIndex,data.clientColor,pointerVectors),++connectionIndex>=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM)return connectionIndex=1},onUserAction=function(event,data){var _connectionIndex,pointerVectors;return connectionData[data.clientId][data.uuid].pointers=data.pointers,connectionData[data.clientId][data.uuid].color=data.clientColor,_connectionIndex=connectionData[data.clientId][data.uuid].index,pointerVectors=getPointerVectors(data.pointers),updateUserBufferPointers(pointerVectors),updateConnectedUsersDataMove(_connectionIndex,data.clientColor,pointerVectors),connectionPointers[_connectionIndex].onTouch(pointerVectors,data.clientColor)},onUserActionEnd=function(event,data){var _connectionIndex,pointerVectors,ref2,uuid;ref2=connectionData[data.clientId];for(uuid in ref2)ref2[uuid],_connectionIndex=connectionData[data.clientId][data.uuid].index,connectionData[data.clientId][data.uuid].pointers=data.pointers,connectionData[data.clientId][data.uuid].color=data.clientColor,connectionPointers[_connectionIndex].onTouchEnd(),pointerVectors=getPointerVectors(data.pointers),updateBufferPointersEnd(),updateUserBufferPointers(pointerVectors,!0),updateConnectedUsersDataEnd(_connectionIndex);return delete connectionData[data.clientId]},onClientColorChange=function(event,data){return clientColor.setHex(utils.formatColorForWebgl(data.userColor))},unbindUserInteractionStartHandler=$rootScope.$on("user.interaction.start",onUserActionStart),unbindUserInteractionHandler=$rootScope.$on("user.interaction",onUserAction),unbindUserInteractionEndHandler=$rootScope.$on("user.interaction.end",onUserActionEnd),unbindClientColorChange=$rootScope.$on("socket.clientcolor.change",onClientColorChange),unbindAnimateOut=$rootScope.$on("room.animate.out.start",function(){if(VOID_SETTINGS.SOUND_ENABLED)return sounds.base.fade(1,0,2e3),$timeout(function(){var id,sound;for(id in sounds)sound=sounds[id],"function"==typeof sound.unload&&sound.unload();return sounds=null},2e3)}),$scope.$on("$destroy",function(){var len1,object,p,ref2;for(DESTROY=!0,c.log("[Glitch] destroy"),gui.destroy(),unbindAnimateOut(),unbindAnimateOut=null,unbindUserInteractionStartHandler(),unbindUserInteractionStartHandler=null,unbindUserInteractionHandler(),unbindUserInteractionHandler=null,unbindUserInteractionEndHandler(),unbindUserInteractionEndHandler=null,unbindClientColorChange(),unbindClientColorChange=null,touch.off("touchstart",onTouchStart),touch.off("touchmove",onTouchMove),touch.off("touchend",onTouchEnd),touch.unbind(),Window.off("resize",onResize),Window.off("focus",onWindowFocused),Window.off("idle",onWindowIdle),ref2=scene.children,p=0,len1=ref2.length;p<len1;p++)object=ref2[p],scene.remove(object);return renderer.domElement.addEventListener("dblclick",null,!1),renderer.domElement=null,renderer=null,scene=null}),zoom(cameras.dev,150),render(),setTimeout(function(){var x,z;return x=Math.floor(Math.random()*grid),z=Math.floor(Math.random()*grid),buffer1[x+z*grid+grid]=liquidSettings.depth},1e3)}}}return RoomVisualCicada}(),angular.module("app").directive("roomVisualCicada",["$rootScope","GUI","Window","AssetLoader","Browser","lodash","$timeout","socketService","sessionService","Geometry",RoomVisualCicada]);var DigitalSkinShaders;DigitalSkinShaders=function(){function DigitalSkinShaders(Shaders){return{vertexShaderForRoom:function(MAX_POINTERS){return null==MAX_POINTERS&&(MAX_POINTERS=0),["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Shaders.snoise2(),THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"float mapFloat(float num, float in_min, float in_max, float out_min, float out_max) {","return (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;","}","float rand(vec2 co){","return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);","}","uniform float time;","uniform vec3 pointers["+MAX_POINTERS+"];","uniform float pointersEnabled["+MAX_POINTERS+"];","uniform int isDesktop;","void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"vec3 newPosition = vec3(0.0);","float maxDistance = 10.0;","for(int i = 0; i < "+MAX_POINTERS+"; i++){","if(pointersEnabled[i] > 0.0){","vec3 pointerPosition = pointers[i];","float dist = mapFloat(distance(pointerPosition, position), 0.0, maxDistance, 1.0, 0.0);","dist = abs(clamp(dist, 0.0, 1.0));","if (isDesktop == 1) {","newPosition.z += (-70.0 * pointersEnabled[i]) * dist;","}","}","}","if (isDesktop == 1) {","newPosition.z += sin(time * 0.04 + (position.x * 0.01)) * snoise(position.xy * 0.01) * 60.0;","}","mvPosition = modelViewMatrix * vec4( position + newPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},vertexShaderForMenu:function(MAX_POINTERS){return null==MAX_POINTERS&&(MAX_POINTERS=0),["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Shaders.snoise2(),THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"uniform float time;","void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"vec3 newPosition = vec3(0.0);","newPosition.z += sin(time * 0.25 + (position.x * 0.02)) * snoise(position.xy * 0.01) * 10.0;","mvPosition = modelViewMatrix * vec4( position + newPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")}}}return DigitalSkinShaders}(),angular.module("app").factory("DigitalSkinShaders",["Shaders",DigitalSkinShaders]);var DigitalSkinPointerTween,RoomVisualDigitalSkin;DigitalSkinPointerTween=function(){function DigitalSkinPointerTween(uniformIndex1,uniforms,value,endValue){var params;this.uniformIndex=uniformIndex1,this.value=null!=value?value:0,this.endValue=null!=endValue?endValue:1,params={value:this.endValue,onUpdate:function(_this){return function(){return uniforms.pointersEnabled.value[_this.uniformIndex]=_this.value}}(this)},TweenMax.to(this,.5,params)}return DigitalSkinPointerTween.prototype.kill=function(){return TweenMax.killTweensOf(this)},DigitalSkinPointerTween}(),RoomVisualDigitalSkin=function(){function RoomVisualDigitalSkin($rootScope,GUI,Window,AssetLoader,Browser,lodash,$timeout,socketService,sessionService,Geometry,DigitalSkinShaders){return{restrict:"A",link:function($scope,$element){
var $$element,DESTROY,IS_IDLE,RemoveLive,SOUND_BASE_VOLUME,addKonamiPasses,ambLight,animateFace,animateFaceRandom,animatePointersIn,animatePointersOut,assets,cameraFolder,cameras,clientPointers,composer,connectionColor,connectionData,connectionIndex,connectionPointers,controls,createObjects,dirLight,distance,faceTweens,faceTweensRandom,fingers,globaldistance,gui,helperAxis,helperCamera,helperGrid,hittestMesh,i,indexBeat,indexTempo,intervalTempo,j,konamiPath,lightFolder,lights,material,mesh,mouse,onClientColorChange,onResize,onTouchEnd,onTouchMove,onTouchStart,onUserAction,onUserActionEnd,onUserActionStart,onWindowFocused,onWindowIdle,passes,platform,pointersEnabledTweens,randomFacesLuminosity,range,raycaster,ref,render,renderer,scene,settings,sounds,speedTempo,time,tmpColor1,tmpColorRandom,touch,unbindAnimateOut,unbindClientColorChange,unbindUserInteractionEndHandler,unbindUserInteractionHandler,unbindUserInteractionStartHandler,uniforms,update,updateMeshFromPosition,updateTempo,userPointers,zoom;for(DESTROY=!1,IS_IDLE=!1,$$element=$($element),gui=new GUI.create,gui.addFolder("digital-skin"),gui.open(),SOUND_BASE_VOLUME=.2,VOID_SETTINGS.SOUND_ENABLED?(sounds={base:null,line1:null,line2:null,line3:null,bellsA:[]},konamiPath=sessionService.get("konamiPath"),assets=[{id:"base",url:"/sounds/digital-skin/"+konamiPath+"layer-base",type:"sound"},{id:"line1",url:"/sounds/digital-skin/"+konamiPath+"line1",type:"sound"},{id:"line2",url:"/sounds/digital-skin/"+konamiPath+"line2",type:"sound"},{id:"line3",url:"/sounds/digital-skin/"+konamiPath+"line3",type:"sound"},{id:"bellA_1",url:"/sounds/digital-skin/"+konamiPath+"bell1",type:"sound"},{id:"bellA_2",url:"/sounds/digital-skin/"+konamiPath+"bell2",type:"sound"},{id:"bellA_3",url:"/sounds/digital-skin/"+konamiPath+"bell3",type:"sound"},{id:"bellA_4",url:"/sounds/digital-skin/"+konamiPath+"bell4",type:"sound"},{id:"bellA_5",url:"/sounds/digital-skin/"+konamiPath+"bell5",type:"sound"},{id:"bellA_6",url:"/sounds/digital-skin/"+konamiPath+"bell6",type:"sound"},{id:"bellA_7",url:"/sounds/digital-skin/"+konamiPath+"bell7",type:"sound"},{id:"bellA_8",url:"/sounds/digital-skin/"+konamiPath+"bell8",type:"sound"}],AssetLoader.load(assets).then(function(_assets){var i,j,ref,sound;for(i=j=0,ref=_assets.length;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)sound=_assets[i],sound.id.match("bellA")&&sounds.bellsA.push(sound.data);return sounds.base=_assets[0].data,sounds.line1=_assets[1].data,sounds.line2=_assets[2].data,sounds.line3=_assets[3].data,sounds.base.pos(0),sounds.base.loop(!0),sounds.line1.loop(!0),sounds.line2.loop(!0),sounds.line3.loop(!0),sounds.base.volume(SOUND_BASE_VOLUME),sounds.line1.volume(0),sounds.line2.volume(0),sounds.line3.volume(0),sounds.base.play(),sounds.line1.play(),sounds.line2.play(),sounds.line3.play(),$scope.$emit("room.assets.loaded")})):$scope.$emit("room.assets.loaded"),settings={debug:!1,showHelpers:!1,camera:{z:{desktop:400,device:200}},tilesSpeed:{desktop:100,device:20},tiles:{desktop:[10,100],device:[30,30]}},platform=Browser.device?"device":"desktop",cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.PerspectiveCamera(12,Window.width/Window.height,.1,1e5)},cameras.user.position.set(0,0,settings.camera.z[platform]),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0,canvas:$element[0]}),composer=new WAGNER.Composer(renderer),renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),passes=[],addKonamiPasses=function(){var j,k,len,len1,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],j=0,len=ref.length;j<len;j++){for(passConfig=ref[j],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,k=0,len1=ref1.length;k<len1;k++)param=ref1[k],pass.params[param.id]=param.value;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),scene=new THREE.Scene,helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&(scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:4473924},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(1,1,1).normalize(),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),clientPointers=new ClientPointers(scene),connectionPointers=[],i=j=0,ref=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM;0<=ref?j<ref:j>ref;i=0<=ref?++j:--j)connectionPointers.push(new ConnectionPointers(scene));return connectionIndex=1,connectionData={},mesh=null,hittestMesh=null,userPointers=[],uniforms=null,material=null,createObjects=function(){var geometry,height,isDesktop,k,lambert,ref1,width;for(lambert=THREE.ShaderLib.lambert,isDesktop=Browser.desktop?1:-1,uniforms=THREE.UniformsUtils.merge([lambert.uniforms,{time:{type:"f",value:0},isDesktop:{type:"i",value:isDesktop},pointers:{type:"v3v",value:[]},pointersEnabled:{type:"fv1",value:[]}}]),i=k=0,ref1=VOID_SETTINGS.MAX_POINTERS*VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM;0<=ref1?k<ref1:k>ref1;i=0<=ref1?++k:--k)uniforms.pointers.value.push(new THREE.Vector3(0,0,0)),uniforms.pointersEnabled.value.push(0);return c.log("TOTAL UNIFORM POINTERS",uniforms.pointers.value.length),material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:DigitalSkinShaders.vertexShaderForRoom(uniforms.pointers.value.length),fragmentShader:lambert.fragmentShader,vertexColors:THREE.VertexColors,lights:!0}),geometry=Geometry.tiles(settings.tiles[platform][0],settings.tiles[platform][1],5,10,utils.formatColorForWebgl(socketService.clientColor.user)),mesh=new THREE.Mesh(geometry,material),mesh.receiveShadow=!1,scene.add(mesh),width=500,height=500,geometry=new THREE.PlaneBufferGeometry(width,height),material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:!0,transparent:!0,opacity:0}),hittestMesh=new THREE.Mesh(geometry,material),scene.add(hittestMesh)},createObjects(),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},10,tmpColor1=new THREE.Color,connectionColor=socketService.clientColor.user,tmpColor1.setHex(connectionColor),tmpColor1.getHSL().h,tmpColor1.getHSL().s,time=0,update=function(){if(time+=.01,uniforms.time.value+=.1,mesh.geometry.colorsNeedUpdate=!0,settings.debug)return null!=controls?controls.update():void 0},faceTweensRandom={},{},tmpColorRandom=new THREE.Color,animateFaceRandom=function(face,_connectionIndex,connectionColor){var color,connectionColorHSL,faceId,h,l,s;if(null!=face)return faceId=face.a+":"+face.b+":"+face.c,null!=faceTweensRandom[faceId]&&faceTweensRandom[faceId].kill(),connectionColorHSL=tmpColorRandom.setHex(connectionColor).getHSL(),h=connectionColorHSL.h,s=connectionColorHSL.s,l=connectionColorHSL.l,color={h:h,s:s,l:l},face.vertexColors[0].setHSL(h,s,l),l=.04,utils.random(1,5)>2&&(l=utils.random(.04,.08)),faceTweensRandom[faceId]=TweenMax.to(color,.8,{h:connectionColorHSL.h,s:connectionColorHSL.s,l:l,onUpdate:function(){return face.vertexColors[0].setHSL(color.h,color.s,color.l)},onComplete:function(_this){return function(){return delete faceTweensRandom[faceId]}}()})},randomFacesLuminosity=function(){var face;return face=mesh.geometry.faces[Math.floor(Math.random()*mesh.geometry.faces.length)-1],animateFaceRandom(face,0,utils.formatColorForWebgl(socketService.clientColor.user))},setInterval(randomFacesLuminosity,settings.tilesSpeed[platform]),onResize=function(){var height,ratio,width;return width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(width,height),composer.setSize(width,height),$$element.attr({width:Window.width,height:Window.height})},onResize(),onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),render=function(){var k,len,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE){if(update(),settings.debug)return renderer.render(scene,cameras.dev);for(composer.reset(),composer.render(scene,cameras.user),k=0,len=passes.length;k<len;k++)pass=passes[k],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,50),render(),faceTweens={},pointersEnabledTweens={},new THREE.Color,intervalTempo=null,connectionIndex=1,connectionData={},animateFace=function(face,_connectionIndex,connectionColor){var _connectionData,color,connectionColorHSL,distance,faceId,firstUUID,h,k,keys,l,len,m,originalColor,pointer,ref1,ref2,results,s,sound,x,y;if(faceId=face.a+":"+face.b+":"+face.c,null==faceTweens[faceId]&&(connectionColorHSL=tmpColorRandom.setHex(connectionColor).getHSL(),originalColor=tmpColorRandom.setHex(socketService.clientColor.user).getHSL(),h=connectionColorHSL.h,s=connectionColorHSL.s,l=connectionColorHSL.l,color=0===_connectionIndex?{h:h+.08,s:s,l:1}:{h:h+.08,s:s,l:l},face.vertexColors[0].setHSL(h,s,l),l=.04,utils.random(1,5)>2&&(l=utils.random(.04,.08)),faceTweens[faceId]=TweenMax.to(color,.8,{h:connectionColorHSL.h,s:connectionColorHSL.s,l:l,onUpdate:function(){return face.vertexColors[0].setHSL(color.h,color.s,color.l)},onComplete:function(_this){return function(){return faceTweens[faceId]=TweenMax.to(color,.2,{h:originalColor.h,s:originalColor.s,l:l,onUpdate:function(){return face.vertexColors[0].setHSL(color.h,color.s,color.l)},onComplete:function(){return delete faceTweens[faceId]}})}}()}),VOID_SETTINGS.SOUND_ENABLED)){if(0===_connectionIndex&&(sound=lodash.shuffle(sounds.bellsA)[0],null!=sound&&sound.play(),userPointers.length>0))for(k=0,len=userPointers.length;k<len;k++)pointer=userPointers[k],x=2*Math.abs(pointer.x-.5),y=2*Math.abs(pointer.y-.5),distance=utils.distance(x,0,y,0),distance=Math.abs(1.5-distance),null!=sound&&sound.rate(distance),null!=sound&&sound.pos(2*(pointer.x-.5),2*(pointer.y-.5));for(results=[],i=m=1,ref1=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM;1<=ref1?m<ref1:m>ref1;i=1<=ref1?++m:--m)keys=Object.keys(connectionData),null!=connectionData[keys[i-1]]?(_connectionData=connectionData[keys[i-1]],firstUUID=Object.keys(_connectionData)[0],userPointers=(null!=(ref2=_connectionData[firstUUID])?ref2.pointers:void 0)||[],1===_connectionIndex?sounds.line1.volume(sounds.line1.volume()+.1):2===_connectionIndex?sounds.line2.volume(sounds.line2.volume()+.1):sounds.line3.volume(sounds.line3.volume()+.1),results.push(function(){var len1,n,results1;for(results1=[],n=0,len1=userPointers.length;n<len1;n++)pointer=userPointers[n],x=2*Math.abs(pointer.x-.5),y=2*Math.abs(pointer.y-.5),distance=utils.distance(x,0,y,0),distance=1-distance/20,sounds.line1.rate(distance),sounds.line2.rate(distance),sounds.line3.rate(distance),sounds.line1.pos(2*(pointer.x-.5),2*(pointer.y-.5)),sounds.line2.pos(2*(pointer.x-.5),2*(pointer.y-.5)),results1.push(sounds.line3.pos(2*(pointer.x-.5),2*(pointer.y-.5)));return results1}())):results.push(void 0);return results}},indexTempo=0,indexBeat=0,speedTempo=4,globaldistance=1,distance=1,fingers=null,RemoveLive=function(){function RemoveLive(line){setTimeout(function(){try{return scene.remove(line)}catch(error){error}},100)}return RemoveLive}(),updateTempo=function(){var geometry,k,len,line,pointer,sound,x,x0,x1,x2,x3,y,y0,y1,y2,y3;if(sounds.line1&&sounds.line1.volume(sounds.line1.volume()-.015),sounds.line2&&sounds.line2.volume(sounds.line2.volume()-.015),sounds.line3&&sounds.line3.volume(sounds.line3.volume()-.015),fingers>=1)for(k=0,len=userPointers.length;k<len;k++)pointer=userPointers[k],x=2*Math.abs(pointer.x-.5),y=2*Math.abs(pointer.y-.5),distance=utils.distance(x,0,y,0),distance=Math.abs(1-distance);return 2===fingers&&(x0=2*Math.abs(userPointers[0].x-.5),y0=2*Math.abs(userPointers[0].y-.5),x1=2*Math.abs(userPointers[1].x-.5),y1=2*Math.abs(userPointers[1].y-.5),distance=(x0+x1+y0+y1)/4,distance=Math.abs(1-distance),globaldistance=distance,material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line)),3===fingers&&(x0=2*Math.abs(userPointers[0].x-.5),y0=2*Math.abs(userPointers[0].y-.5),x1=2*Math.abs(userPointers[1].x-.5),y1=2*Math.abs(userPointers[1].y-.5),x2=2*Math.abs(userPointers[2].x-.5),y2=2*Math.abs(userPointers[2].y-.5),globaldistance=(x0+x1+x2+y0+y1+y2)/6,globaldistance=Math.abs(1-globaldistance),distance=(x0+x1+y0+y1)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x2+x1+y2+y1)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[2].x+utils.random(-1,1),clientPointers.pointers[2].y+utils.random(-1,1),clientPointers.pointers[2].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x0+x2+y0+y2)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[2].x+utils.random(-1,1),clientPointers.pointers[2].y+utils.random(-1,1),clientPointers.pointers[2].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line)),fingers>=4&&(x0=2*Math.abs(userPointers[0].x-.5),y0=2*Math.abs(userPointers[0].y-.5),x1=2*Math.abs(userPointers[1].x-.5),y1=2*Math.abs(userPointers[1].y-.5),x2=2*Math.abs(userPointers[2].x-.5),y2=2*Math.abs(userPointers[2].y-.5),x3=2*Math.abs(userPointers[3].x-.5),y3=2*Math.abs(userPointers[3].y-.5),globaldistance=(x0+x1+x2+y0+y1+y2)/6,globaldistance=Math.abs(1-globaldistance),distance=(x0+x1+y0+y1)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x2+x1+y2+y1)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[2].x+utils.random(-1,1),clientPointers.pointers[2].y+utils.random(-1,1),clientPointers.pointers[2].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x2+x3+y2+y3)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[2].x+utils.random(-1,1),clientPointers.pointers[2].y+utils.random(-1,1),clientPointers.pointers[2].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[3].x+utils.random(-1,1),clientPointers.pointers[3].y+utils.random(-1,1),clientPointers.pointers[3].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x0+x2+y0+y2)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[2].x+utils.random(-1,1),clientPointers.pointers[2].y+utils.random(-1,1),clientPointers.pointers[2].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x3+x1+y3+y1)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[1].x+utils.random(-1,1),clientPointers.pointers[1].y+utils.random(-1,1),clientPointers.pointers[1].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[3].x+utils.random(-1,1),clientPointers.pointers[3].y+utils.random(-1,1),clientPointers.pointers[3].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line),distance=(x0+x3+y0+y3)/4,distance=Math.abs(1-distance),material=new THREE.LineBasicMaterial({color:16777215,transparent:!0}),material.opacity=utils.random(0,1)*distance*4-.6,geometry=new THREE.Geometry,geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[0].x+utils.random(-1,1),clientPointers.pointers[0].y+utils.random(-1,1),clientPointers.pointers[0].z+utils.random(1,2))),geometry.vertices.push(new THREE.Vector3(clientPointers.pointers[3].x+utils.random(-1,1),clientPointers.pointers[3].y+utils.random(-1,1),clientPointers.pointers[3].z+utils.random(1,2))),line=new THREE.Line(geometry,material),scene.add(line),new RemoveLive(line)),2===fingers?speedTempo=distance>.3&&distance<.6?6:distance<=.3?10:4:3===fingers?speedTempo=4:4===fingers?speedTempo=2:fingers>=5&&(speedTempo=1),1,time=0,VOID_SETTINGS.SOUND_ENABLED&&indexTempo>speedTempo&&(indexTempo=0,2===fingers&&(0===indexBeat&&(sound=lodash.shuffle(sounds.bellsA)[0],null!=sound&&sound.rate(1-distance+.4),null!=sound&&sound.play()),indexBeat>=1&&(sound=lodash.shuffle(sounds.bellsA)[0],null!=sound&&sound.rate(.8*distance+.4),null!=sound&&sound.play(),indexBeat=-1)),fingers>=3&&(0===indexBeat&&(sound=lodash.shuffle(sounds.bellsA)[0],null!=sound&&sound.rate(utils.random(.2,.4)),null!=sound&&sound.play()),1===indexBeat&&(sound=lodash.shuffle(sounds.bellsA)[0],null!=sound&&sound.rate(utils.random(.2,.4)),null!=sound&&sound.play(),indexBeat=-1)),indexBeat++),indexTempo++},intervalTempo=setInterval(updateTempo,25),raycaster=new THREE.Raycaster,mouse=new THREE.Vector3(0,0,.5),animatePointersIn=function(uniformStartIndex,uniformEndIndex,pointers){var k,len,len1,m,ref1,results,tween,tweenId,uniformIndex;if(tweenId=uniformStartIndex+":"+uniformEndIndex,null!=pointersEnabledTweens[tweenId])for(ref1=pointersEnabledTweens[tweenId],k=0,len=ref1.length;k<len;k++)tween=ref1[k],tween.kill();for(pointersEnabledTweens[tweenId]=[],results=[],i=m=0,len1=pointers.length;m<len1;i=++m)pointers[i],uniformIndex=uniformStartIndex+i,results.push(pointersEnabledTweens[tweenId].push(new DigitalSkinPointerTween(uniformIndex,uniforms,0,1)));return results},animatePointersOut=function(uniformStartIndex,uniformEndIndex){var k,len,m,ref1,ref2,ref3,results,tween,tweenId,uniformIndex;if(tweenId=uniformStartIndex+":"+uniformEndIndex,null!=pointersEnabledTweens[tweenId])for(ref1=pointersEnabledTweens[tweenId],k=0,len=ref1.length;k<len;k++)tween=ref1[k],tween.kill();for(results=[],uniformIndex=m=ref2=uniformStartIndex,ref3=uniformEndIndex;ref2<=ref3?m<ref3:m>ref3;uniformIndex=ref2<=ref3?++m:--m)uniforms.pointersEnabled.value[uniformIndex]>0?results.push(pointersEnabledTweens[tweenId].push(new DigitalSkinPointerTween(uniformIndex,uniforms,1,0))):results.push(void 0);return results},updateMeshFromPosition=function(pointers,connectionIndex,connectionColor){var _uniformIndex,intersects,k,len,pointer,pointerVectors,uniformIndex;for(null==connectionIndex&&(connectionIndex=0),pointerVectors=[],uniformIndex=connectionIndex*VOID_SETTINGS.MAX_POINTERS,i=k=0,len=pointers.length;k<len;i=++k)pointer=pointers[i],mouse.x=2*pointer.x-1,mouse.y=2*-pointer.y+1,raycaster.setFromCamera(mouse,cameras.user),intersects=raycaster.intersectObject(mesh),_uniformIndex=uniformIndex+i,intersects.length>0&&(pointerVectors.push(intersects[0].point),animateFace(intersects[0].face,connectionIndex,connectionColor),uniforms.pointers.value[_uniformIndex].copy(intersects[0].point));return pointerVectors},onTouchStart=function(pointers){var pointerVectors;return userPointers=pointers,pointerVectors=updateMeshFromPosition(pointers,0,utils.formatColorForWebgl(socketService.clientColor.user)),clientPointers.onTouchStart(pointerVectors),animatePointersIn(0,VOID_SETTINGS.MAX_POINTERS,pointers),socketService.pushUserInteractionStartEvent(pointers),fingers=pointers.length},onTouchMove=function(pointers){var pointerVectors;if(userPointers=pointers,pointerVectors=updateMeshFromPosition(pointers,0,utils.formatColorForWebgl(socketService.clientColor.user)),clientPointers.onTouchMove(pointerVectors),socketService.pushUserInteractionEvent(pointers),VOID_SETTINGS.SOUND_ENABLED&&Browser.device&&(2===fingers&&sounds.base.rate(globaldistance+.6),3===fingers&&sounds.base.rate(2*(globaldistance+.6)),fingers>=4))return sounds.base.rate(4*(globaldistance+.6))},onTouchEnd=function(pointers){return Browser.desktop&&(pointers=[]),socketService.pushUserInteractionEndEvent(),0===pointers.length&&clientPointers.onTouchEnd(pointers),animatePointersOut(0,VOID_SETTINGS.MAX_POINTERS),fingers=pointers.length},touch=new Touch($element),touch.bind(),touch.on("touchstart",onTouchStart),touch.on("touchmove",onTouchMove),touch.on("touchend",onTouchEnd),onUserActionStart=function(event,data){var pointerVectors,ref1,uniformEndIndex,uniformStartIndex;if(null==connectionData[data.clientId]&&(connectionData[data.clientId]=[]),connectionData[data.clientId][data.uuid]={index:connectionIndex,pointers:data.pointers,color:data.clientColor},uniformStartIndex=connectionIndex*VOID_SETTINGS.MAX_POINTERS,uniformEndIndex=uniformStartIndex+VOID_SETTINGS.MAX_POINTERS,animatePointersIn(uniformStartIndex,uniformEndIndex,data.pointers),pointerVectors=updateMeshFromPosition(data.pointers,connectionIndex,data.clientColor),null!=(ref1=connectionPointers[connectionIndex])&&ref1.onTouch(pointerVectors,data.clientColor),++connectionIndex>=VOID_SETTINGS.MAX_CONNECTIONS_PER_ROOM)return connectionIndex=1},onUserAction=function(event,data){var _connectionIndex,pointerVectors;return connectionData[data.clientId][data.uuid].pointers=data.pointers,connectionData[data.clientId][data.uuid].color=data.clientColor,_connectionIndex=connectionData[data.clientId][data.uuid].index,pointerVectors=updateMeshFromPosition(data.pointers,_connectionIndex,data.clientColor),connectionPointers[_connectionIndex].onTouch(pointerVectors,data.clientColor)},onUserActionEnd=function(event,data){var _connectionIndex,action,ref1,uniformEndIndex,uniformStartIndex,uuid;ref1=connectionData[data.clientId];for(uuid in ref1)action=ref1[uuid],_connectionIndex=action.index,connectionPointers[_connectionIndex].onTouchEnd(),uniformStartIndex=_connectionIndex*VOID_SETTINGS.MAX_POINTERS,uniformEndIndex=uniformStartIndex+VOID_SETTINGS.MAX_POINTERS,animatePointersOut(uniformStartIndex,uniformEndIndex,data.pointers);return delete connectionData[data.clientId]},onClientColorChange=function(event,data){var H,face,h,k,l,len,ref1,results,s;for(H=(new THREE.Color).setHex(utils.formatColorForWebgl(data.userColor)).getHSL().h,ref1=mesh.geometry.faces,results=[],i=k=0,len=ref1.length;k<len;i=++k)face=ref1[i],new THREE.Color,h=H+utils.random(-.01,.01),s=utils.random(.5,.6),l=.05,utils.random(1,5)>2&&(l=utils.random(.05,.1)),face.vertexColors[0].setHSL(h,s,l),face.vertexColors[1].setHSL(h,s,l),results.push(face.vertexColors[2].setHSL(h,s,l));return results},unbindUserInteractionStartHandler=$rootScope.$on("user.interaction.start",onUserActionStart),unbindUserInteractionHandler=$rootScope.$on("user.interaction",onUserAction),unbindUserInteractionEndHandler=$rootScope.$on("user.interaction.end",onUserActionEnd),unbindClientColorChange=$rootScope.$on("socket.clientcolor.change",onClientColorChange),unbindAnimateOut=$rootScope.$on("room.animate.out.start",function(){if(VOID_SETTINGS.SOUND_ENABLED)return sounds.base.fade(SOUND_BASE_VOLUME,0,2e3),$timeout(function(){return sounds.base.unload(),sounds.line1.unload(),sounds.line2.unload(),sounds.line3.unload()},2e3)}),$scope.$on("$destroy",function(){var k,len,len1,m,object,ref1,ref2,sound;if(DESTROY=!0,c.log("[Digital Skin] destroy"),gui.destroy(),clearInterval(intervalTempo),unbindAnimateOut(),unbindAnimateOut=null,unbindUserInteractionStartHandler(),unbindUserInteractionStartHandler=null,unbindUserInteractionHandler(),unbindUserInteractionHandler=null,unbindUserInteractionEndHandler(),unbindUserInteractionEndHandler=null,unbindClientColorChange(),unbindClientColorChange=null,touch.off("touchstart",onTouchStart),touch.off("touchmove",onTouchMove),touch.off("touchend",onTouchEnd),touch.unbind(),Window.off("resize",onResize),Window.off("focus",onWindowFocused),Window.off("idle",onWindowIdle),VOID_SETTINGS.SOUND_ENABLED)for(ref1=sounds.bellsA,k=0,len=ref1.length;k<len;k++)sound=ref1[k],sound.unload();for(ref2=scene.children,m=0,len1=ref2.length;m<len1;m++)object=ref2[m],scene.remove(object);return renderer.domElement.addEventListener("dblclick",null,!1),renderer.domElement=null,renderer=null,scene=null})}}}return RoomVisualDigitalSkin}(),angular.module("app").directive("roomVisualDigitalSkin",["$rootScope","GUI","Window","AssetLoader","Browser","lodash","$timeout","socketService","sessionService","Geometry","DigitalSkinShaders",RoomVisualDigitalSkin]);var LamentationsShaders;LamentationsShaders=function(){function LamentationsShaders(Shaders){return{vertexShaderForRoom:function(MAX_POINTERS){return null==MAX_POINTERS&&(MAX_POINTERS=0),["#define LAMBERT","varying vec3 vLightFront;","varying vec3 vPosition;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",Shaders.snoise2(),THREE.ShaderChunk.common,THREE.ShaderChunk.uv_pars_vertex,THREE.ShaderChunk.uv2_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,THREE.ShaderChunk.logdepthbuf_pars_vertex,"float mapFloat(float num, float in_min, float in_max, float out_min, float out_max) {","return (num - in_min) * (out_max - out_min) / (in_max - in_min) + out_min;","}","uniform float time;","void main() {",THREE.ShaderChunk.uv_vertex,THREE.ShaderChunk.uv2_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.beginnormal_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.begin_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.project_vertex,THREE.ShaderChunk.logdepthbuf_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"vPosition = position;","vec3 newPosition = vec3(0.0);","float maxDistance = 20.0;","newPosition.z += sin(time * 0.1 + (position.x * 0.04)) * snoise(vec2((position.y + time) * 0.01, position.y * 0.02)) * 90.0;","mvPosition = modelViewMatrix * vec4( position + newPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n")},fragmentShaderForRoom:function(MAX_POINTERS){return null==MAX_POINTERS&&(MAX_POINTERS=0),["uniform vec3 diffuse;","uniform vec3 emissive;","uniform float opacity;","uniform vec3 ambientLightColor;","varying vec3 vLightFront;","varying vec3 vPosition;","uniform float time;","#ifdef DOUBLE_SIDED","\tvarying vec3 vLightBack;","#endif",THREE.ShaderChunk.common,THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.uv_pars_fragment,THREE.ShaderChunk.uv2_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.alphamap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,THREE.ShaderChunk.logdepthbuf_pars_fragment,Shaders.classicnoise(),"void main() {","\tvec3 outgoingLight = vec3( 0.01 );","\tvec4 diffuseColor = vec4( diffuse, opacity );","\tvec3 totalAmbientLight = ambientLightColor;","\tvec3 shadowMask = vec3( 0.1 );",THREE.ShaderChunk.logdepthbuf_fragment,THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.alphamap_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.shadowmap_fragment,"\t#ifdef DOUBLE_SIDED","\t\tif ( gl_FrontFacing )","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t\telse","\t\t\toutgoingLight += diffuseColor.rgb * ( vLightBack * shadowMask + totalAmbientLight ) + emissive;","\t#else","\t\toutgoingLight += diffuseColor.rgb * ( vLightFront * shadowMask + totalAmbientLight ) + emissive;","\t#endif",THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"float nx = vPosition.x * 0.011;","float ny = vPosition.y * 0.011 + time * -0.03;","outgoingLight *= 0.95 + cnoise(vec2(nx, ny));","\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );","}"].join("\n")}}}return LamentationsShaders}(),angular.module("app").factory("LamentationsShaders",["Shaders",LamentationsShaders]);var RoomVisualLamentations;RoomVisualLamentations=function(){function RoomVisualLamentations($rootScope,GUI,Window,AssetLoader,Browser,lodash,$timeout,socketService,sessionService,Geometry,LamentationsShaders){return{restrict:"A",link:function($scope,$element){
var $$element,DESTROY,IS_IDLE,addKonamiPasses,ambLight,assets,cameraFolder,cameras,clientPointers,composer,connectionData,connectionIds,connectionIndex,connectionPointers,connectionSounds,controls,createObjects,dirLight,distance,flashMesh,getPointerVectors,glitchCounts,glitchMeshes,gui,helperAxis,helperCamera,helperGrid,hittestMesh,i,konamiPath,l,lightFolder,lights,m,material,mouse,noisePass,onClientColorChange,onResize,onTouchEnd,onTouchMove,onTouchStart,onUserAction,onUserActionEnd,onUserActionStart,onWindowFocused,onWindowIdle,passes,platform,range,raycaster,ref,ref1,render,renderer,scene,settings,soundGuestIds,soundGuestIndex,soundTweens,sounds,sy,tmpColor1,tmpColor2,totalGlitches,touch,unbindAnimateOut,unbindClientColorChange,unbindUserInteractionEndHandler,unbindUserInteractionHandler,unbindUserInteractionStartHandler,uniforms,update,updateGuestSound,updateTick,userClickStart,userPointers,zoom;for(DESTROY=!1,IS_IDLE=!1,$$element=$($element),gui=new GUI.create(!1),gui.addFolder("lamentations"),gui.open(),VOID_SETTINGS.SOUND_ENABLED?(konamiPath=sessionService.get("konamiPath"),sounds={glitches:[]},assets=[{id:"base",url:"/sounds/lamentations/"+konamiPath+"01.loop",type:"sound"},{id:"glitch1",url:"/sounds/lamentations/"+konamiPath+"02.glitch1",type:"sound"},{id:"glitch2",url:"/sounds/lamentations/"+konamiPath+"03.glitch2",type:"sound"},{id:"glitch3",url:"/sounds/lamentations/"+konamiPath+"04.glitch3",type:"sound"},{id:"screams",url:"/sounds/lamentations/"+konamiPath+"05.Screams",type:"sound"},{id:"guest1",url:"/sounds/lamentations/"+konamiPath+"guest1",type:"sound"},{id:"guest2",url:"/sounds/lamentations/"+konamiPath+"guest2",type:"sound"},{id:"guest3",url:"/sounds/lamentations/"+konamiPath+"guest3",type:"sound"}],AssetLoader.load(assets).then(function(_assets){var i,l,ref,sound;for(i=l=0,ref=_assets.length;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l)sound=_assets[i],sounds[sound.id]=sound.data,sounds[sound.id].loop(!0);return sounds.base.play(),sounds.glitch1.play(),sounds.glitch2.play(),sounds.glitch3.play(),sounds.screams.play(),sounds.guest1.play(),sounds.guest2.play(),sounds.guest3.play(),sounds.glitch1.volume(0),sounds.glitch2.volume(0),sounds.glitch3.volume(0),sounds.screams.volume(0),sounds.guest1.volume(0),sounds.guest2.volume(0),sounds.guest3.volume(0),sounds.glitches[0]=sounds.glitch1,sounds.glitches[1]=sounds.glitch2,sounds.glitches[2]=sounds.glitch3,sounds.glitches[3]=sounds.screams,sounds.glitches[4]=sounds.guest1,sounds.glitches[5]=sounds.guest2,sounds.glitches[6]=sounds.guest3,$scope.$emit("room.assets.loaded")})):$scope.$emit("room.assets.loaded"),settings={debug:!1,showHelpers:!1,camera:{z:{desktop:250,device:150}}},platform=Browser.device?"device":"desktop",cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.PerspectiveCamera(20,Window.width/Window.height,.1,1e5)},cameras.user.position.set(0,0,settings.camera.z[platform]),range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0,canvas:$element[0]}),composer=new WAGNER.Composer(renderer),renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),noisePass=new WAGNER.NoisePass,passes=[noisePass],addKonamiPasses=function(){var l,len,len1,m,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],l=0,len=ref.length;l<len;l++){for(passConfig=ref[l],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,m=0,len1=ref1.length;m<len1;m++)param=ref1[m],pass.params[param.id]=param.valueLamentations;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),noisePass.params.amount=.02,noisePass.params.speed=0,gui.add(noisePass.params,"amount").min(0).max(10),gui.add(noisePass.params,"speed").min(0).max(10),renderer.autoClearColor=!0,scene=new THREE.Scene,helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),settings.showHelpers&&(scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera)),lights={ambient:{color:socketService.clientColor.ambient},directional:{color:socketService.clientColor.directional}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(1,1,1).normalize(),scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),clientPointers=new ClientPointers(scene),connectionPointers=[],i=l=0,ref=VOID_SETTINGS.LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM;0<=ref?l<ref:l>ref;i=0<=ref?++l:--l)connectionPointers.push(new ConnectionPointers(scene));for(userClickStart=null,distance=0,userPointers=[],hittestMesh=null,uniforms=null,material=null,glitchMeshes=[],totalGlitches=8,flashMesh=null,createObjects=function(){var color1,color2,face,geometry,height,j,lambert,len,m,material2,mesh,n,o,ref1,ref2,ref3,width;for(lambert=THREE.ShaderLib.lambert,uniforms=THREE.UniformsUtils.merge([lambert.uniforms,{time:{type:"f",value:0}}]),material=new THREE.ShaderMaterial({uniforms:uniforms,vertexShader:LamentationsShaders.vertexShaderForRoom(),fragmentShader:LamentationsShaders.fragmentShaderForRoom(),lights:!0}),geometry=new THREE.PlaneGeometry(600,600,50,50),mesh=new THREE.Mesh(geometry,material),scene.add(mesh),mesh.position.z=-80,glitchMeshes=[],i=m=0,ref1=VOID_SETTINGS.LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM;0<=ref1?m<ref1:m>ref1;i=0<=ref1?++m:--m)for(glitchMeshes[i]=[],j=n=0,ref2=totalGlitches;0<=ref2?n<ref2:n>ref2;j=0<=ref2?++n:--n){for(width=300,height=2,geometry=new THREE.PlaneGeometry(width,height,1,1),ref3=geometry.faces,j=o=0,len=ref3.length;o<len;j=++o)face=ref3[j],color1=new THREE.Color(0),color2=new THREE.Color(16777215),0===j?(face.vertexColors[0]=color2,face.vertexColors[1]=color2,face.vertexColors[2]=color1):(face.vertexColors[0]=color2,face.vertexColors[1]=color1,face.vertexColors[2]=color1);material2=new THREE.MeshBasicMaterial({color:16777215,opacity:0,transparent:!0,depthWrite:!1,vertexColors:THREE.VertexColors}),mesh=new THREE.Mesh(geometry,material2),mesh.position.x=utils.random(-20,20),mesh.position.y=utils.random(-50,50),mesh.position.z=0,scene.add(mesh),glitchMeshes[i].push(mesh)}return geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),material=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0}),flashMesh=new THREE.Mesh(geometry,material),scene.add(flashMesh),width=600,height=600,geometry=new THREE.PlaneBufferGeometry(width,height),material=new THREE.MeshBasicMaterial({color:65280,side:THREE.DoubleSide,wireframe:!0,transparent:!0,opacity:0}),hittestMesh=new THREE.Mesh(geometry,material),scene.add(hittestMesh)},createObjects(),zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},update=function(){if(uniforms.time.value+=.1,ambLight.color.setHex(socketService.clientColor.ambient),dirLight.color.setHex(socketService.clientColor.directional),settings.debug)return null!=controls?controls.update():void 0},onResize=function(){var height,ratio,width;return width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.aspect=ratio,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(width,height),composer.setSize(width,height),$$element.attr({width:Window.width,height:Window.height})},onResize(),onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),render=function(){var len,m,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE){if(update(),settings.debug)return renderer.render(scene,cameras.dev);for(composer.reset(),composer.render(scene,cameras.user),m=0,len=passes.length;m<len;m++)pass=passes[m],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,300),render(),0,glitchCounts=[],i=m=0,ref1=VOID_SETTINGS.LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM;0<=ref1?m<ref1:m>ref1;i=0<=ref1?++m:--m)glitchCounts[i]=[];return connectionData={},tmpColor1=new THREE.Color,tmpColor2=new THREE.Color,sy=null,updateTick=function(){var color,glitch,k,keys,len,n,o,pointer,pointerVectors,pointers,ref2,ref3,ref4,results,updateConnectedDesktop,updateConnectedMobile,updateSoundDesktop;if(updateConnectedMobile=function(connected){if(connected<=1&&(sy=1+2*Math.round(utils.random(0,.6)),noisePass.params.amount=.02,noisePass.params.speed=0,flashMesh.material.opacity=0),2===connected&&(sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.06,noisePass.params.speed=1,flashMesh.material.opacity=0),3===connected&&(sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.3,noisePass.params.speed=2,flashMesh.material.opacity=utils.random(0,.12)),4===connected)return sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.5,noisePass.params.speed=2,flashMesh.material.opacity=utils.random(.4,.85)},updateConnectedDesktop=function(){if(distance>=0&&(sy=1+2*Math.round(utils.random(0,.6)),noisePass.params.amount=.02,noisePass.params.speed=0,flashMesh.material.opacity=0),distance>.25&&(sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.06,noisePass.params.speed=1,flashMesh.material.opacity=0),distance>.55&&(sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.3,noisePass.params.speed=2,flashMesh.material.opacity=utils.random(0,.12)),distance>.85)return sy=5+15*Math.round(utils.random(0,.52)),noisePass.params.amount=.5,noisePass.params.speed=2,flashMesh.material.opacity=utils.random(.4,.85)},updateSoundDesktop=function(pointerVectors){var volume2,volume3,volumeScreams;if(volume2=THREE.Math.clamp(3*(distance-.2),0,1),volume3=THREE.Math.clamp(3*(distance-.5),0,1),volumeScreams=THREE.Math.clamp(3*(distance-.8),0,1),VOID_SETTINGS.SOUND_ENABLED)return sounds.glitch2.volume(volume2),sounds.glitch3.volume(volume3),sounds.screams.volume(volumeScreams)},glitch=function(_connectionIndex,pointerVectors,connectionColor){var currentGlitchCount,face,hsl1,hsl2,k,len,len1,mesh,n,o,p,position,ref2,ref3,results,results1,sx,x,y,z;if(pointerVectors.length>0){for(results=[],i=n=0,len=userPointers.length;n<len;i=++n){for(userPointers[i],currentGlitchCount=glitchCounts[_connectionIndex],currentGlitchCount/totalGlitches,position=pointerVectors[i],x=position.x+utils.random(-200,200),y=10*Math.round(position.y/10)+2*Math.round(utils.random(-2,2)),z=0,sx=utils.random(.1,.9),glitchMeshes[_connectionIndex][currentGlitchCount].position.set(x,y,z),glitchMeshes[_connectionIndex][currentGlitchCount].scale.set(sx,sy,1),mesh=glitchMeshes[_connectionIndex][currentGlitchCount],hsl1=tmpColor1.setHex(connectionColor).getHSL(),hsl2=tmpColor2.setHex(connectionColor).getHSL(),hsl1.h+=utils.random(-.01,.01),hsl1.s+=utils.random(0,.1),hsl1.l=utils.random(.3,.95),hsl2.h+=utils.random(-.01,.01),hsl2.s+=utils.random(0,.1),hsl2.l=utils.random(.3,.95),ref2=mesh.geometry.faces,k=o=0,len1=ref2.length;o<len1;k=++o)face=ref2[k],0===k?(face.vertexColors[0].setHSL(hsl2.h,hsl2.s,hsl2.l),face.vertexColors[1].setHSL(hsl2.h,hsl2.s,hsl2.l),face.vertexColors[2].setHSL(hsl1.h,hsl1.s,hsl1.l)):(face.vertexColors[0].setHSL(hsl2.h,hsl2.s,hsl2.l),face.vertexColors[1].setHSL(hsl1.h,hsl1.s,hsl1.l),face.vertexColors[2].setHSL(hsl1.h,hsl1.s,hsl1.l));mesh.geometry.colorsNeedUpdate=!0,TweenMax.to(glitchMeshes[_connectionIndex][currentGlitchCount].material,.02,{opacity:1}),TweenMax.to(glitchMeshes[_connectionIndex][currentGlitchCount].position,.2,{x:utils.random(-100,100)}),glitchMeshes[_connectionIndex][currentGlitchCount].geometry.colorsNeedUpdate=!0,glitchCounts[_connectionIndex]++,glitchCounts[_connectionIndex]=THREE.Math.clamp(glitchCounts[_connectionIndex],0,totalGlitches-1),currentGlitchCount>=totalGlitches-1?results.push(glitchCounts[_connectionIndex]=0):results.push(void 0)}return results}for(glitchCounts[_connectionIndex]=0,results1=[],i=p=0,ref3=totalGlitches;0<=ref3?p<ref3:p>ref3;i=0<=ref3?++p:--p)TweenMax.to(glitchMeshes[_connectionIndex][i].material,.2,{opacity:0}),results1.push(TweenMax.to(glitchMeshes[_connectionIndex][i].position,.2,{x:utils.random(-50,50)}));return results1},pointerVectors=getPointerVectors(touch.pointers),Browser.device?updateConnectedMobile(pointerVectors.length):updateConnectedDesktop(),pointerVectors.length>=1)for(n=0,len=userPointers.length;n<len;n++)pointer=userPointers[n],distance=utils.distance(pointer.x,userClickStart.x,pointer.y,userClickStart.y);for(glitch(0,pointerVectors,utils.formatColorForWebgl(socketService.clientColor.user)),pointerVectors.length>=1&&!Browser.device&&updateSoundDesktop(pointerVectors),results=[],k=o=1,ref2=VOID_SETTINGS.LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM;1<=ref2?o<ref2:o>ref2;k=1<=ref2?++o:--o)keys=Object.keys(connectionData),pointers=(null!=(ref3=connectionData[keys[k-1]])?ref3.pointers:void 0)||[],color=(null!=(ref4=connectionData[keys[k-1]])?ref4.color:void 0)||16777215,pointerVectors=getPointerVectors(pointers),results.push(glitch(k,pointerVectors,color));return results},setInterval(updateTick,50),soundGuestIds=["guest2","guest3"],soundTweens={guest2:null,guest3:null},updateGuestSound=function(soundId,isDown){var obj,volume;if(TweenMax.killTweensOf(soundTweens[soundId]),null!=soundTweens[soundId])return obj={volume:sounds[soundId].volume()},volume=isDown?1:0,soundTweens[soundId]=TweenMax.to(obj,.5,{volume:volume,onUpdate:function(){return sounds[soundId].volume(obj.volume)}})},raycaster=new THREE.Raycaster,mouse=new THREE.Vector3(0,0,.5),getPointerVectors=function(pointers){var intersects,len,n,pointer,pointerVectors;for(pointerVectors=[],i=n=0,len=pointers.length;n<len;i=++n)pointer=pointers[i],mouse.x=2*pointer.x-1,mouse.y=2*-pointer.y+1,raycaster.setFromCamera(mouse,cameras.user),intersects=raycaster.intersectObject(hittestMesh),intersects.length>0&&pointerVectors.push(intersects[0].point);return pointerVectors},onTouchStart=function(pointers){var pointerVectors;return userClickStart=pointers[0],userPointers=pointers,pointerVectors=getPointerVectors(pointers),clientPointers.onTouchStart(pointerVectors),pointerVectors=getPointerVectors(touch.pointers),VOID_SETTINGS.SOUND_ENABLED&&(1===pointerVectors.length&&sounds.glitch1.fade(sounds.glitch1.volume(),1,250),2===pointerVectors.length&&sounds.glitch2.fade(0,1,250),3===pointerVectors.length&&sounds.glitch3.fade(0,1,250),4===pointerVectors.length&&sounds.screams.fade(0,1,500)),socketService.pushUserInteractionStartEvent(pointers)},onTouchMove=function(pointers){var pointerVectors;return userPointers=pointers,pointerVectors=getPointerVectors(pointers),clientPointers.onTouchMove(pointerVectors),socketService.pushUserInteractionEvent(pointers)},onTouchEnd=function(pointers){var pointerVectors;if(pointerVectors=getPointerVectors(touch.pointers),distance=0,VOID_SETTINGS.SOUND_ENABLED&&(0===pointerVectors.length&&(sounds.glitch1.fade(sounds.glitch1.volume(),0,500),sounds.glitch2.fade(sounds.glitch2.volume(),0,500),sounds.glitch3.fade(sounds.glitch3.volume(),0,500),sounds.screams.fade(sounds.screams.volume(),0,500)),1===pointerVectors.length&&(sounds.glitch2.fade(sounds.glitch2.volume(),0,500),sounds.glitch3.fade(sounds.glitch3.volume(),0,500),sounds.screams.fade(sounds.screams.volume(),0,500)),2===pointerVectors.length&&(sounds.glitch3.fade(sounds.glitch3.volume(),0,500),sounds.screams.fade(sounds.screams.volume(),0,500)),3===pointerVectors.length&&sounds.screams.fade(sounds.screams.volume(),0,500)),socketService.pushUserInteractionEndEvent(),0===pointers.length)return clientPointers.onTouchEnd(pointers)},touch=new Touch($element),touch.bind(),touch.on("touchstart",onTouchStart),touch.on("touchmove",onTouchMove),touch.on("touchend",onTouchEnd),connectionIndex=1,connectionIds={},connectionSounds={},soundGuestIndex=0,onUserActionStart=function(event,data){var pointerVectors,ref2;if(connectionIds[data.clientId]=connectionIndex,connectionSounds[data.clientId]=soundGuestIds[soundGuestIndex],connectionData[data.clientId]={pointers:data.pointers,color:data.clientColor},pointerVectors=getPointerVectors(data.pointers),null!=(ref2=connectionPointers[connectionIndex])&&ref2.onTouch(pointerVectors,data.clientColor),updateGuestSound(connectionSounds[data.clientId],!0),Object.keys(connectionIds).length,connectionIndex++,connectionIndex>=VOID_SETTINGS.LAMENTATIONS_MAX_CONNECTIONS_PER_ROOM&&(connectionIndex=1),++soundGuestIndex>=soundGuestIds.length)return soundGuestIndex=0},onUserAction=function(event,data){var _connectionIndex,pointerVectors;return _connectionIndex=connectionIds[data.clientId],pointerVectors=getPointerVectors(data.pointers),connectionData[data.clientId]={pointers:data.pointers,color:data.clientColor},connectionPointers[_connectionIndex].onTouch(pointerVectors,data.clientColor)},onUserActionEnd=function(event,data){var _connectionIndex,ref2;return _connectionIndex=connectionIds[data.clientId],null!=(ref2=connectionPointers[_connectionIndex])&&ref2.onTouchEnd(),updateGuestSound(connectionSounds[data.clientId],!1),Object.keys(connectionIds).length,delete connectionIds[data.clientId],delete connectionData[data.clientId],delete connectionSounds[data.clientId]},onClientColorChange=function(event,data){return ambLight.color.setHex(utils.formatColorForWebgl(data.ambientColor)),dirLight.color.setHex(utils.formatColorForWebgl(data.directionalColor))},unbindUserInteractionStartHandler=$rootScope.$on("user.interaction.start",onUserActionStart),unbindUserInteractionHandler=$rootScope.$on("user.interaction",onUserAction),unbindUserInteractionEndHandler=$rootScope.$on("user.interaction.end",onUserActionEnd),unbindClientColorChange=$rootScope.$on("socket.clientcolor.change",onClientColorChange),unbindAnimateOut=$rootScope.$on("room.animate.out.start",function(){if(VOID_SETTINGS.SOUND_ENABLED)return sounds.base.fade(1,0,2e3),$timeout(function(){var id,sound;for(id in sounds)sound=sounds[id],"function"==typeof sound.unload&&sound.unload();return sounds=null},2e3)}),$scope.$on("$destroy",function(){var len,n,object,ref2;for(DESTROY=!0,c.log("[LAMENTATIONS] destroy"),gui.destroy(),unbindAnimateOut(),unbindAnimateOut=null,unbindUserInteractionStartHandler(),unbindUserInteractionStartHandler=null,unbindUserInteractionHandler(),unbindUserInteractionHandler=null,unbindUserInteractionEndHandler(),unbindUserInteractionEndHandler=null,unbindClientColorChange(),unbindClientColorChange=null,touch.off("touchstart",onTouchStart),touch.off("touchmove",onTouchMove),touch.off("touchend",onTouchEnd),touch.unbind(),Window.off("resize",onResize),Window.off("focus",onWindowFocused),Window.off("idle",onWindowIdle),ref2=scene.children,n=0,len=ref2.length;n<len;n++)object=ref2[n],scene.remove(object);return renderer.domElement.addEventListener("dblclick",null,!1),renderer.domElement=null,renderer=null,scene=null})}}}return RoomVisualLamentations}(),angular.module("app").directive("roomVisualLamentations",["$rootScope","GUI","Window","AssetLoader","Browser","lodash","$timeout","socketService","sessionService","Geometry","LamentationsShaders",RoomVisualLamentations]);var RoomAudioUrbanJungle;RoomAudioUrbanJungle=function(){function RoomAudioUrbanJungle($window,GUI){return{restrict:"A",link:function($scope,$element){var microSynthLow,microSynthLowInstance,sinusoid,time,update;return sinusoid=1,time=0,{id:"high1",ugen:"flock.ugen.granulator",delayDur:.3,source:{ugen:"flock.ugen.sinOsc",freq:{ugen:"flock.ugen.mouse.cursor",rate:"control",mul:5e3,add:-4900,options:{axis:"y"}},mul:{id:"tremolo",ugen:"flock.ugen.sinOsc",freq:50,mul:{id:"envelopeA",ugen:"flock.ugen.envGen",gate:{ugen:"flock.ugen.mouse.click"},mul:{ugen:"flock.ugen.mouse.cursor",rate:"control",mul:-.6,add:-.3,options:{axis:"y"}}}}}},microSynthLow={ugen:"flock.ugen.sinOsc",freq:50,mul:{id:"tremolo",ugen:"flock.ugen.sinOsc",freq:1,mul:{id:"envelopeA",ugen:"flock.ugen.envGen",envelope:{type:"flock.envelope.adsr",attack:.3,release:.3,peak:1,sustain:.5},gate:{ugen:"flock.ugen.mouse.click"},mul:{ugen:"flock.ugen.mouse.cursor",rate:"control",mul:8.6,add:-8.6,options:{axis:"y"}}}}},microSynthLowInstance=flock.synth({synthDef:microSynthLow}),update=function(){return requestAnimationFrame(update),time+=.05,sinusoid=Math.sin(time).map(-1,1,0,1),microSynthHighInstance.set({})},$scope.$on("$destroy",function(){return microSynthLowInstance.destroy()})}}}return RoomAudioUrbanJungle}(),angular.module("app").directive("roomAudioUrbanJungle",["$window","GUI",RoomAudioUrbanJungle]);var RoomVisualUrbanJungle;RoomVisualUrbanJungle=function(){function RoomVisualUrbanJungle($rootScope,GUI,Window,AssetLoader,Browser,lodash,$timeout,sessionService,socketService){return{restrict:"A",link:function($scope,$element){var $$element,DESTROY,IS_IDLE,IS_RESIZING,addKonamiPasses,allMeshes,ambLight,assets,backgroundMesh,cameraFolder,cameras,changesound,clientPointers,composer,connectionData,connectionIndex,connectionPointers,controls,createObjects,cubeIndex,cubeSize,dirLight,flash,flashMesh,getPointerVectors,getTotalCubes,gradientMesh,gradientMeshBack,gradientScale,gradientScaletogo,gui,helperAxis,helperCamera,helperDirLight,helperGrid,hittestMesh,i,intervalTick,k,konamiPath,lightFolder,lights,mesh,meshes,mouse,move,onResize,onResizeComplete,onTouchEnd,onTouchMove,onTouchStart,onUserAction,onUserActionEnd,onUserActionStart,onWindowFocused,onWindowIdle,passes,pointersScale,range,raycaster,ref,render,renderer,resizeTimeout,scene,settings,soundLevel,soundTweens,sounds,tmpColor,totalMeshRows,touch,unbindAnimateOut,unbindUserInteractionEndHandler,unbindUserInteractionHandler,unbindUserInteractionStartHandler,update,updateGradient,updateSound,updateTick,zoom;for(DESTROY=!1,IS_RESIZING=!1,IS_IDLE=!1,intervalTick=null,["normal","beat","bass","melody"],$scope.showInstruments=!1,$scope.chooseInstrument=function(instrumentId){var obj;return $scope.instrument=instrumentId,$scope.instruments.forEach(function(item){return item.color="transparent",item.user=!1}),obj=lodash.find($scope.instruments,{id:instrumentId}),obj.color=utils.formatColorForCSS(socketService.clientColor.user),obj.user=!0,obj.connection=!1,obj.borderColor="#ffffff"},$scope.instruments=[{id:"normal",user:!1,connection:!1,color:"transparent",borderColor:"#ffffff"},{id:"beat",user:!1,connection:!1,color:"transparent",borderColor:"#ffffff"},{id:"bass",user:!1,connection:!1,color:"transparent",borderColor:"#ffffff"},{id:"melody",user:!1,connection:!1,color:"transparent",borderColor:"#ffffff"}],$scope.chooseInstrument($scope.instruments[0].id),soundLevel=1,$$element=$($element),gui=new GUI.create(!1),gui.addFolder("urban-jungle"),gui.open(),VOID_SETTINGS.SOUND_ENABLED?(konamiPath=sessionService.get("konamiPath"),sounds={towers:[]},assets=[{id:"base",url:"/sounds/urban-jungle/"+konamiPath+"base",type:"sound"},{id:"base2",url:"/sounds/urban-jungle/"+konamiPath+"base2",type:"sound"},{id:"layer1",url:"/sounds/urban-jungle/"+konamiPath+"layer1",type:"sound"},{id:"layer2",url:"/sounds/urban-jungle/"+konamiPath+"layer2",type:"sound"},{id:"layer3",url:"/sounds/urban-jungle/"+konamiPath+"layer3",type:"sound"},{id:"mimi1",url:"/sounds/urban-jungle/"+konamiPath+"voice",type:"sound"},{id:"mimi2",url:"/sounds/urban-jungle/"+konamiPath+"voice2",type:"sound"},{id:"mimi3",url:"/sounds/urban-jungle/"+konamiPath+"voice3",type:"sound"},{id:"beatsB1",url:"/sounds/urban-jungle/"+konamiPath+"beatsB1",type:"sound"},{id:"beatsB2",url:"/sounds/urban-jungle/"+konamiPath+"beatsB2",type:"sound"},{id:"beatsB3",url:"/sounds/urban-jungle/"+konamiPath+"beatsB3",type:"sound"},{id:"bass1",url:"/sounds/urban-jungle/"+konamiPath+"bass1",type:"sound"},{id:"bass2",url:"/sounds/urban-jungle/"+konamiPath+"bass2",type:"sound"},{id:"bass3",url:"/sounds/urban-jungle/"+konamiPath+"bass3",type:"sound"}],AssetLoader.load(assets).then(function(_assets){var i,k,ref,sound;for(i=k=0,ref=_assets.length;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k)sound=_assets[i],sounds[sound.id]=sound.data;return sounds.base.loop(!0),sounds.base2.loop(!0),sounds.layer1.loop(!0),sounds.layer2.loop(!0),sounds.layer3.loop(!0),sounds.mimi1.loop(!0),sounds.mimi2.loop(!0),sounds.mimi3.loop(!0),sounds.beatsB1.loop(!0),sounds.beatsB2.loop(!0),sounds.beatsB3.loop(!0),sounds.bass1.loop(!0),sounds.bass2.loop(!0),sounds.bass3.loop(!0),sounds.base.play(),sounds.base2.play(),sounds.layer1.play(),sounds.layer2.play(),sounds.layer3.play(),sounds.mimi1.play(),sounds.mimi2.play(),sounds.mimi3.play(),sounds.beatsB1.play(),sounds.beatsB2.play(),sounds.beatsB3.play(),sounds.bass1.play(),sounds.bass2.play(),sounds.bass3.play(),sounds.base.volume(.4),sounds.base2.volume(0),sounds.layer1.volume(0),sounds.layer2.volume(0),sounds.layer3.volume(0),sounds.mimi1.volume(0),sounds.mimi2.volume(0),sounds.mimi3.volume(0),sounds.beatsB1.volume(0),sounds.beatsB2.volume(0),sounds.beatsB3.volume(0),sounds.bass1.volume(0),sounds.bass2.volume(0),sounds.bass3.volume(0),intervalTick=setInterval(updateTick,50),$scope.showInstruments=!0,$scope.$emit("room.assets.loaded")})):(intervalTick=setInterval(updateTick,50),$scope.$emit("room.assets.loaded")),settings={debug:!1,showHelpers:!1},Browser.device?"device":"desktop",zoom=function(camera,zoom){return camera.position.set(1*zoom,.75*zoom,1*zoom),camera.lookAt(new THREE.Vector3)},cameras={dev:new THREE.PerspectiveCamera(65,Window.width/Window.height,.1,1e5),user:new THREE.OrthographicCamera(-Window.width/2,Window.width/2,Window.height/2,-Window.height/2,.1,2e3)},range=1e3,cameraFolder=gui.addFolder("camera"),cameraFolder.open(),cameraFolder.add(settings,"debug"),cameraFolder.add(cameras.user.position,"x",-range,range),cameraFolder.add(cameras.user.position,"y",-range,range),cameraFolder.add(cameras.user.position,"z",-range,range),renderer=new THREE.WebGLRenderer({antialias:!0}),composer=new WAGNER.Composer(renderer),renderer.shadowMap.enabled=!0,renderer.shadowMap.type=THREE.BasicShadowMap,renderer.setSize(Window.width,Window.height),composer.setSize(Window.width,Window.height),$element.append(renderer.domElement),passes=[],addKonamiPasses=function(){var k,len,len1,m,param,pass,passConfig,ref,ref1,results;for(ref=VOID_SETTINGS.KONAMI.PASSES,results=[],k=0,len=ref.length;k<len;k++){for(passConfig=ref[k],pass=new WAGNER[passConfig.cls],ref1=passConfig.params,m=0,len1=ref1.length;m<len1;m++)param=ref1[m],pass.params[param.id]=param.valueUrbanJungle;results.push(passes.push(pass))}return results},sessionService.get("konami")&&addKonamiPasses(),$element.append(renderer.domElement),scene=new THREE.Scene,settings.showHelpers&&(helperGrid=new THREE.GridHelper(50,10),helperAxis=new THREE.AxisHelper(10),helperCamera=new THREE.CameraHelper(cameras.user),helperDirLight=new THREE.DirectionalLightHelper(dirLight),scene.add(helperGrid),scene.add(helperAxis),scene.add(helperCamera),scene.add(helperDirLight)),lights={ambient:{color:4473924},directional:{color:16777215}},ambLight=new THREE.AmbientLight(lights.ambient.color),dirLight=new THREE.DirectionalLight(lights.directional.color,1),dirLight.position.set(0,1050,1350),dirLight.castShadow=!0,dirLight.shadowDarkness=1.05,scene.add(ambLight),scene.add(dirLight),lightFolder=gui.addFolder("lights"),lightFolder.open(),lightFolder.addColor(lights.ambient,"color").name("ambient"),lightFolder.addColor(lights.directional,"color").name("directional"),range=2e3,lightFolder.add(dirLight.rotation,"x",-PI,PI),lightFolder.add(dirLight.rotation,"y",-PI,PI),lightFolder.add(dirLight.rotation,"z",-PI,PI),lightFolder.add(dirLight.position,"x",-range,range),lightFolder.add(dirLight.position,"y",-range,range),lightFolder.add(dirLight.position,"z",-range,range),settings.debug&&(controls=new THREE.OrbitControls(cameras.dev,$element[0])),pointersScale=10,clientPointers=new ClientPointers(scene,{depth:50,lightDistance:200,intensity:2}),clientPointers.device=Browser.device,connectionPointers=[],i=k=0,ref=VOID_SETTINGS.URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM;0<=ref?k<ref:k>ref;i=0<=ref?++k:--k)connectionPointers.push(new ConnectionPointers(scene,pointersScale));return mesh=null,hittestMesh=null,backgroundMesh=null,flashMesh=null,cubeSize=18,totalMeshRows=VOID_SETTINGS.URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM,meshes=[],allMeshes=[],gradientMesh=null,gradientMeshBack=null,getTotalCubes=function(){return Math.floor(Window.width/cubeSize)+3},createObjects=function(){var color,d,generateTexture,geometry,h,j,l,len,m,material,n,o,object,offsetX,percent,ref1,ref2,s,texture,texture2,tmpColor,totalCubes;for(m=0,len=allMeshes.length;m<len;m++)object=allMeshes[m],scene.remove(object);for(scene.remove(hittestMesh),scene.remove(flashMesh),scene.remove(backgroundMesh),scene.remove(gradientMesh),scene.remove(gradientMeshBack),cameras.user.position.set(0,.5*Window.height,1500),totalCubes=getTotalCubes(),meshes=[],allMeshes=[],offsetX=-totalCubes*cubeSize*.5+.5*cubeSize,d=0,i=n=0,ref1=totalMeshRows;0<=ref1?n<ref1:n>ref1;i=0<=ref1?++n:--n)for(meshes[i]=[],j=o=0,ref2=totalCubes;0<=ref2?o<ref2:o>ref2;j=0<=ref2?++o:--o)d+=.1,percent=Math.sin(d)/2+.45,geometry=new THREE.PlaneBufferGeometry(cubeSize,Window.height),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,cubeSize)),color=new THREE.Color,tmpColor=new THREE.Color(socketService.clientColor.user),h=tmpColor.getHSL().h,s=tmpColor.getHSL().s+utils.random(-.05,.05),l=tmpColor.getHSL().l+utils.random(-.05,.05),color.setHSL(h+h*percent/10,s,percent*l),material=new THREE.MeshPhongMaterial({color:color}),mesh=new THREE.Mesh(geometry,material),mesh.position.x=offsetX+cubeSize*j,mesh.position.z=i*-cubeSize,mesh.scale.y=1,meshes[i].push(mesh),allMeshes.push(mesh),scene.add(mesh);return geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,0)),generateTexture=function(stop){var canvas,context,gradient,size;return size=512,canvas=document.createElement("canvas"),canvas.width=size,canvas.height=size,context=canvas.getContext("2d"),context.rect(0,0,size,size),gradient=context.createLinearGradient(size,0,size,size),gradient.addColorStop(1,"#ffffff"),gradient.addColorStop(stop,"transparent"),context.fillStyle=gradient,context.fill(),canvas},texture=new THREE.Texture(generateTexture(.05)),texture.needsUpdate=!0,material=new THREE.MeshBasicMaterial({color:16777215,side:THREE.DoubleSide,wireframe:!1,transparent:!0,map:texture,opacity:.5}),gradientMeshBack=new THREE.Mesh(geometry,material),gradientMeshBack.position.z=cubeSize,scene.add(gradientMeshBack),texture2=new THREE.Texture(generateTexture(.25)),texture2.needsUpdate=!0,material=new THREE.MeshBasicMaterial({color:socketService.clientColor.user,side:THREE.DoubleSide,wireframe:!1,transparent:!0,map:texture2,opacity:.9}),gradientMesh=new THREE.Mesh(geometry,material),gradientMesh.position.z=1200,scene.add(gradientMesh),geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,0)),material=new THREE.MeshBasicMaterial({color:1313306,side:THREE.DoubleSide,wireframe:!1,transparent:!0,opacity:1}),backgroundMesh=new THREE.Mesh(geometry,material),backgroundMesh.position.z=5*-cubeSize,scene.add(backgroundMesh),geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,0)),material=new THREE.MeshBasicMaterial({color:16777215,transparent:!0,opacity:0}),flashMesh=new THREE.Mesh(geometry,material),flashMesh.position.z=1400,scene.add(flashMesh),geometry=new THREE.PlaneBufferGeometry(Window.width,Window.height),
geometry.applyMatrix((new THREE.Matrix4).makeTranslation(0,.5*Window.height,0)),material=new THREE.MeshBasicMaterial({color:65280,side:THREE.DoubleSide,wireframe:!0,transparent:!0,opacity:0}),hittestMesh=new THREE.Mesh(geometry,material),hittestMesh.position.z=cubeSize,scene.add(hittestMesh)},createObjects(),update=function(){return settings.debug&&null!=controls&&controls.update(),gradientMesh.material.color.setHex(utils.formatColorForWebgl(socketService.clientColor.user))},resizeTimeout=null,onResizeComplete=function(){return createObjects(),IS_RESIZING=!1},onResize=function(){var height,ratio,width;return IS_RESIZING=!0,clearTimeout(resizeTimeout),resizeTimeout=setTimeout(onResizeComplete,500),width=Window.width,height=Window.height,ratio=width/height,cameras.dev.aspect=ratio,cameras.user.left=width/-2,cameras.user.right=width/2,cameras.user.top=height/2,cameras.user.bottom=height/-2,cameras.dev.updateProjectionMatrix(),cameras.user.updateProjectionMatrix(),renderer.setSize(width,height),composer.setSize(width,height),$$element.attr({width:Window.width,height:Window.height})},onWindowIdle=function(){return IS_IDLE=!0},onWindowFocused=function(){return IS_IDLE=!1},Window.on("resize",onResize),Window.on("focused",onWindowFocused),Window.on("idle",onWindowIdle),render=function(){var len,m,pass;if(DESTROY)return window.cancelAnimationFrame(render);if(requestAnimationFrame(render),!IS_IDLE){if(update(),settings.debug)return renderer.render(scene,cameras.dev);for(composer.reset(),composer.render(scene,cameras.user),m=0,len=passes.length;m<len;m++)pass=passes[m],composer.pass(pass);return composer.toScreen()}},zoom(cameras.dev,200),render(),raycaster=new THREE.Raycaster,mouse=new THREE.Vector3(0,0,.5),getPointerVectors=function(pointers){var intersects,len,m,pointer,pointerVectors;for(pointerVectors=[],i=m=0,len=pointers.length;m<len;i=++m)pointer=pointers[i],mouse.x=2*pointer.x-1,mouse.y=2*-pointer.y+1,raycaster.setFromCamera(mouse,cameras.user),intersects=raycaster.intersectObject(hittestMesh),intersects.length>0&&pointerVectors.push(intersects[0].point);return pointerVectors},1,flash=!0,move=!1,onTouchStart=function(pointers){var pointerVectors;return pointerVectors=getPointerVectors(pointers),clientPointers.onTouchStart(pointerVectors),move=!1,changesound(0,pointers,$scope.instrument,!0),socketService.pushUserInteractionStartEvent(pointers,{instrument:$scope.instrument})},onTouchMove=function(pointers){var pointerVectors;return move=!0,pointerVectors=getPointerVectors(pointers),clientPointers.onTouchMove(pointerVectors),changesound(0,pointers,$scope.instrument,!0),socketService.pushUserInteractionEvent(pointers,{instrument:$scope.instrument})},onTouchEnd=function(pointers){return changesound(0,pointers,$scope.instrument,!1),socketService.pushUserInteractionEndEvent(),clientPointers.onTouchEnd(pointers,{instrument:$scope.instrument})},function(){return flashMesh.material.opacity=0,flash=!1},0,soundTweens={layer1:null,layer2:null,layer3:null,beatsB1:null,beatsB2:null,beatsB3:null,bass1:null,bass2:null,bass3:null,mimi1:null,mimi2:null,mimi3:null},updateSound=function(soundId,y,soundLevel,isDown){var obj,volume;return TweenMax.killTweensOf(soundTweens[soundId]),obj={volume:sounds[soundId].volume()},volume=isDown?y*soundLevel:0,soundTweens[soundId]=TweenMax.to(obj,.5,{volume:volume,onUpdate:function(){return sounds[soundId].volume(obj.volume)}})},changesound=function(_connectionIndex,pointers,instrument,isDown){var distance,sound1,sound2,sound3,y,y1,y2,y3;if(null==isDown&&(isDown=!1),!1!==VOID_SETTINGS.SOUND_ENABLED)return y=0,y1=0,y2=0,y3=0,pointers.length>0&&(0===_connectionIndex?(y=Math.abs(1-pointers[0].y),distance=Math.abs(y-.33),distance=distance.map(0,.6,1,0),y1=distance/2,distance=Math.abs(y-.66),distance=distance.map(0,.5,1,0),y2=distance/2,distance=Math.abs(y-1),distance=distance.map(0,.4,1,0),y3=distance/4):(y=Math.abs(1-pointers[0].y),distance=Math.abs(y-.5),distance=distance.map(0,.5,1,0),y1=distance/2,distance=Math.abs(y-1),distance=distance.map(0,.5,1,0),y2=distance/2,y3=0)),"normal"===instrument?(sound1="layer1",sound2="layer2",sound3="layer3",soundLevel=1.7):"beat"===instrument?(sound1="beatsB1",sound2="beatsB2",sound3="beatsB3",soundLevel=.6):"bass"===instrument?(sound1="bass1",sound2="bass2",sound3="bass3",soundLevel=.7):"melody"===instrument&&(sound1="mimi1",sound2="mimi2",sound3="mimi3",soundLevel=.8),updateSound(sound1,y1,soundLevel,isDown),updateSound(sound2,y2,soundLevel,isDown),updateSound(sound3,y3,soundLevel,isDown)},gradientScale=0,gradientScaletogo=0,updateGradient=function(pointers){var gotomimi1,gotomimi2,keys,m,ref1,ref2,userPointers;if(!1!==VOID_SETTINGS.SOUND_ENABLED){if(Browser.desktop)for(pointers=[],i=m=1,ref1=VOID_SETTINGS.URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM;1<=ref1?m<ref1:m>ref1;i=1<=ref1?++m:--m)keys=Object.keys(connectionData),userPointers=(null!=(ref2=connectionData[keys[i-1]])?ref2.pointers:void 0)||[],null!=connectionData[keys[i-1]]&&(0===pointers.length&&(pointers[0]={x:0,y:0}),userPointers[0].y>pointers[0].y&&(pointers[0].y=userPointers[0].y));return pointers[0]?(gradientScaletogo=Math.abs(1-pointers[0].y),gradientScale<=gradientScaletogo?gradientScale+=.01:gradientScale-=.01):gradientScale-=.01,gradientScale=THREE.Math.clamp(gradientScale,0,1),gradientMesh.scale.y=2*(gradientScale+.2),gotomimi1=Math.abs(gradientScale),gotomimi1=gotomimi1.map(0,.66,0,1),gotomimi2=Math.abs(gradientScale),gotomimi2=gotomimi2.map(.5,1,0,1)}},touch=new Touch($element),touch.bind(),touch.on("touchstart",onTouchStart),touch.on("touchmove",onTouchMove),touch.on("touchend",onTouchEnd),cubeIndex=-1,{},tmpColor=new THREE.Color,updateTick=function(){var color,keys,m,pointers,ref1,ref2,results,updateRow;if(IS_RESIZING)return void(cubeIndex=-1);for(updateGradient(touch.pointers),gradientScaletogo>0&&(gradientScaletogo-=.02),updateRow=function(clientIndex,pointers,connectionColorHex){var h,l,percent,s,y;return TweenMax.killTweensOf(meshes[clientIndex][cubeIndex].scale),tmpColor.setHex(connectionColorHex),h=tmpColor.getHSL().h,s=utils.random(.5,.6),l=utils.random(.1,.2),meshes[0][cubeIndex+1].material.color.setHSL(h,s,1),pointers.length>0?(percent=1-pointers[0].y,y=1*percent+.1*utils.random(.1,1),35*percent+1*utils.random(.1,1),meshes[clientIndex][cubeIndex].material.color.setHSL(h+percent/6,utils.random(.5,.6)*percent/2+.5,utils.random(.1,.2)+.75*percent+.05)):(y=.1*utils.random(.1,1),1,meshes[clientIndex][cubeIndex].material.color.setHSL(h,s,l)),TweenMax.to(meshes[clientIndex][cubeIndex].scale,.5,{y:y,yoyo:!1})},cubeIndex++,cubeIndex>=meshes[0].length-1&&(cubeIndex=0),updateRow(0,touch.pointers,utils.formatColorForWebgl(socketService.clientColor.user)),results=[],i=m=1,ref1=VOID_SETTINGS.URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM;1<=ref1?m<ref1:m>ref1;i=1<=ref1?++m:--m)keys=Object.keys(connectionData),pointers=(null!=(ref2=connectionData[keys[i-1]])?ref2.pointers:void 0)||[],color=null!=connectionData[keys[i-1]]?connectionData[keys[i-1]].color:16777215,results.push(updateRow(i,pointers,color));return results},connectionIndex=1,connectionData={},onUserActionStart=function(event,data){var pointerVectors,ref1;if(connectionData[data.clientId]={index:connectionIndex,pointers:data.pointers,color:data.clientColor,instrument:data.roomData.instrument},pointerVectors=getPointerVectors(data.pointers),null!=(ref1=connectionPointers[connectionIndex])&&ref1.onTouch(pointerVectors,data.clientColor),connectionIndex++,data.roomData.instrument!==$scope.instrument&&$scope.$apply(function(){var obj;return obj=lodash.find($scope.instruments,{id:data.roomData.instrument}),obj.color="transparent",obj.connection=!0,obj.borderColor=utils.userColorForCSS(data.clientColor),changesound(-1,data.pointers,data.roomData.instrument,!0)}),connectionIndex>=VOID_SETTINGS.URBAN_JUNGLE_MAX_CONNECTIONS_PER_ROOM)return connectionIndex=1},onUserAction=function(event,data){var _connectionIndex,pointerVectors;return connectionData[data.clientId].pointers=data.pointers,connectionData[data.clientId].color=data.clientColor,connectionData[data.clientId].instrument=data.roomData.instrument,_connectionIndex=connectionData[data.clientId].index,pointerVectors=getPointerVectors(data.pointers),data.roomData.instrument!==$scope.instrument&&changesound(-1,data.pointers,data.roomData.instrument,!0),connectionPointers[_connectionIndex].onTouch(pointerVectors,data.clientColor)},onUserActionEnd=function(event,data){var _connectionIndex,instrument;return _connectionIndex=connectionData[data.clientId].index,instrument=connectionData[data.clientId].instrument,instrument!==$scope.instrument&&changesound(-1,data.pointers,instrument,!1),connectionPointers[_connectionIndex].onTouchEnd(),instrument!==$scope.instrument&&$scope.$apply(function(){var obj;return obj=lodash.find($scope.instruments,{id:instrument}),obj.color="transparent",obj.connection=!1,obj.borderColor="#ffffff"}),delete connectionData[data.clientId]},unbindUserInteractionStartHandler=$rootScope.$on("user.interaction.start",onUserActionStart),unbindUserInteractionHandler=$rootScope.$on("user.interaction",onUserAction),unbindUserInteractionEndHandler=$rootScope.$on("user.interaction.end",onUserActionEnd),unbindAnimateOut=$rootScope.$on("room.animate.out.start",function(){if(VOID_SETTINGS.SOUND_ENABLED)return sounds.base.fade(sounds.base.volume(),0,2e3),sounds.base2.fade(sounds.base2.volume(),0,2e3),sounds.layer1.fade(sounds.layer1.volume(),0,2e3),sounds.layer2.fade(sounds.layer2.volume(),0,2e3),sounds.layer3.fade(sounds.layer3.volume(),0,2e3),sounds.mimi1.fade(sounds.mimi1.volume(),0,2e3),sounds.mimi2.fade(sounds.mimi2.volume(),0,2e3),sounds.mimi3.fade(sounds.mimi3.volume(),0,2e3),sounds.beatsB1.fade(sounds.beatsB1.volume(),0,2e3),sounds.beatsB2.fade(sounds.beatsB2.volume(),0,2e3),sounds.beatsB3.fade(sounds.beatsB3.volume(),0,2e3),sounds.bass1.fade(sounds.bass1.volume(),0,2e3),sounds.bass2.fade(sounds.bass2.volume(),0,2e3),sounds.bass3.fade(sounds.bass3.volume(),0,2e3),$timeout(function(){var id,sound;for(id in sounds)sound=sounds[id],"function"==typeof sound.unload&&sound.unload();return sounds=null},2e3)}),$scope.$on("$destroy",function(){var len,m,object,ref1;for(DESTROY=!0,c.log("[Urban Jungle] destroy"),clearInterval(intervalTick),gui.destroy(),unbindAnimateOut(),unbindAnimateOut=null,unbindUserInteractionStartHandler(),unbindUserInteractionStartHandler=null,unbindUserInteractionHandler(),unbindUserInteractionHandler=null,unbindUserInteractionEndHandler(),unbindUserInteractionEndHandler=null,touch.off("touchstart",onTouchStart),touch.off("touchmove",onTouchMove),touch.off("touchend",onTouchEnd),touch.unbind(),Window.off("resize",onResize),Window.off("focus",onWindowFocused),Window.off("idle",onWindowIdle),ref1=scene.children,m=0,len=ref1.length;m<len;m++)object=ref1[m],scene.remove(object);return renderer.domElement.addEventListener("dblclick",null,!1),renderer.domElement=null,renderer=null,scene=null})}}}return RoomVisualUrbanJungle}(),angular.module("app").directive("roomVisualUrbanJungle",["$rootScope","GUI","Window","AssetLoader","Browser","lodash","$timeout","sessionService","socketService",RoomVisualUrbanJungle]);

}
/*
     FILE ARCHIVED ON 17:18:19 Mar 08, 2020 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 05:48:52 Oct 26, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 0.504
  exclusion.robots: 0.027
  exclusion.robots.policy: 0.017
  esindex: 0.009
  cdx.remote: 57.189
  LoadShardBlock: 111.209 (3)
  PetaboxLoader3.datanode: 113.511 (5)
  load_resource: 247.848 (2)
  PetaboxLoader3.resolve: 201.565 (2)
*/